{"version":3,"headline":"Bye bye Mongo, Hello Postgres","standfirst":"<p>In April the Guardian switched off the Mongo DB cluster used to store our content after completing a migration to PostgreSQL on Amazon RDS. This post covers why and how<br></p>","webTitle":"Bye bye Mongo, Hello Postgres | Digital blog","mainMediaElements":[{"displayCredit":true,"_type":"model.dotcomrendering.pageElements.ImageBlockElement","role":"inline","media":{"allImages":[{"index":0,"fields":{"height":"84","width":"140"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/140.jpg"},{"index":1,"fields":{"height":"300","width":"500"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/500.jpg"},{"index":2,"fields":{"height":"600","width":"1000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/1000.jpg"},{"index":3,"fields":{"height":"1200","width":"2000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/2000.jpg"},{"index":4,"fields":{"height":"2289","width":"3817"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/3817.jpg"},{"index":5,"fields":{"isMaster":"true","height":"2289","width":"3817"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg"}]},"elementId":"d162a78e-3390-4e91-abea-ea60df2d8c9e","imageSources":[{"weighting":"inline","srcSet":[{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=620&quality=85&auto=format&fit=max&s=9ac22b3bb5c6e9bd7c57259e1af29c3a","width":620},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=d6cd3e5f8d74cab46af572219cb70e6c","width":1240},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=700&quality=85&auto=format&fit=max&s=34792302523e2d3472d959b33b53d216","width":700},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=700&quality=45&auto=format&fit=max&dpr=2&s=9fd973d6a3d81880359a20fb64d41cd2","width":1400},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=620&quality=85&auto=format&fit=max&s=9ac22b3bb5c6e9bd7c57259e1af29c3a","width":620},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=d6cd3e5f8d74cab46af572219cb70e6c","width":1240},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=645&quality=85&auto=format&fit=max&s=26d07d009cc2e95d80ce5b7292199194","width":645},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=645&quality=45&auto=format&fit=max&dpr=2&s=f7a67a74c393bd3dd96a28c660b87736","width":1290},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=465&quality=85&auto=format&fit=max&s=aebbd759322ec9018410ff72a1bff7c3","width":465},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=465&quality=45&auto=format&fit=max&dpr=2&s=f9cbef8bd85fa4c70416686982f0c8a4","width":930}]},{"weighting":"thumbnail","srcSet":[]},{"weighting":"supporting","srcSet":[]},{"weighting":"showcase","srcSet":[{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1020&quality=85&auto=format&fit=max&s=530950308bb3a6487645c4fd268ea79b","width":1020},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1020&quality=45&auto=format&fit=max&dpr=2&s=1235786d56927b073a97d7bee0f59cbc","width":2040},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=940&quality=85&auto=format&fit=max&s=480c22c7823dabfd2d6dc81b3c16b174","width":940},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=940&quality=45&auto=format&fit=max&dpr=2&s=3c55461f8a0d1e06625e9d30d4bdb50f","width":1880},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=700&quality=85&auto=format&fit=max&s=34792302523e2d3472d959b33b53d216","width":700},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=700&quality=45&auto=format&fit=max&dpr=2&s=9fd973d6a3d81880359a20fb64d41cd2","width":1400},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=700&quality=85&auto=format&fit=max&s=34792302523e2d3472d959b33b53d216","width":700},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=700&quality=45&auto=format&fit=max&dpr=2&s=9fd973d6a3d81880359a20fb64d41cd2","width":1400},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=660&quality=85&auto=format&fit=max&s=fd24d69773cd3e3216d04aa71eac49a6","width":660},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=660&quality=45&auto=format&fit=max&dpr=2&s=51396c5050c3f658e4ee370bdb205448","width":1320},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=645&quality=85&auto=format&fit=max&s=26d07d009cc2e95d80ce5b7292199194","width":645},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=645&quality=45&auto=format&fit=max&dpr=2&s=f7a67a74c393bd3dd96a28c660b87736","width":1290},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=465&quality=85&auto=format&fit=max&s=aebbd759322ec9018410ff72a1bff7c3","width":465},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=465&quality=45&auto=format&fit=max&dpr=2&s=f9cbef8bd85fa4c70416686982f0c8a4","width":930}]},{"weighting":"halfwidth","srcSet":[]},{"weighting":"immersive","srcSet":[{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1900&quality=85&auto=format&fit=max&s=978f8c64e9f5b96bdf978c3d2da24d08","width":1900},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1900&quality=45&auto=format&fit=max&dpr=2&s=5b6984d548e1df47f2eefaf988916699","width":3800},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1300&quality=85&auto=format&fit=max&s=180cdc9ca9919db80025adfa3398cd97","width":1300},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1300&quality=45&auto=format&fit=max&dpr=2&s=c4e94892d62b027ab1d7610ba9d09d86","width":2600},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1140&quality=85&auto=format&fit=max&s=2a3c15a7f8630a0b16154bb43c78ab59","width":1140},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1140&quality=45&auto=format&fit=max&dpr=2&s=fdf25ec222a92232cbd62dd988e64a9f","width":2280},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=980&quality=85&auto=format&fit=max&s=41588ff53f0f42c7774c49145a0bc35b","width":980},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=980&quality=45&auto=format&fit=max&dpr=2&s=44565c46d7e7a32afa1683e6c0572c1a","width":1960},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=740&quality=85&auto=format&fit=max&s=33d256872d4593de3d79b705f0c58873","width":740},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=740&quality=45&auto=format&fit=max&dpr=2&s=7c185099f5e03e5f0c94a0a541e54d20","width":1480},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=660&quality=85&auto=format&fit=max&s=fd24d69773cd3e3216d04aa71eac49a6","width":660},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=660&quality=45&auto=format&fit=max&dpr=2&s=51396c5050c3f658e4ee370bdb205448","width":1320},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=480&quality=85&auto=format&fit=max&s=42fa35943f226f1e5a7a154bb157cbf0","width":480},{"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=480&quality=45&auto=format&fit=max&dpr=2&s=b45328fddc66f52580d93c26c032f1c2","width":960}]}],"data":{"copyright":"The Associated Press","alt":"An elephant picking up some greenery","caption":"An elephant picking up some greenery.","credit":"Photograph: Michael Sohn/AP"}}],"main":"<figure class=\"element element-image\" data-media-id=\"4842b3009287b04d043eb1b627ee8fa5e6e77096\"> \n <img src=\"https://media.guim.co.uk/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/1000.jpg\" alt=\"An elephant picking up some greenery\" width=\"1000\" height=\"600\" class=\"gu-image\"> \n <figcaption> <span class=\"element-image__caption\">An elephant picking up some greenery.</span> <span class=\"element-image__credit\">Photograph: Michael Sohn/AP</span> \n </figcaption> \n</figure>","filterKeyEvents":false,"keyEvents":[],"blocks":[{"id":"5ba22ad3e4b0b5565ec2ffc1","elements":[{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>At the Guardian, the majority of content – including articles, live blogs, galleries and video content – is produced in our in-house CMS tool, Composer. This, until recently, was backed by a Mongo DB database running on AWS. This database is essentially the “source of truth” for all Guardian content that has been published online – approximately 2.3m content items. We’ve just completed our migration away from Mongo to Postgres SQL.</p>","elementId":"ee86d591-ffa6-4bd3-9f05-a72d1a734504"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Composer, and its database, originally started their lives in Guardian Cloud – a data centre in the basement of our office near Kings Cross, with a failover elsewhere in London. Our failover procedures were put to the test rather harshly <a href=\"https://www.theguardian.com/uk-news/live/2015/jul/01/heatwave-live-britain-hottest-day-2015\">one hot day in July 2015</a></p>","elementId":"daad7f4a-7760-4f7b-ad21-52e544291807"},{"displayCredit":true,"_type":"model.dotcomrendering.pageElements.ImageBlockElement","role":"inline","media":{"allImages":[{"index":0,"fields":{"height":"2727","width":"4547"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/4547.jpg"},{"index":1,"fields":{"isMaster":"true","height":"2727","width":"4547"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg"},{"index":2,"fields":{"height":"1200","width":"2000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/2000.jpg"},{"index":3,"fields":{"height":"600","width":"1000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/1000.jpg"},{"index":4,"fields":{"height":"300","width":"500"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/500.jpg"},{"index":5,"fields":{"height":"84","width":"140"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/140.jpg"}]},"elementId":"916918ff-d2cd-4e8b-a7e1-0dd5f7252bd8","imageSources":[{"weighting":"inline","srcSet":[{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=620&quality=85&auto=format&fit=max&s=82b3f9f4d57f8858f201c01a80a8ff00","width":620},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=dc3d7ad9ad3374952250be76fae20463","width":1240},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=605&quality=85&auto=format&fit=max&s=1c4384f30af16023bafa9e1984fb4bcb","width":605},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=cf2478f7c8791a44fd79ab8cf672d926","width":1210},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=445&quality=85&auto=format&fit=max&s=7edf542ae83ef3a82d86cd286cdb3dd8","width":445},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=ac917e0ad62c42b40272dcf35ffc87e4","width":890}]},{"weighting":"thumbnail","srcSet":[{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=140&quality=85&auto=format&fit=max&s=42c881c8436143fa5cc89484a50cd2ed","width":140},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=140&quality=45&auto=format&fit=max&dpr=2&s=e77dca8a004de96902ea90be3b52c678","width":280},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=120&quality=85&auto=format&fit=max&s=61e05f2d65c754c8e8f331661f3fef4e","width":120},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=120&quality=45&auto=format&fit=max&dpr=2&s=939e968659040bcbc0c40ce1cb3505d8","width":240}]},{"weighting":"supporting","srcSet":[{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=380&quality=85&auto=format&fit=max&s=be45c10e4c7090a4e0290d6511e34956","width":380},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=380&quality=45&auto=format&fit=max&dpr=2&s=1874612fb6241b36a92096d22b3614cd","width":760},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=300&quality=85&auto=format&fit=max&s=4d59424a104be68eac5423aebc84124b","width":300},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=300&quality=45&auto=format&fit=max&dpr=2&s=1a9fdcf0cfc34649c53d9a08f9da4f34","width":600},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=620&quality=85&auto=format&fit=max&s=82b3f9f4d57f8858f201c01a80a8ff00","width":620},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=dc3d7ad9ad3374952250be76fae20463","width":1240},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=605&quality=85&auto=format&fit=max&s=1c4384f30af16023bafa9e1984fb4bcb","width":605},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=cf2478f7c8791a44fd79ab8cf672d926","width":1210},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=445&quality=85&auto=format&fit=max&s=7edf542ae83ef3a82d86cd286cdb3dd8","width":445},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=ac917e0ad62c42b40272dcf35ffc87e4","width":890}]},{"weighting":"showcase","srcSet":[{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=860&quality=85&auto=format&fit=max&s=a20ad22be902675fc899638a5af1538f","width":860},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=860&quality=45&auto=format&fit=max&dpr=2&s=73967f41c0c87110832f120174d09b15","width":1720},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=780&quality=85&auto=format&fit=max&s=9671c8be2ce37d8b2a17fe88ac25f55b","width":780},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=780&quality=45&auto=format&fit=max&dpr=2&s=9bc0e3623b2e3f93fb7c13a86bf9478b","width":1560},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=620&quality=85&auto=format&fit=max&s=82b3f9f4d57f8858f201c01a80a8ff00","width":620},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=dc3d7ad9ad3374952250be76fae20463","width":1240},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=605&quality=85&auto=format&fit=max&s=1c4384f30af16023bafa9e1984fb4bcb","width":605},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=cf2478f7c8791a44fd79ab8cf672d926","width":1210},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=445&quality=85&auto=format&fit=max&s=7edf542ae83ef3a82d86cd286cdb3dd8","width":445},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=ac917e0ad62c42b40272dcf35ffc87e4","width":890}]},{"weighting":"halfwidth","srcSet":[{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=620&quality=85&auto=format&fit=max&s=82b3f9f4d57f8858f201c01a80a8ff00","width":620},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=dc3d7ad9ad3374952250be76fae20463","width":1240},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=605&quality=85&auto=format&fit=max&s=1c4384f30af16023bafa9e1984fb4bcb","width":605},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=cf2478f7c8791a44fd79ab8cf672d926","width":1210},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=445&quality=85&auto=format&fit=max&s=7edf542ae83ef3a82d86cd286cdb3dd8","width":445},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=ac917e0ad62c42b40272dcf35ffc87e4","width":890}]},{"weighting":"immersive","srcSet":[{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=1900&quality=85&auto=format&fit=max&s=c4d85d517a023d679076653f82d74356","width":1900},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=1900&quality=45&auto=format&fit=max&dpr=2&s=6a96b63f40d20b922e3875f7e534a867","width":3800},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=1300&quality=85&auto=format&fit=max&s=245556cd8b637f6c627efee3aeddbca2","width":1300},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=1300&quality=45&auto=format&fit=max&dpr=2&s=8985cb1622e6645e5f0ea58be683d35b","width":2600},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=1140&quality=85&auto=format&fit=max&s=6a6a595e44d86e2313fa1b10565dd5c0","width":1140},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=1140&quality=45&auto=format&fit=max&dpr=2&s=2e6114a95f5b9d8485865d3ebb80bbaa","width":2280},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=980&quality=85&auto=format&fit=max&s=800d204e70ddd0281aa07e517e9233de","width":980},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=980&quality=45&auto=format&fit=max&dpr=2&s=6e8b9e8385e91f3ce8fdff0aef35dc74","width":1960},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=740&quality=85&auto=format&fit=max&s=ccc310b351cf388543674a2bac47b1f2","width":740},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=740&quality=45&auto=format&fit=max&dpr=2&s=04ae67a7e20e2c5a19ca8f7e1eb4cfb6","width":1480},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=660&quality=85&auto=format&fit=max&s=dd1514d80d4ac9c0e0709fbaedd85f68","width":660},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=660&quality=45&auto=format&fit=max&dpr=2&s=61237b19bdd4f26492c73f8e8f150e79","width":1320},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=480&quality=85&auto=format&fit=max&s=9a35159b399a9875c75a89c2cc33155c","width":480},{"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=480&quality=45&auto=format&fit=max&dpr=2&s=32aeed04cc9a8dfd1bd659309981ceac","width":960}]}],"data":{"alt":"Children play in the fountains outside the Hayward Gallery on the South Bank, London, enjoying the hot, sunny weather. Commissioned","caption":"Hot weather: good for fountain dancing, bad for data centres.","credit":"Photograph: Sarah Lee/Guardian"}},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>After this, the Guardian’s migration to AWS became that bit more urgent. We decided to purchase <a href=\"https://www.mongodb.com/products/ops-manager\">OpsManager</a> – Mongo’s database management software – along with a Mongo support contract – to help with the cloud migration. We used OpsManager to manage backups, handle orchestration and provide monitoring for our database cluster.</p>","elementId":"26e58ff5-332a-4fb8-9d6d-a42a408224a0"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Due to editorial requirements, we needed to run the database cluster and OpsManager on our own infrastructure in AWS rather than using Mongo’s managed database offering. This was non-trivial, as Mongo didn’t provide any tooling for getting set up easily on AWS – we needed to hand write the cloudformation to define all the infrastructure, and on top of that <a href=\"https://github.com/guardian/machine-images/tree/master/packer/resources/features/mongo24\">we wrote hundreds of lines of ruby scripts</a> to handle installation of monitoring/automation agents and orchestration of new DB instances. We ended up having to run knowledge sharing sessions about database management in the team – something we’d hoped OpsManager would make easy.</p>","elementId":"cf0d17b4-7592-4992-9366-3e9860b5fe21"},{"_type":"model.dotcomrendering.pageElements.GuideAtomBlockElement","label":"Quick Guide","credit":"","id":"cfee56d3-053e-46e7-9d03-ec0704b3d476","elementId":"78d872c9-30d9-4e2b-869f-25eebf2b1a2d","title":"How do I join The Guardian Product & Engineering?","html":"<p><strong>Where can I find open positions?</strong></p><p>Apply for one of our open positions <a href=\"https://workforus.theguardian.com/careers/product-engineering\">here</a>.</p><p><strong>What can I expect from the interview process?</strong></p><p>We aim to be as fair and transparent as possible in our hiring process. Similar to other organisations, there is a CV screening, coding exercise and a face to face interview. Read more about what to expect and apply now <a href=\"https://www.theguardian.com/info/2019/apr/26/applying-to-the-guardians-digital-department\">here</a>, and read more about our department <a href=\"https://theguardian.engineering/\">here</a>.</p>"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Since migrating to AWS we’ve had two significant outages due to database problems, each preventing publication on theguardian.com for at least an hour. In both occasions neither OpsManager nor Mongo’s support agents were able to help us much, and we ended up solving the problem ourselves – in one case thanks to a <a href=\"https://github.com/sihil\">member of the team</a> picking up the phone from a desert on the outskirts of Abu Dhabi. Each of the issues could warrant a whole blog post in themselves, but the general take away points were:</p>","elementId":"f0cba26d-cb51-42ac-904f-1ffa560ed43c"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<ul>\n <li>\n  <p>Clocks are important – don’t lock down your VPC so much that NTP stops working.</p></li>\n <li>\n  <p>Automatically generating database indexes on application startup is probably a bad idea.</p></li>\n <li>\n  <p>Database management is important and hard – and we’d rather not be doing it ourselves.</p></li>\n</ul>","elementId":"e83b8295-543c-43ae-bf55-deb5c3b0b313"},{"displayCredit":true,"_type":"model.dotcomrendering.pageElements.ImageBlockElement","role":"inline","media":{"allImages":[{"index":0,"fields":{"height":"3011","width":"5019"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/5019.jpg"},{"index":1,"fields":{"isMaster":"true","height":"3011","width":"5019"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg"},{"index":2,"fields":{"height":"1200","width":"2000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/2000.jpg"},{"index":3,"fields":{"height":"600","width":"1000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/1000.jpg"},{"index":4,"fields":{"height":"300","width":"500"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/500.jpg"},{"index":5,"fields":{"height":"84","width":"140"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/140.jpg"}]},"elementId":"01c29d5b-6de9-41f6-8af3-2a02fda00c6b","imageSources":[{"weighting":"inline","srcSet":[{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=620&quality=85&auto=format&fit=max&s=734948fc0f19c86361bbc7ec262d2919","width":620},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=ea0c2ae45ede08e123fa6e518601e26d","width":1240},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=605&quality=85&auto=format&fit=max&s=19db96adfc2cda50938353605cdc56e8","width":605},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=5382594350b9b3699457756ca706d64b","width":1210},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=445&quality=85&auto=format&fit=max&s=4f8fbcf339be5c9f48db43960c1516ba","width":445},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=de39f22ae2af5107dc91d2a1e9d5e7ff","width":890}]},{"weighting":"thumbnail","srcSet":[{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=140&quality=85&auto=format&fit=max&s=1578a6506cd2c4af1710acd2f43bb4da","width":140},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=140&quality=45&auto=format&fit=max&dpr=2&s=4767853d755feebbd823db9de8b47e2f","width":280},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=120&quality=85&auto=format&fit=max&s=99f9240e95b1dee628bd4b3a5827e1fc","width":120},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=120&quality=45&auto=format&fit=max&dpr=2&s=94077e7d8a5b6d17fe686652f124bb18","width":240}]},{"weighting":"supporting","srcSet":[{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=380&quality=85&auto=format&fit=max&s=75615931243c34ea66fb23ba4af14611","width":380},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=380&quality=45&auto=format&fit=max&dpr=2&s=6822efa87da92ccba3d21c81f8f05fe1","width":760},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=300&quality=85&auto=format&fit=max&s=b64a067d690058739ad0beaffb08458a","width":300},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=300&quality=45&auto=format&fit=max&dpr=2&s=5f4c5525fb7eb339eb25a2af48aadab5","width":600},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=620&quality=85&auto=format&fit=max&s=734948fc0f19c86361bbc7ec262d2919","width":620},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=ea0c2ae45ede08e123fa6e518601e26d","width":1240},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=605&quality=85&auto=format&fit=max&s=19db96adfc2cda50938353605cdc56e8","width":605},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=5382594350b9b3699457756ca706d64b","width":1210},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=445&quality=85&auto=format&fit=max&s=4f8fbcf339be5c9f48db43960c1516ba","width":445},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=de39f22ae2af5107dc91d2a1e9d5e7ff","width":890}]},{"weighting":"showcase","srcSet":[{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=860&quality=85&auto=format&fit=max&s=42519c8b436bd5c7b52a45bb568d7ab4","width":860},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=860&quality=45&auto=format&fit=max&dpr=2&s=867e68bbcb63a1375bedd3d2f5322278","width":1720},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=780&quality=85&auto=format&fit=max&s=b286464daa5bf62c0c9eb466b2b9c66a","width":780},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=780&quality=45&auto=format&fit=max&dpr=2&s=3b2ced45a5745b1e9e8657b4dc0de511","width":1560},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=620&quality=85&auto=format&fit=max&s=734948fc0f19c86361bbc7ec262d2919","width":620},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=ea0c2ae45ede08e123fa6e518601e26d","width":1240},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=605&quality=85&auto=format&fit=max&s=19db96adfc2cda50938353605cdc56e8","width":605},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=5382594350b9b3699457756ca706d64b","width":1210},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=445&quality=85&auto=format&fit=max&s=4f8fbcf339be5c9f48db43960c1516ba","width":445},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=de39f22ae2af5107dc91d2a1e9d5e7ff","width":890}]},{"weighting":"halfwidth","srcSet":[{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=620&quality=85&auto=format&fit=max&s=734948fc0f19c86361bbc7ec262d2919","width":620},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=ea0c2ae45ede08e123fa6e518601e26d","width":1240},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=605&quality=85&auto=format&fit=max&s=19db96adfc2cda50938353605cdc56e8","width":605},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=5382594350b9b3699457756ca706d64b","width":1210},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=445&quality=85&auto=format&fit=max&s=4f8fbcf339be5c9f48db43960c1516ba","width":445},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=de39f22ae2af5107dc91d2a1e9d5e7ff","width":890}]},{"weighting":"immersive","srcSet":[{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=1900&quality=85&auto=format&fit=max&s=80234d868d833e0ca6a273522e144191","width":1900},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=1900&quality=45&auto=format&fit=max&dpr=2&s=a2b57d0f3c02e04a259ed437a9a18b0e","width":3800},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=1300&quality=85&auto=format&fit=max&s=8ea64303c210988d30125e819034ceea","width":1300},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=1300&quality=45&auto=format&fit=max&dpr=2&s=39bc6cea79ce4480f5f7c236c26b9312","width":2600},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=1140&quality=85&auto=format&fit=max&s=f3e59875880ab030bfd59c0238b92f18","width":1140},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=1140&quality=45&auto=format&fit=max&dpr=2&s=87fd3e7faee351585c6ee5ae2ec1953d","width":2280},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=980&quality=85&auto=format&fit=max&s=568a5a607386bf86deb69adeecd92c07","width":980},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=980&quality=45&auto=format&fit=max&dpr=2&s=2cc0e85abe28c2fb42e9337b186faff7","width":1960},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=740&quality=85&auto=format&fit=max&s=601ce1f35cfc5232055b6229ed9da68b","width":740},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=740&quality=45&auto=format&fit=max&dpr=2&s=173b6b4d0e5e2c1a4ca71b1dba1beb51","width":1480},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=660&quality=85&auto=format&fit=max&s=1db1fcb606f5a94290d0718720e08c4c","width":660},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=660&quality=45&auto=format&fit=max&dpr=2&s=66b9e4031a3b2ab860045164e3c80396","width":1320},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=480&quality=85&auto=format&fit=max&s=b3852bf900587571947b71d72e824986","width":480},{"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=480&quality=45&auto=format&fit=max&dpr=2&s=48ccd0ccd8263d7e7150c1e8a47fcc0b","width":960}]}],"data":{"copyright":"Credit: fStop Images GmbH / Alamy Stock Photo","alt":"An array of clocks.","caption":"When clocks get out of sync, networking becomes a nightmare.","credit":"Photograph: Alamy Stock Photo"}},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>OpsManager didn’t really deliver on its promise of hassle-free database management. For instance, actually managing OpsManager itself – in particular upgrading from OpsManager 1 to 2 – was very time consuming, and required specialist knowledge about our OpsManager setup. It also didn’t deliver on its “one-click upgrade” promise, due to changes in the authentication schema between different versions of Mongo DB. We lost at least two months of engineering time a year doing this database management work.</p>","elementId":"92dde531-b685-40b6-bdf6-dfaeb9660085"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>All of these problems, combined with the hefty annual fee we were paying for the support contract and OpsManager, left us looking for an alternative database option, with the following requirements:</p>","elementId":"86eaa038-b00c-41c2-a55b-9b1f60aa3c00"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<ul>\n <li>\n  <p>Minimal database management required.</p></li>\n <li>\n  <p>Encryption at rest supported.</p></li>\n <li>\n  <p>A feasible migration path from Mongo.</p></li>\n</ul>","elementId":"92932653-c70a-47d4-aa20-f9a3be9f7e22"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Since all our other services are running in AWS, the obvious choice was DynamoDB – Amazon’s NoSQL database offering. Unfortunately at the time Dynamo didn’t support encryption at rest. After waiting around nine months for this feature to be added, we ended up giving up and looking for something else, ultimately choosing to use Postgres on AWS RDS.</p>","elementId":"5a0a6c4a-ecdb-471d-a4c8-aa6fd1af6352"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>“But postgres isn’t a document store!” I hear you cry. Well, no, it isn’t, but it does have a JSONB column type, with support for indexes on fields within the JSON blob. We hoped that by using the JSONB type, we could migrate off Mongo onto Postgres with minimal changes to our data model. In addition, if we wanted to move to a more relational model in future we’d have that option. Another great thing about Postgres is how mature it is: every question we wanted to ask had in most cases already been answered on Stack Overflow.</p>","elementId":"81869d65-7cc9-42ca-8fc8-68b3a3b103ad"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>From a performance perspective, we were confident Postgres could cope – whilst Composer is a write-heavy tool (it writes to the database every time a journalist stops typing) – there are normally only a few hundred concurrent users – not exactly high performance computing!</p>","elementId":"f9565f30-98d1-4342-a37d-62e2b70da9cc"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Part two – two decades of content migrated, no downtime</h2>","elementId":"baf32ee6-e2a5-40b0-8a02-47b4e45440f9"},{"displayCredit":true,"_type":"model.dotcomrendering.pageElements.ImageBlockElement","role":"inline","media":{"allImages":[{"index":0,"fields":{"height":"2802","width":"4667"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/4667.jpg"},{"index":1,"fields":{"isMaster":"true","height":"2802","width":"4667"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg"},{"index":2,"fields":{"height":"1200","width":"2000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/2000.jpg"},{"index":3,"fields":{"height":"600","width":"1000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/1000.jpg"},{"index":4,"fields":{"height":"300","width":"500"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/500.jpg"},{"index":5,"fields":{"height":"84","width":"140"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/140.jpg"}]},"elementId":"3b428c12-75e4-42fa-b57a-e54640df5b54","imageSources":[{"weighting":"inline","srcSet":[{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=620&quality=85&auto=format&fit=max&s=007565fc723b5759bb73511396d35f1d","width":620},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=5d0ee82547d28f645423d47ee5609def","width":1240},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=605&quality=85&auto=format&fit=max&s=40155287373abd652373db65b24dd97b","width":605},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=23cd98f96952c3229310ceca1a3a71ee","width":1210},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=445&quality=85&auto=format&fit=max&s=a9bc2e66f3fa8eb619411dd9790206da","width":445},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=676c74abd56f962c417692a252ac38cc","width":890}]},{"weighting":"thumbnail","srcSet":[{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=140&quality=85&auto=format&fit=max&s=eb4bae0007ef736f44b3b448392e10f9","width":140},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=140&quality=45&auto=format&fit=max&dpr=2&s=09c62282f51680d00981a0e9a6adc478","width":280},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=120&quality=85&auto=format&fit=max&s=f47536315e517b652c9a59a1c5f3822e","width":120},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=120&quality=45&auto=format&fit=max&dpr=2&s=911d4d50a8f7093024ae4de57a940e11","width":240}]},{"weighting":"supporting","srcSet":[{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=380&quality=85&auto=format&fit=max&s=8c6c9a9c640992369ee6337150e8781c","width":380},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=380&quality=45&auto=format&fit=max&dpr=2&s=e08e3ec95839a835caea50bd5394eb56","width":760},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=300&quality=85&auto=format&fit=max&s=b485e6bc572d5a5a40caa9ed6c37f8c8","width":300},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=300&quality=45&auto=format&fit=max&dpr=2&s=8b6b0c4af5aada3496498aee768392fb","width":600},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=620&quality=85&auto=format&fit=max&s=007565fc723b5759bb73511396d35f1d","width":620},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=5d0ee82547d28f645423d47ee5609def","width":1240},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=605&quality=85&auto=format&fit=max&s=40155287373abd652373db65b24dd97b","width":605},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=23cd98f96952c3229310ceca1a3a71ee","width":1210},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=445&quality=85&auto=format&fit=max&s=a9bc2e66f3fa8eb619411dd9790206da","width":445},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=676c74abd56f962c417692a252ac38cc","width":890}]},{"weighting":"showcase","srcSet":[{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=860&quality=85&auto=format&fit=max&s=e834d144b8a0c06dab1a40ced64b0ed2","width":860},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=860&quality=45&auto=format&fit=max&dpr=2&s=0be1495dacfe0ccb6549a7fb0bbea507","width":1720},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=780&quality=85&auto=format&fit=max&s=33c76646c8a804de4f2aeadeb6709172","width":780},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=780&quality=45&auto=format&fit=max&dpr=2&s=2e7c4b853472d96c87d9706eea5ea67d","width":1560},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=620&quality=85&auto=format&fit=max&s=007565fc723b5759bb73511396d35f1d","width":620},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=5d0ee82547d28f645423d47ee5609def","width":1240},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=605&quality=85&auto=format&fit=max&s=40155287373abd652373db65b24dd97b","width":605},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=23cd98f96952c3229310ceca1a3a71ee","width":1210},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=445&quality=85&auto=format&fit=max&s=a9bc2e66f3fa8eb619411dd9790206da","width":445},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=676c74abd56f962c417692a252ac38cc","width":890}]},{"weighting":"halfwidth","srcSet":[{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=620&quality=85&auto=format&fit=max&s=007565fc723b5759bb73511396d35f1d","width":620},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=5d0ee82547d28f645423d47ee5609def","width":1240},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=605&quality=85&auto=format&fit=max&s=40155287373abd652373db65b24dd97b","width":605},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=23cd98f96952c3229310ceca1a3a71ee","width":1210},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=445&quality=85&auto=format&fit=max&s=a9bc2e66f3fa8eb619411dd9790206da","width":445},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=676c74abd56f962c417692a252ac38cc","width":890}]},{"weighting":"immersive","srcSet":[{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=1900&quality=85&auto=format&fit=max&s=524898883577e35ea74d52b4f10be9fa","width":1900},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=1900&quality=45&auto=format&fit=max&dpr=2&s=da04b47c34df2923b63b1a8a5afa4171","width":3800},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=1300&quality=85&auto=format&fit=max&s=3b2bdd144c784429bc2e3e6322d1a28c","width":1300},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=1300&quality=45&auto=format&fit=max&dpr=2&s=f7b26e23311df762e5c49b3a66644470","width":2600},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=1140&quality=85&auto=format&fit=max&s=f7ab26c2fe943689ac319a8e79043be5","width":1140},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=1140&quality=45&auto=format&fit=max&dpr=2&s=6ecd15e5fdc0c8760fcffef2c528c663","width":2280},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=980&quality=85&auto=format&fit=max&s=6353a7a4ce444b5ed0390ae9f487621b","width":980},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=980&quality=45&auto=format&fit=max&dpr=2&s=b8d3c4e2163c62a139fd7afeabc3f1d6","width":1960},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=740&quality=85&auto=format&fit=max&s=39d7d5e9fad44f58d0c84004f9cb3c95","width":740},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=740&quality=45&auto=format&fit=max&dpr=2&s=04266511764590cae6328bd766199ff4","width":1480},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=660&quality=85&auto=format&fit=max&s=894fca730f914daf4f84763fe56b77cf","width":660},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=660&quality=45&auto=format&fit=max&dpr=2&s=2f8af7afdfa0dc73cab70a128f764072","width":1320},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=480&quality=85&auto=format&fit=max&s=95b00d1e32786623f8300b9a721171d1","width":480},{"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=480&quality=45&auto=format&fit=max&dpr=2&s=623ea510eeb69bb0848cb6ab5c1a4ffc","width":960}]}],"data":{"alt":"Postgres takes a bite out of mongo","caption":"Postgres takes a bite out of mongo.","credit":"Photograph: Bernd Thissen/AFP/Getty Images"}},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Plan</h2>","elementId":"3d980ddf-c069-4539-a981-4a7906945fe0"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Most database migrations involve the same steps and ours was no exception. Here are the steps we took to migrate the database:</p>","elementId":"c7fe2c73-36c5-4504-bda0-bcf77cabe577"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<ul>\n <li>\n  <p>Create the new database.</p></li>\n <li>\n  <p>Create a way to write to the new database (new API).</p></li>\n <li>\n  <p>Create a proxy that sends traffic to both the old and the new database, using the old one as primary.</p></li>\n <li>\n  <p>Migrate records from the old database into the new.</p></li>\n <li>\n  <p>Make the new database the primary.</p></li>\n <li>\n  <p>Delete the old database.</p></li>\n</ul>","elementId":"9892c794-5b09-4814-bb11-c01b6326b9ea"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Given that the database we were migrating powers our CMS, it was important the migration caused as little disruption as possible for our journalists. After all, the news never stops.</p>","elementId":"21edf818-7962-44d3-8987-1108b4aedb7f"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>New API</h2>","elementId":"6c817e9c-dd6c-4dbd-833f-f692248e3a3a"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Work began on the new Postgres-powered API towards the end of July 2017. And so our journey begins. But to understand the journey we need to first understand where we started from.</p>","elementId":"a7e597af-c4ad-4a37-8a90-9f3ddc8a29aa"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Our simplified CMS architecture was something like this: a database, an API, and several apps talking to it (such as the web frontend). The stack was, and still is, built using <a href=\"https://www.scala-lang.org/\">Scala</a>, <a href=\"http://scalatra.org/\">Scalatra Framework</a> and <a href=\"https://angularjs.org/\">Angular.js</a> and it is about four years old.</p>","elementId":"bd90d88b-f50a-484e-8695-65c1dce78f25"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>After some investigation we concluded that before we could migrate existing content, we needed a way to talk to the new PostgreSQL database and still have the old API running as usual. After all, the Mongo database is our source of truth. It offered us a safety blanket while experimenting with the new API.</p>","elementId":"eb4868c5-979d-49f1-9952-1264a10b86c1"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>This is one of the reasons why building on top of the old API wasn’t an option. There was very little separation of concern in the original API and MongoDB specifics could be found even at the controller level. As a result the task of adding another database type in the existing API was too risky.</p>","elementId":"c74b4824-4799-4569-817b-746ac53e0f27"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>We went down a different route instead and duplicated the old API. And this is how APIV2 was born. It was more or less an exact replica of the Mongo one and included the same endpoints and functionality. We used <a href=\"https://tpolecat.github.io/doobie/\">doobie</a>, a pure functional JDBC layer for Scala, added <a href=\"https://www.docker.com/\">Docker</a> for running locally and testing, and improved logging and separation of concerns. APIV2 was going to be a fast and modern API.</p>","elementId":"13167094-fb06-4ed9-9c12-695bc97fd085"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>By the end of August 2017 we had a new API deployed that was using PostgreSQL as its database. But this was only the beginning. There are articles in the Mongo database that were first created over two decades ago and all of these needed to be moved to the Postgres database.</p>","elementId":"af2511b0-3e40-4e84-8fa9-6a6e78f76dc5"},{"displayCredit":true,"_type":"model.dotcomrendering.pageElements.ImageBlockElement","role":"inline","media":{"allImages":[{"index":0,"fields":{"height":"2563","width":"4272"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/4272.jpg"},{"index":1,"fields":{"isMaster":"true","height":"2563","width":"4272"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg"},{"index":2,"fields":{"height":"1200","width":"2000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/2000.jpg"},{"index":3,"fields":{"height":"600","width":"1000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/1000.jpg"},{"index":4,"fields":{"height":"300","width":"500"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/500.jpg"},{"index":5,"fields":{"height":"84","width":"140"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/140.jpg"}]},"elementId":"9d2550a3-3c4c-4a6f-8eaa-a078282a4492","imageSources":[{"weighting":"inline","srcSet":[{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=620&quality=85&auto=format&fit=max&s=5d18d819818b87507a9e2a5435d83ff7","width":620},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=04e0706af21d8c308e4e31b42e24195f","width":1240},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=605&quality=85&auto=format&fit=max&s=d0928fe2d8be14ae7d5d24566705d868","width":605},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=8feb9bb3702b6d5bb3391df91f442e40","width":1210},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=445&quality=85&auto=format&fit=max&s=a75c5da712d46b23733b39c4abc3d427","width":445},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=487ce499120444e9831168b4b5b14e95","width":890}]},{"weighting":"thumbnail","srcSet":[{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=140&quality=85&auto=format&fit=max&s=c83c17c76eaeb40a3021596bb3c1ba27","width":140},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=140&quality=45&auto=format&fit=max&dpr=2&s=f80222a131c8363ae886522285623238","width":280},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=120&quality=85&auto=format&fit=max&s=e311e1be0b77f2a27b94aa581fd50425","width":120},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=120&quality=45&auto=format&fit=max&dpr=2&s=1933033a6ec80f79adf229cf6476562b","width":240}]},{"weighting":"supporting","srcSet":[{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=380&quality=85&auto=format&fit=max&s=86e49a48281a78773978dfb33a76037c","width":380},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=380&quality=45&auto=format&fit=max&dpr=2&s=443e7973105249ac1ff84e8c0bc638f1","width":760},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=300&quality=85&auto=format&fit=max&s=cf435cf4e833206f73d42b1e5620d9c1","width":300},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=300&quality=45&auto=format&fit=max&dpr=2&s=368cf5423a2295fb8a2e61a1f4409d98","width":600},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=620&quality=85&auto=format&fit=max&s=5d18d819818b87507a9e2a5435d83ff7","width":620},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=04e0706af21d8c308e4e31b42e24195f","width":1240},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=605&quality=85&auto=format&fit=max&s=d0928fe2d8be14ae7d5d24566705d868","width":605},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=8feb9bb3702b6d5bb3391df91f442e40","width":1210},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=445&quality=85&auto=format&fit=max&s=a75c5da712d46b23733b39c4abc3d427","width":445},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=487ce499120444e9831168b4b5b14e95","width":890}]},{"weighting":"showcase","srcSet":[{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=860&quality=85&auto=format&fit=max&s=43a19c620c4532a86cd6f2bbb31865f3","width":860},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=860&quality=45&auto=format&fit=max&dpr=2&s=ceb93279e76ab7f3643e76bf85f8eb80","width":1720},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=780&quality=85&auto=format&fit=max&s=74be2e1d343711a85b6c787179c9a7ee","width":780},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=780&quality=45&auto=format&fit=max&dpr=2&s=24244fdc6dfbb72d7547996698f57f5d","width":1560},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=620&quality=85&auto=format&fit=max&s=5d18d819818b87507a9e2a5435d83ff7","width":620},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=04e0706af21d8c308e4e31b42e24195f","width":1240},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=605&quality=85&auto=format&fit=max&s=d0928fe2d8be14ae7d5d24566705d868","width":605},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=8feb9bb3702b6d5bb3391df91f442e40","width":1210},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=445&quality=85&auto=format&fit=max&s=a75c5da712d46b23733b39c4abc3d427","width":445},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=487ce499120444e9831168b4b5b14e95","width":890}]},{"weighting":"halfwidth","srcSet":[{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=620&quality=85&auto=format&fit=max&s=5d18d819818b87507a9e2a5435d83ff7","width":620},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=04e0706af21d8c308e4e31b42e24195f","width":1240},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=605&quality=85&auto=format&fit=max&s=d0928fe2d8be14ae7d5d24566705d868","width":605},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=8feb9bb3702b6d5bb3391df91f442e40","width":1210},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=445&quality=85&auto=format&fit=max&s=a75c5da712d46b23733b39c4abc3d427","width":445},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=487ce499120444e9831168b4b5b14e95","width":890}]},{"weighting":"immersive","srcSet":[{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=1900&quality=85&auto=format&fit=max&s=f1991c9863196efb3b72019906f6ad06","width":1900},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=1900&quality=45&auto=format&fit=max&dpr=2&s=7cc744506e655a5af0f8212abdb02bbc","width":3800},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=1300&quality=85&auto=format&fit=max&s=55a05c42e712d82f57aa5a19379c89b2","width":1300},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=1300&quality=45&auto=format&fit=max&dpr=2&s=dffc02033067e06df4451eb2cdbf8671","width":2600},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=1140&quality=85&auto=format&fit=max&s=ede84242abcbbad3caae9797178867b4","width":1140},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=1140&quality=45&auto=format&fit=max&dpr=2&s=906a8f42426a7de9358d0d506f7c3b40","width":2280},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=980&quality=85&auto=format&fit=max&s=00df1f9e3ac72260f4555744376cfb07","width":980},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=980&quality=45&auto=format&fit=max&dpr=2&s=ebc434af73324fc735abd58ced068c88","width":1960},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=740&quality=85&auto=format&fit=max&s=a77a9f16127ebbfc6d9c084dd1f26c32","width":740},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=740&quality=45&auto=format&fit=max&dpr=2&s=fd76ae406459541cfd8f551beeac804d","width":1480},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=660&quality=85&auto=format&fit=max&s=d7f81e0bfaa435ba759844d70895535c","width":660},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=660&quality=45&auto=format&fit=max&dpr=2&s=212c8f7d88e0f1a33dd939e9500df321","width":1320},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=480&quality=85&auto=format&fit=max&s=070c3b630288a3cb35d01edace0db331","width":480},{"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=480&quality=45&auto=format&fit=max&dpr=2&s=4e8eeb53e462a52800706794deae93ba","width":960}]}],"data":{"alt":"Migrating to postgres for the winter","caption":"Migrating to postgres for the winter.","credit":"Photograph: Anna-Maria Fjellström"}},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Migration</h2>","elementId":"47234308-fc24-4360-a053-905e35ef6fa7"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>We need to be able to edit any article on the site regardless of when they were published, so all articles exist in our database as the single “source of truth”.</p>","elementId":"342a47a3-3a21-4598-9202-e0a0d5c15b17"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Although all of the articles live in the Guardian’s <a href=\"https://open-platform.theguardian.com/\">Content API</a> (CAPI), which powers the apps and website, getting the migration right was key as our database is the ‘source of truth’. If anything were to happen to the CAPI’s Elasticsearch cluster then we would reindex it from Composer’s database.</p>","elementId":"16de438a-9f32-4e77-9fc7-2b7a7608e9ca"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Therefore, before turning off Mongo we had to be confident that the same request on the Postgres powered API and the Mongo-powered API would return identical responses.</p>","elementId":"a2e53f94-e12b-44d8-a1f8-184da1830e01"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>To do this we needed to copy all content to the new Postgres database. This was done using a script that talked directly to the old and new APIs. The advantage of doing it this way was that the APIs already provided a well tested interface for reading and writing articles to and from the databases, as opposed to writing something that accessed the relevant databases directly.</p>","elementId":"be01c0c9-8b18-4116-9cbc-fe68c5592701"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The basic flow for the migration was:</p>","elementId":"2e4ed04d-c620-42d5-8633-ce85edd70e14"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<ul>\n <li>\n  <p>Get content from Mongo.</p></li>\n <li>\n  <p>Post content to Postgres.</p></li>\n <li>\n  <p>Get content from Postgres.</p></li>\n <li>\n  <p>Check that the responses from one and three are identical</p></li>\n</ul>","elementId":"bd99bb0c-5d4c-4a02-8928-713292f39eeb"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>A database migration has only really gone well if your end users are completely unaware that it has happened and a good migration script was always going to be an essential part of this.</p>","elementId":"7ede95b8-9715-4c55-a47c-34f765aafb7f"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>With this in mind we needed a script that could:</p>","elementId":"ad88df27-aaa5-40eb-a8af-9214744eac8a"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<ul>\n <li>\n  <p>Make HTTP requests.</p></li>\n <li>\n  <p>Ensure that after migrating a piece of content, the response from both APIs matched.</p></li>\n <li>\n  <p>Stop if there was an error.</p></li>\n <li>\n  <p>Produce detailed logs to help diagnose issues.</p></li>\n <li>\n  <p>Restart from the correct point after an error.</p></li>\n</ul>","elementId":"0309a613-7348-42f7-beb2-fb205a45e609"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>We started off using <a href=\"http://ammonite.io/\">Ammonite</a>. Ammonite allows you to write scripts in Scala, which is the primary language on our team. This was a good opportunity to experiment with something we’d not used before to see if it would be useful for us. Although Ammonite allowed us to use a familiar language there were downsides. Whilst Intellij now <a href=\"https://blog.jetbrains.com/scala/2017/11/28/intellij-idea-scala-plugin-2017-3-lightbend-project-starter-ammonite-support-parallel-indexing-and-more/\">supports Ammonite</a>, at the time it did not, which meant we lost autocomplete and automatic imports. It was also not possible to run an Ammonite script for an extended period of time.</p>","elementId":"bd7bac83-e49c-4bea-868c-01a83ab5415c"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Ultimately Ammonite was not the right tool for the job and we used an sbt project instead to perform the migration. The approach we took allowed us to work in a language we were confident in and perform multiple ‘test migrations’ until we were confident to run it in production.</p>","elementId":"0cb113e6-cd2f-453e-bcd3-c217867d26ef"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>What was unexpected was how useful this would be in testing the Postgres API. We found several subtle bugs and edge cases in the new API that we had not found before.</p>","elementId":"a10b3e18-5f14-40cc-b8ce-bd7e2c0cf331"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Fast forward to January 2018, and it was time to test a complete migration in CODE, our pre-production environment.</p>","elementId":"3894bdae-86a5-4599-b1c6-e6f2aa9b451b"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Similar to most of our systems, the only similarity between CODE and PROD is the version of the application they are running. The AWS infrastructure backing the CODE environment was far less powerful than PROD simply because it receives far less usage.</p>","elementId":"a29215c5-a01e-427c-9479-06fe1dbb5df5"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Running a migration on CODE would help us to:</p>","elementId":"fe1dc086-ae38-41e2-bc4e-48aa7308b816"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<ul>\n <li>\n  <p>Estimate how long a migration on PROD would take.</p></li>\n <li>\n  <p>Assess what impact, if any, a migration would have on performance.</p></li>\n</ul>","elementId":"58d9136a-fd5c-4557-922b-ce8a6302393e"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>In order to get an accurate measurement of these metrics, we had to match the two environments. This involved restoring a backup of the PROD mongo database into CODE and updating the AWS backed infrastructure.</p>","elementId":"4e8cf713-5eca-4d7b-b660-c25066779dfe"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Migrating just over 2m items of content was going to take a long time, certainly more than office hours. So we ran the script in a <a href=\"https://en.wikipedia.org/wiki/GNU_Screen\">screen sessio</a>n overnight.</p>","elementId":"ae279df0-9ee5-48c9-9c4a-c7f07c1df28c"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>In order to measure the progress of the migration, we shipped structured logs (using markers) to our ELK stack. From here, we could create detailed dashboards, tracking the number of articles successfully migrated, the number of failures and the overall progress. Additionally, these were displayed on a big screen near the team to provide greater visibility.</p>","elementId":"cfef6a03-3cdc-4953-a235-ceae7810000a"},{"displayCredit":true,"_type":"model.dotcomrendering.pageElements.ImageBlockElement","role":"inline","media":{"allImages":[{"index":0,"fields":{"height":"1533","width":"3360"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/3360.png"},{"index":1,"fields":{"isMaster":"true","height":"1533","width":"3360"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png"},{"index":2,"fields":{"height":"913","width":"2000"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/2000.png"},{"index":3,"fields":{"height":"456","width":"1000"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/1000.png"},{"index":4,"fields":{"height":"228","width":"500"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/500.png"},{"index":5,"fields":{"height":"64","width":"140"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/140.png"}]},"elementId":"1c8fbfe9-7564-46ce-8991-eab2e3c97fe0","imageSources":[{"weighting":"inline","srcSet":[{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=620&quality=85&auto=format&fit=max&s=64ef6e6c594496b9eedff0b3d673798c","width":620},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=620&quality=45&auto=format&fit=max&dpr=2&s=98304c25b98e877908b39565224dce71","width":1240},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=605&quality=85&auto=format&fit=max&s=cbd68f752dbc4c46d0477e71edb203be","width":605},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=605&quality=45&auto=format&fit=max&dpr=2&s=616098fac5c8ea7823fb27d25b42a7f9","width":1210},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=445&quality=85&auto=format&fit=max&s=f8ae454cb2f4511f1cee7e94fad8995b","width":445},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=445&quality=45&auto=format&fit=max&dpr=2&s=6461311788a554f674f1cb651cf59198","width":890}]},{"weighting":"thumbnail","srcSet":[{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=140&quality=85&auto=format&fit=max&s=5d982c43f96cde912d0a3a59dda35cc6","width":140},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=140&quality=45&auto=format&fit=max&dpr=2&s=0b163857181d53eb3d73897b91c41508","width":280},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=120&quality=85&auto=format&fit=max&s=6c238331ad028604214712c1a98255ae","width":120},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=120&quality=45&auto=format&fit=max&dpr=2&s=66395ef34b687df0bc3d88b58da7d5e2","width":240}]},{"weighting":"supporting","srcSet":[{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=380&quality=85&auto=format&fit=max&s=a1e5f93165f29f8ce8f60348a1a33670","width":380},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=380&quality=45&auto=format&fit=max&dpr=2&s=1c9c01dabdfbfbe31ce32fb854a284bb","width":760},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=300&quality=85&auto=format&fit=max&s=a58ab04ef4bd196acaf2e1b70ab5b8a7","width":300},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=300&quality=45&auto=format&fit=max&dpr=2&s=bc7c35b61f961aa344da3feab988f0bf","width":600},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=620&quality=85&auto=format&fit=max&s=64ef6e6c594496b9eedff0b3d673798c","width":620},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=620&quality=45&auto=format&fit=max&dpr=2&s=98304c25b98e877908b39565224dce71","width":1240},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=605&quality=85&auto=format&fit=max&s=cbd68f752dbc4c46d0477e71edb203be","width":605},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=605&quality=45&auto=format&fit=max&dpr=2&s=616098fac5c8ea7823fb27d25b42a7f9","width":1210},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=445&quality=85&auto=format&fit=max&s=f8ae454cb2f4511f1cee7e94fad8995b","width":445},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=445&quality=45&auto=format&fit=max&dpr=2&s=6461311788a554f674f1cb651cf59198","width":890}]},{"weighting":"showcase","srcSet":[{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=860&quality=85&auto=format&fit=max&s=f6893128b440383b15ad358a6159205f","width":860},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=860&quality=45&auto=format&fit=max&dpr=2&s=8a03f04f45af3272bbe33e2ab2d42e30","width":1720},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=780&quality=85&auto=format&fit=max&s=69c98bff9558940922963b66e8e79b9c","width":780},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=780&quality=45&auto=format&fit=max&dpr=2&s=f6735795187aaa9028ee0affb41d56da","width":1560},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=620&quality=85&auto=format&fit=max&s=64ef6e6c594496b9eedff0b3d673798c","width":620},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=620&quality=45&auto=format&fit=max&dpr=2&s=98304c25b98e877908b39565224dce71","width":1240},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=605&quality=85&auto=format&fit=max&s=cbd68f752dbc4c46d0477e71edb203be","width":605},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=605&quality=45&auto=format&fit=max&dpr=2&s=616098fac5c8ea7823fb27d25b42a7f9","width":1210},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=445&quality=85&auto=format&fit=max&s=f8ae454cb2f4511f1cee7e94fad8995b","width":445},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=445&quality=45&auto=format&fit=max&dpr=2&s=6461311788a554f674f1cb651cf59198","width":890}]},{"weighting":"halfwidth","srcSet":[{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=620&quality=85&auto=format&fit=max&s=64ef6e6c594496b9eedff0b3d673798c","width":620},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=620&quality=45&auto=format&fit=max&dpr=2&s=98304c25b98e877908b39565224dce71","width":1240},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=605&quality=85&auto=format&fit=max&s=cbd68f752dbc4c46d0477e71edb203be","width":605},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=605&quality=45&auto=format&fit=max&dpr=2&s=616098fac5c8ea7823fb27d25b42a7f9","width":1210},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=445&quality=85&auto=format&fit=max&s=f8ae454cb2f4511f1cee7e94fad8995b","width":445},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=445&quality=45&auto=format&fit=max&dpr=2&s=6461311788a554f674f1cb651cf59198","width":890}]},{"weighting":"immersive","srcSet":[{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=1900&quality=85&auto=format&fit=max&s=f4d3a88d855d0efd1ea004de04fffc20","width":1900},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=1900&quality=45&auto=format&fit=max&dpr=2&s=989df65c404721ababcfb9cae8916a01","width":3800},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=1300&quality=85&auto=format&fit=max&s=49fe133a0972d4f8d44462a733278aad","width":1300},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=1300&quality=45&auto=format&fit=max&dpr=2&s=f5c0c8046f29872ad8d6664b74bb09f4","width":2600},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=1140&quality=85&auto=format&fit=max&s=372047e2de1166cea5448bbb48a9644f","width":1140},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=1140&quality=45&auto=format&fit=max&dpr=2&s=0f90b47e5088ab5d66352bb85f79b53e","width":2280},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=980&quality=85&auto=format&fit=max&s=08177337f44a247f5a000c4667d172d5","width":980},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=980&quality=45&auto=format&fit=max&dpr=2&s=0372f492f5e8546d9100ddd68ed4266a","width":1960},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=740&quality=85&auto=format&fit=max&s=7e3210fb8698bbfb5349e68d28c4a715","width":740},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=740&quality=45&auto=format&fit=max&dpr=2&s=fb120ede8344a1a4cb469233207db3d1","width":1480},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=660&quality=85&auto=format&fit=max&s=aa9494fb139eb70abacef6518daeeee2","width":660},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=660&quality=45&auto=format&fit=max&dpr=2&s=f1e43dcc817d9cd82935c4d5464abb41","width":1320},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=480&quality=85&auto=format&fit=max&s=d8db8bace291b2fac577c7fbc31531ff","width":480},{"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=480&quality=45&auto=format&fit=max&dpr=2&s=facfa7598cd3f21a0b2863b1cb064e9e","width":960}]}],"data":{"alt":"Dashboard showing progress of the migration","caption":"Dashboard showing progress of the migration","credit":"Photograph: Editorial Tools/Guardian"}},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Once the migration had finished, we employed the same techniques to check each document in Postgres matched Mongo.</p>","elementId":"f6c0ce56-3abe-4fd9-a6eb-115f850a4f26"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Part three – Proxy and running in production</h2>","elementId":"ce56a2f7-caaf-46ff-a663-cff95e5ed8ad"},{"displayCredit":true,"_type":"model.dotcomrendering.pageElements.ImageBlockElement","role":"inline","media":{"allImages":[{"index":0,"fields":{"height":"1635","width":"2725"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/2725.jpg"},{"index":1,"fields":{"isMaster":"true","height":"1635","width":"2725"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg"},{"index":2,"fields":{"height":"1200","width":"2000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/2000.jpg"},{"index":3,"fields":{"height":"600","width":"1000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/1000.jpg"},{"index":4,"fields":{"height":"300","width":"500"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/500.jpg"},{"index":5,"fields":{"height":"84","width":"140"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/140.jpg"}]},"elementId":"12baeae0-db1e-4afb-8f6d-257d2de74832","imageSources":[{"weighting":"inline","srcSet":[{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=620&quality=85&auto=format&fit=max&s=0c222865335377156900df04dbb0632b","width":620},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=4b4bd701fab47870a28213c9822a004d","width":1240},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=605&quality=85&auto=format&fit=max&s=4800adf17074621173def0159736ec97","width":605},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=e9a987b8d9744fb796bf4a959b225d2b","width":1210},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=445&quality=85&auto=format&fit=max&s=279dcd9c538a92d0079f503c83715a80","width":445},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=9e42fe2537a2220d53f131f944b2c939","width":890}]},{"weighting":"thumbnail","srcSet":[{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=140&quality=85&auto=format&fit=max&s=e9d6f8a056494da85d25a9836f42e035","width":140},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=140&quality=45&auto=format&fit=max&dpr=2&s=7e88e8edee2b3c0962e04c70548600a2","width":280},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=120&quality=85&auto=format&fit=max&s=c1adb50b2f9a50bd1428b56160924f58","width":120},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=120&quality=45&auto=format&fit=max&dpr=2&s=4afa1736d594e60eeeef532bce090df1","width":240}]},{"weighting":"supporting","srcSet":[{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=380&quality=85&auto=format&fit=max&s=56fe4b29ef96420695c65e04dc5f77aa","width":380},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=380&quality=45&auto=format&fit=max&dpr=2&s=a3cbafb6b5846383a5f7cd4dc72dd6a4","width":760},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=300&quality=85&auto=format&fit=max&s=8806ad5bfb8f52353c1d26ecd32d4f4f","width":300},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=300&quality=45&auto=format&fit=max&dpr=2&s=e15d6be0074ece0704ce60bdd52f16a4","width":600},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=620&quality=85&auto=format&fit=max&s=0c222865335377156900df04dbb0632b","width":620},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=4b4bd701fab47870a28213c9822a004d","width":1240},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=605&quality=85&auto=format&fit=max&s=4800adf17074621173def0159736ec97","width":605},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=e9a987b8d9744fb796bf4a959b225d2b","width":1210},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=445&quality=85&auto=format&fit=max&s=279dcd9c538a92d0079f503c83715a80","width":445},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=9e42fe2537a2220d53f131f944b2c939","width":890}]},{"weighting":"showcase","srcSet":[{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=860&quality=85&auto=format&fit=max&s=9e5bb6b6abc22ee07572a15ef9fcb468","width":860},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=860&quality=45&auto=format&fit=max&dpr=2&s=aa17b9838f6b830b1ebb4e8b3b6ecedf","width":1720},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=780&quality=85&auto=format&fit=max&s=7fc2c1a4fd5014851076a65a941e3f3a","width":780},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=780&quality=45&auto=format&fit=max&dpr=2&s=77a11998b193e9997e15f506d48530c0","width":1560},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=620&quality=85&auto=format&fit=max&s=0c222865335377156900df04dbb0632b","width":620},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=4b4bd701fab47870a28213c9822a004d","width":1240},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=605&quality=85&auto=format&fit=max&s=4800adf17074621173def0159736ec97","width":605},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=e9a987b8d9744fb796bf4a959b225d2b","width":1210},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=445&quality=85&auto=format&fit=max&s=279dcd9c538a92d0079f503c83715a80","width":445},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=9e42fe2537a2220d53f131f944b2c939","width":890}]},{"weighting":"halfwidth","srcSet":[{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=620&quality=85&auto=format&fit=max&s=0c222865335377156900df04dbb0632b","width":620},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=4b4bd701fab47870a28213c9822a004d","width":1240},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=605&quality=85&auto=format&fit=max&s=4800adf17074621173def0159736ec97","width":605},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=605&quality=45&auto=format&fit=max&dpr=2&s=e9a987b8d9744fb796bf4a959b225d2b","width":1210},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=445&quality=85&auto=format&fit=max&s=279dcd9c538a92d0079f503c83715a80","width":445},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=445&quality=45&auto=format&fit=max&dpr=2&s=9e42fe2537a2220d53f131f944b2c939","width":890}]},{"weighting":"immersive","srcSet":[{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=1900&quality=85&auto=format&fit=max&s=9156005378c81274aceff4ce33fa9f1c","width":1900},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=1900&quality=45&auto=format&fit=max&dpr=2&s=e0fb88b673bb88394e9a58ad9fec0421","width":3800},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=1300&quality=85&auto=format&fit=max&s=6d3440c463149b66bf3239e4aa660005","width":1300},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=1300&quality=45&auto=format&fit=max&dpr=2&s=73afd3d54b80e216d9318556b263327d","width":2600},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=1140&quality=85&auto=format&fit=max&s=ccf2560710eb6f0919cb172ebd2feb3e","width":1140},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=1140&quality=45&auto=format&fit=max&dpr=2&s=fc504d70e8c80dcaa045d29a08ab2ba9","width":2280},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=980&quality=85&auto=format&fit=max&s=a77ec2050df3a36049343e9294854c1b","width":980},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=980&quality=45&auto=format&fit=max&dpr=2&s=52bbc28e4dbeec86f325fae1d3f04b1f","width":1960},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=740&quality=85&auto=format&fit=max&s=458dea1a5a6be0f77a0440d4abda21cb","width":740},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=740&quality=45&auto=format&fit=max&dpr=2&s=bb713297c2485d50bd62d3ed85c7d20d","width":1480},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=660&quality=85&auto=format&fit=max&s=07c81de5745d059834bafdfdf1d793d7","width":660},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=660&quality=45&auto=format&fit=max&dpr=2&s=7e4f203b6f653ba312a58d074895b670","width":1320},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=480&quality=85&auto=format&fit=max&s=0a1472f68157bc6a22a9fe29b2049935","width":480},{"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=480&quality=45&auto=format&fit=max&dpr=2&s=f424e78302b0f9b8d5af60d9b79210e6","width":960}]}],"data":{"alt":"Mongo to Postgres migration: the proxy","caption":"Mongo to Postgres migration: the proxy.","credit":"Photograph: Maria Livia Chiorean"}},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Proxy</h2>","elementId":"3995189b-abed-42e8-80f7-60f4ce73c731"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Now that the new Postgres-powered API was running we needed to test it with real life traffic and data access patterns to ensure it was reliable and stable. There were two possible ways to achieve this: update each client that talks to the Mongo API to talk to both APIs; or run a proxy that’ll do this. We wrote a proxy in Scala using <a href=\"https://doc.akka.io/docs/akka/2.5/stream/index.html\">Akka Streams</a>.</p>","elementId":"a6ff3914-86d5-4f9c-92d9-de9af6e9ed7d"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The proxy was fairly simple in its operation:</p>","elementId":"0a44feb8-3a85-4cae-b6b6-e56a2e446c24"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<ul>\n <li>\n  <p>Accept traffic from a load balancer.</p></li>\n <li>\n  <p>Forward the traffic to the primary api and return.</p></li>\n <li>\n  <p>Asynchronously forward the same traffic to the secondary api.</p></li>\n <li>\n  <p>Calculate any difference between the two responses and log them.</p></li>\n</ul>","elementId":"10c2334f-b789-4dbf-bdfe-46c92d9ca4df"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>At the start, the proxy was logging a lot of differences between the responses of the two APIs, surfacing some very subtle but important behavioural differences in the APIs that needed to be fixed.</p>","elementId":"4523e507-b383-4377-857f-f6576aa6c008"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Structured logging</h2>","elementId":"8a5d3069-31cc-455b-9e78-4a7d1e44f13c"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The way we do logging at the Guardian is by using an <a href=\"https://www.elastic.co/elk-stack\">ELK</a> stack. Using Kibana gave us the flexibility to surface logs in a way that would be most useful to us. Kibana uses the <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/6.x/query-dsl-query-string-query.html#query-string-syntax\">lucene query syntax</a> that is fairly easy to learn. But we soon realised that filtering out logs or grouping them was not possible in the current setup. For example, we weren’t able to filter out logs sent as a result of GET requests.</p>","elementId":"784df4f9-2f89-4d42-9d4c-238f2f592577"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Our solution was to send more structured logs to Kibana rather than sending only a message. One log entry contains multiple fields, like the timestamp, the name of the app that sent the log or the stack. Adding new fields programmatically is very easy. These structured fields are called markers and they can be implemented using the <a href=\"https://github.com/logstash/logstash-logback-encoder\">logstash-logback-encoder</a> library. For each request we extracted the useful information (eg path, method, status code) and created a map with the additional information we needed to log. Have a look at the example below.</p>","elementId":"57201656-ea61-4f26-8a77-ba9b30e82b1f"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"scala","elementId":"4c4a44ad-009b-4b43-88c1-31b2106bebfc","html":"import akka.http.scaladsl.model.HttpRequest\nimport ch.qos.logback.classic.{Logger => LogbackLogger}\nimport net.logstash.logback.marker.Markers\nimport org.slf4j.{LoggerFactory, Logger => SLFLogger}\n\nimport scala.collection.JavaConverters._\n\nobject Logging {\n val rootLogger: LogbackLogger = LoggerFactory.getLogger(SLFLogger.ROOT_LOGGER_NAME).asInstanceOf[LogbackLogger]\n\n private def setMarkers(request: HttpRequest) = {\n   val markers = Map(\n     \"path\" -> request.uri.path.toString(),\n     \"method\" -> request.method.value\n   )\n   Markers.appendEntries(markers.asJava)\n }\n\n def infoWithMarkers(message: String, akkaRequest: HttpRequest) =\n   rootLogger.info(setMarkers(akkaRequest), message)\n}"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The additional structure in our logs allowed us to build useful dashboards and add more context around our diffs, which helped us identify some of the smaller inconsistencies between the APIs.</p>","elementId":"f3365630-5301-40fd-b897-5a0ae4635f40"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Replicating traffic and proxy refactoring</h2>","elementId":"27a83188-9e0f-4838-a362-9b072ae32975"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Having migrated content into the CODE database we ended up with an almost exact replica of the PROD database. The major difference was CODE had no traffic. For replicating real traffic into the CODE environment we used an open-source tool called <a href=\"https://goreplay.org/\">GoReplay</a> (gor). It’s very easy to set up and it’s customisable to suit your requirements.</p>","elementId":"ad2cfa6a-a9d7-4ea8-a6bd-6dcca0c4127d"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>As all traffic coming into our APIs was hitting the proxy first it made sense to install gor on the proxy boxes. See below how to download gor on your box and how to start capturing traffic on port 80 and send it to another server.</p>","elementId":"0a2d7036-caa7-4fe1-871b-4cae868367a3"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"text","elementId":"e38904b6-f026-4769-aa63-2bc29f2ddc57","html":"wget https://github.com/buger/goreplay/releases/download/v0.16.0.2/gor_0.16.0_x64.tar.gz\n\ntar -xzf gor_0.16.0_x64.tar.gz gor\n\nsudo gor --input-raw :80 --output-http http://apiv2.code.co.uk"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Everything worked fine for a while, but very soon we experienced an outage on production when the proxy became unavailable for a couple of minutes. Upon investigation we found all three boxes on which the proxy was running cycled at the same time. Our suspicion was that gor was using too many resources and was causing the proxy to fall over. On further investigation we found in the AWS Console that the boxes had been regularly cycling, but not at the same time.</p>","elementId":"c56aef2f-16f5-4f5a-b13a-613de4959edd"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Before going any deeper, we tried to find a way to still run gor, but this time without putting any more pressure on the proxy. The solution came from our secondary stack for Composer. This stack is only used in case of emergency and it has our <a href=\"https://www.theguardian.com/info/developer-blog/2016/dec/05/testing-in-production-how-we-combined-tests-with-monitoring\">production monitoring tool</a> constantly running tests against it. Replaying traffic from this stack to CODE at double the speed worked without any issues this time.</p>","elementId":"88802a74-7d94-4ab6-b01f-6a38659fd969"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The new findings raised a lot of questions. The proxy had been built with the idea that it would only exist temporarily, so it perhaps hadn’t been as carefully designed as other apps. Also, it was built using <a href=\"https://doc.akka.io/docs/akka-http/current/\">Akka Http</a>, which none of the team members had used before. The code was messy and full of quick fixes. We decided to start a big refactoring job to improve readability that included using for comprehensions instead of the growing nested logic we had before, and adding even more logging markers.</p>","elementId":"a5c7e75c-065e-4f04-a516-bcc03d0e9fec"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>We were hoping that by taking time to understand how everything worked and by simplifying the logic we’d be able to stop the boxes from cycling. But this didn’t work. After about two weeks of trying to make the proxy more reliable we were starting to feel like we were falling deeper and deeper down a rabbit hole. A decision had to be made. We agreed to take the risk and leave it as it was better to spend the time on the actual migration than trying to fix a piece of software that was going to be gone in a month’s time. We paid for this decision by going through two more production outages, each lasting about two minutes, but overall it was the right thing to do.</p>","elementId":"f729f53a-db1f-47b0-bd83-3341c5a7b6e9"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Fast forward to March 2018 and we had now finished migrating CODE, with no detrimental impact on performance of the API or user experience in the CMS. We could now start to think about decommissioning the proxy in CODE.</p>","elementId":"96a5db30-764d-4a31-9ffa-9942a0178778"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The first stage of this was to change the priorities of the APIs, so that the proxy talked to Postgres first. As previously mentioned this was configuration based. However there was one complexity.</p>","elementId":"1782e2d6-7ff8-4e3f-960e-2b475ee8c944"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Composer sends messages on a Kinesis stream when a document has been updated. In order to avoid message duplication, only one API should send these messages. The APIs have a flag in configuration for this; the value was true for the Mongo backed API and false for the Postgres backed one. Simply changing the proxy to talk to Postgres first wasn’t enough as the message wouldn’t get sent on the Kinesis stream until the request reached Mongo too. This was too late.</p>","elementId":"bb090ffa-4e10-4a2d-beab-a82a6f4e59c7"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>To solve this, we created HTTP endpoints to change the config in memory across all instances in the load balancer instantaneously. This allowed us to very quickly switch which API was primary without needing to edit a config file and redeploy. Additionally, this could be scripted, reducing human interaction and error.</p>","elementId":"dffc68e1-d2f1-457c-8bd0-9563454c248c"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Now all requests were going to Postgres first and API2 was talking to Kinesis, the change could be made permanent via config and a redeploy.</p>","elementId":"920bc5d2-668d-46cc-bdf3-10d47edffe2f"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The next stage was to remove the proxy entirely and get clients to solely talk to the Postgres API. As there are numerous clients, updating each of them individually wasn’t really viable. Therefore, we pushed this up to the DNS. That is, we created a CNAME in DNS that, at first, pointed to the proxy’s ELB and would change to point to the API ELB. This allowed a single change to be made rather than updating each individual client of the API.</p>","elementId":"d29fe90b-d692-4c81-82df-2c9e9449ed54"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>It was now time to migrate PROD. Although slightly scary because, well, it’s production. The process was relatively simple as everything was based on configuration. Additionally, as we add a stage marker to the logs, it was also possible to repurpose the previously built dashboards simply by updating the Kibana filter.</p>","elementId":"f0e86167-3b09-45cb-bba8-9b13a20b8437"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Switching off the proxy and MongoDB</h2>","elementId":"0095b8b9-7151-4cdf-a825-60b1abc2751b"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Ten months and 2.4m migrated articles later, we were finally in a position to switch off all the Mongo related infrastructure. But first, the moment we’d all been waiting for: kill the proxy.</p>","elementId":"6f0d33af-0132-4003-9d01-d4c71bbfd97c"},{"displayCredit":true,"_type":"model.dotcomrendering.pageElements.ImageBlockElement","role":"inline","media":{"allImages":[{"index":0,"fields":{"height":"1350","width":"2250"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/2250.png"},{"index":1,"fields":{"isMaster":"true","height":"1350","width":"2250"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png"},{"index":2,"fields":{"height":"1200","width":"2000"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/2000.png"},{"index":3,"fields":{"height":"600","width":"1000"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/1000.png"},{"index":4,"fields":{"height":"300","width":"500"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/500.png"},{"index":5,"fields":{"height":"84","width":"140"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/140.png"}]},"elementId":"dd2a31ca-f335-4942-8bec-0d94df8bf135","imageSources":[{"weighting":"inline","srcSet":[{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=620&quality=85&auto=format&fit=max&s=03f5458f464dcf483bcde224ccc0b970","width":620},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=620&quality=45&auto=format&fit=max&dpr=2&s=c45f5200fca91ab7106910be4a337033","width":1240},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=605&quality=85&auto=format&fit=max&s=b9bee80aa1a7c58642729f1615b8820c","width":605},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=605&quality=45&auto=format&fit=max&dpr=2&s=96e236134867239df96596f7898994be","width":1210},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=445&quality=85&auto=format&fit=max&s=b9b8cc60d9a2b638260a9a069a6e1012","width":445},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=445&quality=45&auto=format&fit=max&dpr=2&s=fbf30324f897f8d364beec5ff0e54ee1","width":890}]},{"weighting":"thumbnail","srcSet":[{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=140&quality=85&auto=format&fit=max&s=bc8e83d937dd01fd5faa0ae0ff0b2565","width":140},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=140&quality=45&auto=format&fit=max&dpr=2&s=598275ea58ed865f1515b8dfe18eb879","width":280},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=120&quality=85&auto=format&fit=max&s=f99cd0c729e454d73b8a88f6f19fbf76","width":120},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=120&quality=45&auto=format&fit=max&dpr=2&s=42255c82564e6d5c75dd744c2c662c89","width":240}]},{"weighting":"supporting","srcSet":[{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=380&quality=85&auto=format&fit=max&s=b4de00b6d9caece73d71308c2f14f4d3","width":380},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=380&quality=45&auto=format&fit=max&dpr=2&s=1574a5d81a53ca423ac33fc1ec2331a6","width":760},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=300&quality=85&auto=format&fit=max&s=747be933676582f9fb9295f87a386794","width":300},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=300&quality=45&auto=format&fit=max&dpr=2&s=ada457dffa5f133af31c2c39a5dc9942","width":600},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=620&quality=85&auto=format&fit=max&s=03f5458f464dcf483bcde224ccc0b970","width":620},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=620&quality=45&auto=format&fit=max&dpr=2&s=c45f5200fca91ab7106910be4a337033","width":1240},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=605&quality=85&auto=format&fit=max&s=b9bee80aa1a7c58642729f1615b8820c","width":605},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=605&quality=45&auto=format&fit=max&dpr=2&s=96e236134867239df96596f7898994be","width":1210},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=445&quality=85&auto=format&fit=max&s=b9b8cc60d9a2b638260a9a069a6e1012","width":445},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=445&quality=45&auto=format&fit=max&dpr=2&s=fbf30324f897f8d364beec5ff0e54ee1","width":890}]},{"weighting":"showcase","srcSet":[{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=860&quality=85&auto=format&fit=max&s=9c57ad332aa62f7fe2632cb2677d4805","width":860},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=860&quality=45&auto=format&fit=max&dpr=2&s=9cd0bd31a2244c7c580c316827285f1a","width":1720},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=780&quality=85&auto=format&fit=max&s=352de30c31af53158292d47e3d8503e3","width":780},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=780&quality=45&auto=format&fit=max&dpr=2&s=105eeeb7b528909276f451f8ad7efa29","width":1560},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=620&quality=85&auto=format&fit=max&s=03f5458f464dcf483bcde224ccc0b970","width":620},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=620&quality=45&auto=format&fit=max&dpr=2&s=c45f5200fca91ab7106910be4a337033","width":1240},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=605&quality=85&auto=format&fit=max&s=b9bee80aa1a7c58642729f1615b8820c","width":605},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=605&quality=45&auto=format&fit=max&dpr=2&s=96e236134867239df96596f7898994be","width":1210},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=445&quality=85&auto=format&fit=max&s=b9b8cc60d9a2b638260a9a069a6e1012","width":445},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=445&quality=45&auto=format&fit=max&dpr=2&s=fbf30324f897f8d364beec5ff0e54ee1","width":890}]},{"weighting":"halfwidth","srcSet":[{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=620&quality=85&auto=format&fit=max&s=03f5458f464dcf483bcde224ccc0b970","width":620},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=620&quality=45&auto=format&fit=max&dpr=2&s=c45f5200fca91ab7106910be4a337033","width":1240},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=605&quality=85&auto=format&fit=max&s=b9bee80aa1a7c58642729f1615b8820c","width":605},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=605&quality=45&auto=format&fit=max&dpr=2&s=96e236134867239df96596f7898994be","width":1210},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=445&quality=85&auto=format&fit=max&s=b9b8cc60d9a2b638260a9a069a6e1012","width":445},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=445&quality=45&auto=format&fit=max&dpr=2&s=fbf30324f897f8d364beec5ff0e54ee1","width":890}]},{"weighting":"immersive","srcSet":[{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=1900&quality=85&auto=format&fit=max&s=c8fd0bfc68dac0d3059a04a5311ca0aa","width":1900},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=1900&quality=45&auto=format&fit=max&dpr=2&s=de9326396653069dc7a1b66b4a0ad9e5","width":3800},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=1300&quality=85&auto=format&fit=max&s=2f674101943b5d2091bcaa199232eec0","width":1300},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=1300&quality=45&auto=format&fit=max&dpr=2&s=ff1877e7df450a0e2f8ae5369f630531","width":2600},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=1140&quality=85&auto=format&fit=max&s=29b26784ff241d645cb456666b8f2c31","width":1140},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=1140&quality=45&auto=format&fit=max&dpr=2&s=9e4da61813f52145b8f174f854ae44cb","width":2280},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=980&quality=85&auto=format&fit=max&s=6942ab3145312198db8fd0e1118a4c72","width":980},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=980&quality=45&auto=format&fit=max&dpr=2&s=03ff76dbe654757473f3ef6e5c822ed2","width":1960},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=740&quality=85&auto=format&fit=max&s=5cc614b0207dbc0db3ed05d04604ca13","width":740},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=740&quality=45&auto=format&fit=max&dpr=2&s=6f0512a6b19b0335c36f9f7892a31fa6","width":1480},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=660&quality=85&auto=format&fit=max&s=ff68cac81ff73fac041ffe692075e573","width":660},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=660&quality=45&auto=format&fit=max&dpr=2&s=81b93ddc2b0f1f5afc0fd027cd3fbb2d","width":1320},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=480&quality=85&auto=format&fit=max&s=1e1f786fa26395735ea470ba7ca172aa","width":480},{"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=480&quality=45&auto=format&fit=max&dpr=2&s=217d79e3481b23b1fc2a030b129364fd","width":960}]}],"data":{"alt":"Logs showing the scaling down of the Flexible API Proxy","caption":"Logs showing the scaling down of the Flexible API Proxy.","credit":"Photograph: Editorial Tools/Guardian"}},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>This small piece of software caused us so many issues we couldn’t wait to turn it off! All we needed to do was update the CNAME record to point directly at the APIV2 load balancer.</p>","elementId":"124a63c7-2469-49c0-a4db-f643fd597ea0"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The team gathered around one computer. The switch was one click away. No one was breathing anymore. Complete silence. Click! And the change was out. Nothing broke! We all relaxed.</p>","elementId":"26e77015-9992-46aa-b884-a212c220d28a"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Unexpectedly, deleting the old MongoDB API was another challenge. While frantically deleting old code we found that our integration tests have never been changed to use the new API. Everything turned red quickly. Fortunately, most of the issues were configuration related and therefore easy to fix. But there were a couple of issues with the PostgreSQL queries that were caught by the tests. Trying to think of things we could have done to avoid this error, we realised that when starting a big piece of work you also have to accept that you’re going to make mistakes.</p>","elementId":"c34046df-cad1-4719-975d-efb01a1398bd"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Everything that came afterwards worked smoothly. We detached all the Mongo instances from OpsManager and then terminated them. The only thing left to do was celebrate. And get some sleep.</p>","elementId":"3a81ce43-6e58-42bf-926d-2a3ff2a935aa"}],"attributes":{"pinned":false,"keyEvent":false,"summary":false},"blockCreatedOn":1543574196000,"blockCreatedOnDisplay":"10.36 GMT","blockLastUpdated":1619182713000,"blockLastUpdatedDisplay":"13.58 BST","blockFirstPublished":1543574196000,"blockFirstPublishedDisplay":"10.36 GMT","blockFirstPublishedDisplayNoTimezone":"10.36","contributors":[],"primaryDateLine":"Fri 30 Nov 2018 10.36 GMT","secondaryDateLine":"Last modified on Fri 23 Apr 2021 13.58 BST"}],"author":{"byline":"Philip McMahon, Maria-Livia Chiorean, Susie Coleman and Akash Askoolum"},"byline":"Philip McMahon, Maria-Livia Chiorean, Susie Coleman and Akash Askoolum","webPublicationDate":"2018-11-30T10:36:36.000Z","webPublicationDateDeprecated":"2018-11-30T10:36:36.000Z","webPublicationDateDisplay":"Fri 30 Nov 2018 10.36 GMT","webPublicationSecondaryDateDisplay":"Last modified on Fri 23 Apr 2021 13.58 BST","editionLongForm":"UK edition","editionId":"UK","pageId":"info/2018/nov/30/bye-bye-mongo-hello-postgres","canonicalUrl":"https://www.theguardian.com/info/2018/nov/30/bye-bye-mongo-hello-postgres","format":{"design":"ArticleDesign","theme":"NewsPillar","display":"StandardDisplay"},"designType":"Article","tags":[{"id":"info/series/engineering-blog","type":"Series","title":"Engineering blog"},{"id":"info/info","type":"Keyword","title":"Information"},{"id":"technology/technology","type":"Keyword","title":"Technology"},{"id":"type/article","type":"Type","title":"Article"},{"id":"profile/philip-mcmahon","type":"Contributor","title":"Philip McMahon","bylineImageUrl":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/1/29/1422531426034/phil.jpg?width=300&quality=85&auto=format&fit=max&s=dc3d05bb70148999e58e102b8306d551"},{"id":"profile/maria-livia-chiorean","type":"Contributor","title":"Maria-Livia Chiorean","twitterHandle":"MariaLiviaCh"},{"id":"profile/susie-coleman","type":"Contributor","title":"Susie Coleman"},{"id":"profile/akash-askoolum","type":"Contributor","title":"Akash Askoolum","twitterHandle":"akash1810"}],"pillar":"news","isLegacyInteractive":false,"isImmersive":false,"sectionLabel":"Information","sectionUrl":"info/info","sectionName":"info","subMetaSectionLinks":[{"url":"/info/info","title":"Information"},{"url":"/info/series/engineering-blog","title":"Engineering blog"}],"subMetaKeywordLinks":[],"shouldHideAds":false,"isAdFreeUser":false,"webURL":"https://www.theguardian.com/info/2018/nov/30/bye-bye-mongo-hello-postgres","linkedData":[{"@type":"NewsArticle","@context":"https://schema.org","@id":"https://www.theguardian.com/info/2018/nov/30/bye-bye-mongo-hello-postgres","publisher":{"@type":"Organization","@context":"https://schema.org","@id":"https://www.theguardian.com#publisher","name":"The Guardian","url":"https://www.theguardian.com/","logo":{"@type":"ImageObject","url":"https://uploads.guim.co.uk/2018/01/31/TheGuardian_AMP.png","width":190,"height":60},"sameAs":["https://www.facebook.com/theguardian","https://twitter.com/guardian","https://www.youtube.com/user/TheGuardian"]},"isAccessibleForFree":true,"isPartOf":{"@type":["CreativeWork","Product"],"name":"The Guardian","productID":"theguardian.com:basic"},"image":["https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctZGVmYXVsdC5wbmc&enable=upscale&s=e4c21a6cbd5b33eebecfc4eeffc43598","https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1200&height=1200&quality=85&auto=format&fit=crop&s=7b45f712cc0c079bd92adcf978fd385b","https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1200&height=900&quality=85&auto=format&fit=crop&s=97fd9cbf84d87e536253a2d27c11e902","https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1200&quality=85&auto=format&fit=max&s=330e6532542c1527af93ddf865db761e"],"author":[{"@type":"Person","name":"Philip McMahon","sameAs":"https://www.theguardian.com/profile/philip-mcmahon"},{"@type":"Person","name":"Maria-Livia Chiorean","sameAs":"https://www.theguardian.com/profile/maria-livia-chiorean"},{"@type":"Person","name":"Susie Coleman","sameAs":"https://www.theguardian.com/profile/susie-coleman"},{"@type":"Person","name":"Akash Askoolum","sameAs":"https://www.theguardian.com/profile/akash-askoolum"}],"datePublished":"2018-11-30T10:36:36.000Z","headline":"Bye bye Mongo, Hello Postgres","dateModified":"2021-04-23T12:58:34.000Z","mainEntityOfPage":"https://www.theguardian.com/info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"@type":"WebPage","@context":"https://schema.org","@id":"https://www.theguardian.com/info/2018/nov/30/bye-bye-mongo-hello-postgres","potentialAction":{"@type":"ViewAction","target":"android-app://com.guardian/https/www.theguardian.com/info/2018/nov/30/bye-bye-mongo-hello-postgres"}}],"openGraphData":{"og:url":"http://www.theguardian.com/info/2018/nov/30/bye-bye-mongo-hello-postgres","article:author":"https://www.theguardian.com/profile/philip-mcmahon,https://www.theguardian.com/profile/maria-livia-chiorean,https://www.theguardian.com/profile/susie-coleman,https://www.theguardian.com/profile/akash-askoolum","og:image:width":"1200","og:image":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctZGVmYXVsdC5wbmc&enable=upscale&s=e4c21a6cbd5b33eebecfc4eeffc43598","al:ios:url":"gnmguardian://info/2018/nov/30/bye-bye-mongo-hello-postgres?contenttype=Article&source=applinks","article:publisher":"https://www.facebook.com/theguardian","og:title":"Bye bye Mongo, Hello Postgres | Digital blog","fb:app_id":"180444840287","article:modified_time":"2021-04-23T12:58:34.000Z","og:image:height":"720","og:description":"In April the Guardian switched off the Mongo DB cluster used to store our content after completing a migration to PostgreSQL on Amazon RDS. This post covers why and how","og:type":"article","al:ios:app_store_id":"409128287","article:section":"Info","article:published_time":"2018-11-30T10:36:36.000Z","article:tag":"Information,Technology","al:ios:app_name":"The Guardian","og:site_name":"the Guardian"},"twitterData":{"twitter:app:id:iphone":"409128287","twitter:app:name:googleplay":"The Guardian","twitter:app:name:ipad":"The Guardian","twitter:card":"summary_large_image","twitter:app:name:iphone":"The Guardian","twitter:app:id:ipad":"409128287","twitter:app:id:googleplay":"com.guardian","twitter:app:url:googleplay":"guardian://www.theguardian.com/info/2018/nov/30/bye-bye-mongo-hello-postgres","twitter:app:url:iphone":"gnmguardian://info/2018/nov/30/bye-bye-mongo-hello-postgres?contenttype=Article&source=twitter","twitter:image":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctZGVmYXVsdC5wbmc&s=26ad28d56fb8b1130e12cd61112ab28c","twitter:site":"@guardian","twitter:app:url:ipad":"gnmguardian://info/2018/nov/30/bye-bye-mongo-hello-postgres?contenttype=Article&source=twitter"},"config":{"switches":{"lightbox":true,"abPrebidKeywords":true,"personaliseSignInGateAfterCheckout":true,"abSignInGateMainVariant":true,"prebidAppnexusUkRow":true,"prebidMagnite":true,"commercialMetrics":true,"prebidTrustx":true,"scAdFreeBanner":false,"adaptiveSite":true,"prebidPermutiveAudience":true,"compareVariantDecision":false,"enableSentryReporting":true,"lazyLoadContainers":true,"ampArticleSwitch":false,"remarketing":true,"articleEndSlot":true,"keyEventsCarousel":true,"registerWithPhone":false,"darkModeWeb":true,"targeting":true,"remoteHeader":true,"slotBodyEnd":true,"ampPrebidOzone":false,"extendedMostPopularFronts":true,"emailInlineInFooter":true,"showNewPrivacyWordingOnEmailSignupEmbeds":true,"prebidAnalytics":true,"extendedMostPopular":true,"ampContentAbTesting":false,"prebidCriteo":true,"okta":true,"imrWorldwide":true,"acast":true,"twitterUwt":true,"abAuxiaSignInGate":false,"abDeferPermutiveLoad":true,"prebidAppnexusInvcode":true,"ampPrebidPubmatic":false,"a9HeaderBidding":true,"prebidAppnexus":true,"enableDiscussionSwitch":true,"prebidXaxis":true,"stickyVideos":true,"interactiveFullHeaderSwitch":true,"discussionAllPageSize":true,"prebidUserSync":true,"audioOnwardJourneySwitch":true,"abMovePermutiveSegmentation":false,"brazeTaylorReport":false,"externalVideoEmbeds":true,"abTheTradeDesk":true,"callouts":true,"sentinelLogger":true,"geoMostPopular":true,"weAreHiring":false,"relatedContent":true,"thirdPartyEmbedTracking":true,"prebidOzone":true,"ampLiveblogSwitch":false,"ampAmazon":false,"prebidAdYouLike":true,"mostViewedFronts":true,"optOutAdvertising":true,"abSignInGateMainControl":true,"googleSearch":true,"abOptOutFrequencyCap":true,"brazeSwitch":true,"prebidKargo":true,"consentManagement":true,"idProfileNavigation":true,"confiantAdVerification":true,"discussionAllowAnonymousRecommendsSwitch":false,"dcrCrosswords":true,"absoluteServerTimes":false,"permutive":true,"comscore":true,"ampPrebidCriteo":false,"prebidTheTradeDesk":true,"loopVideoTest":false,"newsletterOnwards":false,"youtubeIma":true,"webFonts":true,"liveBlogTopSponsorship":true,"abAdBlockAsk":false,"ophan":true,"crosswordSvgThumbnails":true,"prebidTriplelift":true,"prebidPubmatic":true,"serverShareCounts":false,"autoRefresh":true,"enhanceTweets":true,"prebidIndexExchange":true,"prebidOpenx":true,"prebidHeaderBidding":true,"idCookieRefresh":true,"discussionPageSize":true,"smartAppBanner":false,"historyTags":true,"brazeContentCards":true,"remoteBanner":true,"emailSignupRecaptcha":true,"prebidSmart":true,"shouldLoadGoogletag":true,"inizio":true,"europeBetaFront":true},"abTests":{},"googletagUrl":"//securepubads.g.doubleclick.net/tag/js/gpt.js","stage":"PROD","frontendAssetsFullURL":"https://assets.guim.co.uk/","ampIframeUrl":"https://assets.guim.co.uk/data/vendor/2533d5cb94302889e6a8f1b24b5329e7/amp-iframe.html","tones":"","facebookIaAdUnitRoot":"facebook-instant-articles","avatarApiUrl":"https://avatar.theguardian.com","isSplash":false,"isColumn":false,"membershipUrl":"https://membership.theguardian.com","headline":"Bye bye Mongo, Hello Postgres","isImmersive":false,"author":"Philip McMahon,Maria-Livia Chiorean,Susie Coleman,Akash Askoolum","ipsosTag":"guardian","isProd":true,"series":"Engineering blog","toneIds":"","membershipAccess":"","allowUserGeneratedContent":false,"commissioningDesks":"","webPublicationDate":1543574196000,"forecastsapiurl":"/weatherapi/forecast","supportUrl":"https://support.theguardian.com","isNumberedList":false,"commercialBundleUrl":"https://assets.guim.co.uk/commercial/47e59a6f2531251d895a/graun.standalone.commercial.js","idOAuthUrl":"https://oauth.theguardian.com","webTitle":"Bye bye Mongo, Hello Postgres | Digital blog","isPhotoEssay":false,"idWebAppUrl":"https://oauth.theguardian.com","a9PublisherId":"3722","isFront":false,"inBodyInternalLinkCount":3,"googleSearchUrl":"//www.google.co.uk/cse/cse.js","inBodyExternalLinkCount":20,"showRelatedContent":true,"lightboxImages":{"id":"info/2018/nov/30/bye-bye-mongo-hello-postgres","headline":"Bye bye Mongo, Hello Postgres","shouldHideAdverts":false,"standfirst":"<p>In April the Guardian switched off the Mongo DB cluster used to store our content after completing a migration to PostgreSQL on Amazon RDS. This post covers why and how<br></p>","images":[{"caption":"An elephant picking up some greenery.","credit":"Photograph: Michael Sohn/AP","displayCredit":true,"src":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=700&quality=85&auto=format&fit=max&s=34792302523e2d3472d959b33b53d216","srcsets":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1920&quality=85&auto=format&fit=max&s=db91740516f1c02b61b0857d7c3415b5 1920w, https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1225&quality=85&auto=format&fit=max&s=d00c529806b40c7140c36245853d163d 1225w, https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=1065&quality=85&auto=format&fit=max&s=7805a282cc1a14c72d6c1dc594881396 1065w, https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=965&quality=85&auto=format&fit=max&s=43e5f525a0cc139bcd0fbce17ab223d2 965w, https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=725&quality=85&auto=format&fit=max&s=22929422fb0bc95906266a7549a85bc8 725w, https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=645&quality=85&auto=format&fit=max&s=26d07d009cc2e95d80ce5b7292199194 645w, https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/master/3817.jpg?width=465&quality=85&auto=format&fit=max&s=aebbd759322ec9018410ff72a1bff7c3 465w","sizes":"(min-width: 1300px) 1920px, (min-width: 1140px) 1225px, (min-width: 980px) 1065px, (min-width: 740px) 965px, (min-width: 660px) 725px, (min-width: 480px) 645px, 465px","ratio":1.6675404106596767,"role":"None","parentContentId":"info/2018/nov/30/bye-bye-mongo-hello-postgres","id":"info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"caption":"Hot weather: good for fountain dancing, bad for data centres.","credit":"Photograph: Sarah Lee/Guardian","displayCredit":true,"src":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=700&quality=85&auto=format&fit=max&s=be0584ad603a52d0a8b6b587829ccfaf","srcsets":"https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=1920&quality=85&auto=format&fit=max&s=c2b60a2ae8e6796eea6d8063ad60b648 1920w, https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=1225&quality=85&auto=format&fit=max&s=2061cff0db3a7fad5e170a4b53c13d3b 1225w, https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=1065&quality=85&auto=format&fit=max&s=115b60d8dfd50604c5f3b2c6622cccac 1065w, https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=965&quality=85&auto=format&fit=max&s=ca01d486a1ffd9f367495ba491d2938d 965w, https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=725&quality=85&auto=format&fit=max&s=0e34d712cd31303e6aac82a258ebc478 725w, https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=645&quality=85&auto=format&fit=max&s=43de0622285c48979a3585ff51a16425 645w, https://i.guim.co.uk/img/media/48189c1117bb212716a843c9aceb74ef1387da1d/140_264_4547_2727/master/4547.jpg?width=465&quality=85&auto=format&fit=max&s=858e54d6f418bf260198f7d6fd9a4c04 465w","sizes":"(min-width: 1300px) 1920px, (min-width: 1140px) 1225px, (min-width: 980px) 1065px, (min-width: 740px) 965px, (min-width: 660px) 725px, (min-width: 480px) 645px, 465px","ratio":1.6674000733406673,"role":"None","parentContentId":"info/2018/nov/30/bye-bye-mongo-hello-postgres","id":"info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"caption":"When clocks get out of sync, networking becomes a nightmare.","credit":"Photograph: Alamy Stock Photo","displayCredit":true,"src":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=700&quality=85&auto=format&fit=max&s=9251d909a24cf1165dff1b2ebff329da","srcsets":"https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=1920&quality=85&auto=format&fit=max&s=737ac1f27757e638e96e462b6a7f63d1 1920w, https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=1225&quality=85&auto=format&fit=max&s=7c4076da97dc1fa11c4585a1df462bc1 1225w, https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=1065&quality=85&auto=format&fit=max&s=258aca319597853bc14876c6cf9d5962 1065w, https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=965&quality=85&auto=format&fit=max&s=a86488e74a298cc98bc44d3cc7b1623f 965w, https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=725&quality=85&auto=format&fit=max&s=a8d63b9728e80e56db5a3ecf084e407f 725w, https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=645&quality=85&auto=format&fit=max&s=8d9fd97702b17667224c6455d60452ae 645w, https://i.guim.co.uk/img/media/3f1ee5ce108720c858c673e56bfe19da53af8a50/0_130_5019_3011/master/5019.jpg?width=465&quality=85&auto=format&fit=max&s=a3137591e28cda323370a715de5fedc7 465w","sizes":"(min-width: 1300px) 1920px, (min-width: 1140px) 1225px, (min-width: 980px) 1065px, (min-width: 740px) 965px, (min-width: 660px) 725px, (min-width: 480px) 645px, 465px","ratio":1.6668880770508137,"role":"None","parentContentId":"info/2018/nov/30/bye-bye-mongo-hello-postgres","id":"info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"caption":"Postgres takes a bite out of mongo.","credit":"Photograph: Bernd Thissen/AFP/Getty Images","displayCredit":true,"src":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=700&quality=85&auto=format&fit=max&s=7d30ca7c6b7a322ed993e9524252d62a","srcsets":"https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=1920&quality=85&auto=format&fit=max&s=5e4a76999493edd3364f8b67a3841e75 1920w, https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=1225&quality=85&auto=format&fit=max&s=7946454ad2def5df033577f453007edd 1225w, https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=1065&quality=85&auto=format&fit=max&s=605f945c531d2b9905297b002b8af29a 1065w, https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=965&quality=85&auto=format&fit=max&s=7928dd98a5bce172770bceac187cfd60 965w, https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=725&quality=85&auto=format&fit=max&s=b3d2f2d5983c45c936d2c5b1a988542e 725w, https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=645&quality=85&auto=format&fit=max&s=e73692bc5d3fa4f51d8b61d38e0126dd 645w, https://i.guim.co.uk/img/media/ddd421d5de76ec12d96b8d741db76810b0561933/0_164_4667_2802/master/4667.jpg?width=465&quality=85&auto=format&fit=max&s=6fea16500063676303f832561754171e 465w","sizes":"(min-width: 1300px) 1920px, (min-width: 1140px) 1225px, (min-width: 980px) 1065px, (min-width: 740px) 965px, (min-width: 660px) 725px, (min-width: 480px) 645px, 465px","ratio":1.6655960028551036,"role":"None","parentContentId":"info/2018/nov/30/bye-bye-mongo-hello-postgres","id":"info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"caption":"Migrating to postgres for the winter.","credit":"Photograph: Anna-Maria Fjellström","displayCredit":true,"src":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=700&quality=85&auto=format&fit=max&s=7515bdbf7dbe8d8036aacee3fffa1070","srcsets":"https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=1920&quality=85&auto=format&fit=max&s=1eec7a8a5417bbd10abbd38b75c7f9c5 1920w, https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=1225&quality=85&auto=format&fit=max&s=1359c8a3165ac0b2c8f2a85ca336cdb8 1225w, https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=1065&quality=85&auto=format&fit=max&s=95a98ff6b9e2425253033fb2791b7b02 1065w, https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=965&quality=85&auto=format&fit=max&s=b47afedc3cac127f3fb800cee9a0cff8 965w, https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=725&quality=85&auto=format&fit=max&s=ae859b3537984e0ed7127cceb5c6179e 725w, https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=645&quality=85&auto=format&fit=max&s=c00655a20ba1ce0573578bb10a9513b3 645w, https://i.guim.co.uk/img/media/5c2a6f921775553760a8f2b4ca5249853aaf40dc/0_285_4272_2563/master/4272.jpg?width=465&quality=85&auto=format&fit=max&s=3555230714abf11864d8ecedf38f9b18 465w","sizes":"(min-width: 1300px) 1920px, (min-width: 1140px) 1225px, (min-width: 980px) 1065px, (min-width: 740px) 965px, (min-width: 660px) 725px, (min-width: 480px) 645px, 465px","ratio":1.666796722590714,"role":"None","parentContentId":"info/2018/nov/30/bye-bye-mongo-hello-postgres","id":"info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"caption":"Dashboard showing progress of the migration","credit":"Photograph: Editorial Tools/Guardian","displayCredit":true,"src":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=700&quality=85&auto=format&fit=max&s=b5356c5bd2c8bb6a0095e547a9338e6a","srcsets":"https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=1920&quality=85&auto=format&fit=max&s=ce5f2d68660bdb83caba5cb19ab32753 1920w, https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=1225&quality=85&auto=format&fit=max&s=e3cd26c0b7c2543dcc7a57e95acb75a1 1225w, https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=1065&quality=85&auto=format&fit=max&s=1dfc44cc39c57f0c666b0bd02cf497a0 1065w, https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=965&quality=85&auto=format&fit=max&s=04a2fd7f630be133c5059b32a2429b4f 965w, https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=725&quality=85&auto=format&fit=max&s=7109a3e6c348f00997165af7565ffae4 725w, https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=645&quality=85&auto=format&fit=max&s=7fc9f50c8fedc49de4137aea8910dc1a 645w, https://i.guim.co.uk/img/media/a0d724443096cfcc93f93006a950812ed4759e7d/0_71_3360_1533/master/3360.png?width=465&quality=85&auto=format&fit=max&s=b0675a2d11d2b96e76afd98b25465812 465w","sizes":"(min-width: 1300px) 1920px, (min-width: 1140px) 1225px, (min-width: 980px) 1065px, (min-width: 740px) 965px, (min-width: 660px) 725px, (min-width: 480px) 645px, 465px","ratio":2.191780821917808,"role":"None","parentContentId":"info/2018/nov/30/bye-bye-mongo-hello-postgres","id":"info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"caption":"Mongo to Postgres migration: the proxy.","credit":"Photograph: Maria Livia Chiorean","displayCredit":true,"src":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=700&quality=85&auto=format&fit=max&s=2c9aa6aba6644278f0b2b521ce47cdec","srcsets":"https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=1920&quality=85&auto=format&fit=max&s=cbab37420415f20062948d1625908d16 1920w, https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=1225&quality=85&auto=format&fit=max&s=eded87476bae12f6e2d6c3e74a0ce49a 1225w, https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=1065&quality=85&auto=format&fit=max&s=1030aa7a4b62b7ec8e2d340aa7e5a339 1065w, https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=965&quality=85&auto=format&fit=max&s=3961fe91443cd48da788af1cd7007154 965w, https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=725&quality=85&auto=format&fit=max&s=f1e4daca72fbd59ccb7157fde1cde599 725w, https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=645&quality=85&auto=format&fit=max&s=dac6c370a5dfe7a5fefcde42cb796894 645w, https://i.guim.co.uk/img/media/44cb77a97c4dcdbcf58e736214f10306b2d8f4e8/0_265_2725_1635/master/2725.jpg?width=465&quality=85&auto=format&fit=max&s=abada2633359ae18f2832aeef64c0e4f 465w","sizes":"(min-width: 1300px) 1920px, (min-width: 1140px) 1225px, (min-width: 980px) 1065px, (min-width: 740px) 965px, (min-width: 660px) 725px, (min-width: 480px) 645px, 465px","ratio":1.6666666666666667,"role":"None","parentContentId":"info/2018/nov/30/bye-bye-mongo-hello-postgres","id":"info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"caption":"Logs showing the scaling down of the Flexible API Proxy.","credit":"Photograph: Editorial Tools/Guardian","displayCredit":true,"src":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=700&quality=85&auto=format&fit=max&s=08a5e6d9fcc209e2f3aafe9121e4c2e9","srcsets":"https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=1920&quality=85&auto=format&fit=max&s=85f67392cdffaafdbb48231083945def 1920w, https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=1225&quality=85&auto=format&fit=max&s=4a5e5ada60e3786784468fc06f4a8706 1225w, https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=1065&quality=85&auto=format&fit=max&s=4cbc1408bd40a1e42dcd7a11861f4303 1065w, https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=965&quality=85&auto=format&fit=max&s=c4871ff4db38ac71d76f113880e25a01 965w, https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=725&quality=85&auto=format&fit=max&s=ac07c4c1848ace3b5dd9473aa2555a07 725w, https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=645&quality=85&auto=format&fit=max&s=2da720c7a3cb108b79b0a781ced259ce 645w, https://i.guim.co.uk/img/media/53bfd0107a6d069ac575513ed3f6b0ccb0db0597/0_0_2250_1350/master/2250.png?width=465&quality=85&auto=format&fit=max&s=1b9da513666712719ca56883d2c18198 465w","sizes":"(min-width: 1300px) 1920px, (min-width: 1140px) 1225px, (min-width: 980px) 1065px, (min-width: 740px) 965px, (min-width: 660px) 725px, (min-width: 480px) 645px, 465px","ratio":1.6666666666666667,"role":"None","parentContentId":"info/2018/nov/30/bye-bye-mongo-hello-postgres","id":"info/2018/nov/30/bye-bye-mongo-hello-postgres"}]},"googleSearchId":"007466294097402385199:m2ealvuxh1i","shouldHideReaderRevenue":false,"idUrl":"https://profile.theguardian.com","hasSurveyAd":false,"omnitureAmpAccount":"guardiangu-thirdpartyapps","dfpAdUnitRoot":"theguardian.com","host":"https://www.theguardian.com","blogIds":"","sectionName":"Info","hasMultipleVideosInPage":false,"hasShowcaseMainElement":false,"googleRecaptchaSiteKey":"6LdzlmsdAAAAALFH63cBVagSFPuuHXQ9OfpIDdMc","fbAppId":"180444840287","isContent":true,"shortUrlId":"/p/9dz52","dfpAccountId":"59666047","plistaPublicApiKey":"462925f4f131001fd974bebe","wordCount":3479,"hasLiveBlogTopAd":false,"dcrSentryDsn":"https://1937ab71c8804b2b8438178dfdd6468f@sentry.io/1377847","cardStyle":"news","adUnit":"/59666047/theguardian.com/info/article/ng","discussionApiUrl":"https://discussion.theguardian.com/discussion-api","isSensitive":false,"ophanEmbedJsUrl":"//j.ophan.co.uk/ophan.embed","edition":"UK","brazeApiKey":"7f28c639-8bda-48ff-a3f6-24345abfc07c","blogs":"","discussionApiClientHeader":"nextgen","section":"info","userAttributesApiUrl":"https://members-data-api.theguardian.com/user-attributes","videoDuration":0,"dfpHost":"pubads.g.doubleclick.net","weatherapiurl":"/weatherapi/city","sentryPublicApiKey":"344003a8d11c41d8800fbad8383fdc50","shortUrl":"https://www.theguardian.com/p/9dz52","thumbnail":"https://i.guim.co.uk/img/media/4842b3009287b04d043eb1b627ee8fa5e6e77096/0_19_3817_2289/500.jpg?quality=85&auto=format&fit=max&s=2c6c2b8338efc18c61fb9a5408791513","pillar":"News","pageId":"info/2018/nov/30/bye-bye-mongo-hello-postgres","references":[{"rich-link":"https://www.theguardian.com/info/ng-interactive/2021/jun/25/techscape-sign-up"}],"beaconUrl":"//phar.gu-web.net","commentable":false,"discussionD2Uid":"zHoBy6HNKsk","ophanJsUrl":"//j.ophan.co.uk/ophan.ng","contributorBio":"","keywordIds":"info/info,technology/technology","contentType":"Article","isDev":false,"isHosted":false,"isAdFree":false,"stripePublicToken":"pk_live_2O6zPMHXNs2AGea4bAmq5R7Z","omnitureAccount":"guardiangu-network","locationapiurl":"/weatherapi/locations?query=","authorIds":"profile/philip-mcmahon,profile/maria-livia-chiorean,profile/susie-coleman,profile/akash-askoolum","isPaidContent":false,"hasYouTubeAtom":false,"externalEmbedHost":"https://embed.theguardian.com","thirdPartyAppsAccount":"guardiangu-thirdpartyapps","ajaxUrl":"https://api.nextgen.guardianapps.co.uk","byline":"Philip McMahon, Maria-Livia Chiorean, Susie Coleman and Akash Askoolum","keywords":"Information,Technology","contentId":"info/2018/nov/30/bye-bye-mongo-hello-postgres","nonKeywordTagIds":"info/series/engineering-blog,type/article,profile/philip-mcmahon,profile/maria-livia-chiorean,profile/susie-coleman,profile/akash-askoolum","mobileAppsAdUnitRoot":"beta-guardian-app","hasPageSkin":false,"requiresMembershipAccess":false,"seriesTags":"Engineering blog","revisionNumber":"DEV","seriesId":"info/series/engineering-blog","optimizeEpicUrl":"https://support.theguardian.com/epic/control/index.html","assetsPath":"https://assets.guim.co.uk/","mmaUrl":"https://manage.theguardian.com","isLive":false,"richLink":"/info/ng-interactive/2021/jun/25/techscape-sign-up","campaigns":[],"isLiveBlog":false,"pageCode":"5056481","avatarImagesUrl":"https://avatar.guim.co.uk","publication":"theguardian.com","sentryHost":"app.getsentry.com/35463","buildNumber":"DEV","atomTypes":{"review":false,"guide":true,"audio":false,"explainer":false,"interactive":false,"profile":false,"chart":false,"quizz":false,"commonsdivision":false,"timeline":false,"media":false,"qanda":false},"userBenefitsApiUrl":"https://user-benefits.guardianapis.com/benefits/me","sharedAdTargeting":{"se":["engineering-blog"],"ct":"article","su":["0"],"edition":"uk","p":"ng","k":["info","technology"],"sh":"https://www.theguardian.com/p/9dz52","co":["akash-askoolum","maria-livia-chiorean","philip-mcmahon","susie-coleman"],"url":"/info/2018/nov/30/bye-bye-mongo-hello-postgres"},"onwardWebSocket":"ws://api.nextgen.guardianapps.co.uk/recently-published","productionOffice":"Uk","shouldHideAdverts":false,"idApiUrl":"https://idapi.theguardian.com","pbIndexSites":[{"bp":"D","id":208247},{"bp":"M","id":213519},{"bp":"T","id":215454}],"googletagJsUrl":"//securepubads.g.doubleclick.net/tag/js/gpt.js","atoms":["cfee56d3-053e-46e7-9d03-ec0704b3d476"],"calloutsUrl":"https://callouts.guardianapis.com/formstack-campaign/submit","isPreview":false},"guardianBaseURL":"https://www.theguardian.com","contentType":"Article","hasRelated":true,"hasStoryPackage":false,"beaconURL":"//phar.gu-web.net","isCommentable":false,"commercialProperties":{"US":{"adTargeting":[{"name":"url","value":"/info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"name":"su","value":["0"]},{"name":"k","value":["info","technology"]},{"name":"edition","value":"us"},{"name":"ct","value":"article"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"},{"name":"sh","value":"https://www.theguardian.com/p/9dz52"},{"name":"co","value":["akash-askoolum","maria-livia-chiorean","philip-mcmahon","susie-coleman"]}]},"AU":{"adTargeting":[{"name":"url","value":"/info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"name":"su","value":["0"]},{"name":"ct","value":"article"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"},{"name":"k","value":["info","technology"]},{"name":"edition","value":"au"},{"name":"sh","value":"https://www.theguardian.com/p/9dz52"},{"name":"co","value":["akash-askoolum","maria-livia-chiorean","philip-mcmahon","susie-coleman"]}]},"UK":{"adTargeting":[{"name":"url","value":"/info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"name":"su","value":["0"]},{"name":"k","value":["info","technology"]},{"name":"edition","value":"uk"},{"name":"ct","value":"article"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"},{"name":"sh","value":"https://www.theguardian.com/p/9dz52"},{"name":"co","value":["akash-askoolum","maria-livia-chiorean","philip-mcmahon","susie-coleman"]}]},"INT":{"adTargeting":[{"name":"url","value":"/info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"name":"su","value":["0"]},{"name":"k","value":["info","technology"]},{"name":"ct","value":"article"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"},{"name":"sh","value":"https://www.theguardian.com/p/9dz52"},{"name":"co","value":["akash-askoolum","maria-livia-chiorean","philip-mcmahon","susie-coleman"]},{"name":"edition","value":"int"}]},"EUR":{"adTargeting":[{"name":"url","value":"/info/2018/nov/30/bye-bye-mongo-hello-postgres"},{"name":"su","value":["0"]},{"name":"k","value":["info","technology"]},{"name":"ct","value":"article"},{"name":"edition","value":"eur"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"},{"name":"sh","value":"https://www.theguardian.com/p/9dz52"},{"name":"co","value":["akash-askoolum","maria-livia-chiorean","philip-mcmahon","susie-coleman"]}]}},"pageType":{"hasShowcaseMainElement":false,"isFront":false,"isLiveblog":false,"isMinuteArticle":false,"isPaidContent":false,"isPreview":false,"isSensitive":false},"trailText":"In April the Guardian switched off the Mongo DB cluster used to store our content after completing a migration to PostgreSQL on Amazon RDS. This post covers why and how","nav":{"currentUrl":"/info","pillars":[{"title":"News","url":"/","longTitle":"Headlines","iconName":"home","children":[{"title":"UK","url":"/uk-news","longTitle":"UK news","children":[{"title":"UK politics","url":"/politics"},{"title":"Education","url":"/education","children":[{"title":"Schools","url":"/education/schools"},{"title":"Teachers","url":"/teacher-network"},{"title":"Universities","url":"/education/universities"},{"title":"Students","url":"/education/students"}]},{"title":"Media","url":"/media"},{"title":"Society","url":"/society"},{"title":"Law","url":"/law"},{"title":"Scotland","url":"/uk/scotland"},{"title":"Wales","url":"/uk/wales"},{"title":"Northern Ireland","url":"/uk/northernireland"}]},{"title":"US politics","url":"/us-news/us-politics"},{"title":"World","url":"/world","longTitle":"World news","children":[{"title":"Europe","url":"/world/europe-news"},{"title":"US","url":"/us-news","longTitle":"US news"},{"title":"Americas","url":"/world/americas"},{"title":"Asia","url":"/world/asia"},{"title":"Australia","url":"/australia-news","longTitle":"Australia news"},{"title":"Middle East","url":"/world/middleeast"},{"title":"Africa","url":"/world/africa"},{"title":"Inequality","url":"/inequality"},{"title":"Global development","url":"/global-development"}]},{"title":"Climate crisis","url":"/environment/climate-crisis"},{"title":"Middle East","url":"/world/middleeast"},{"title":"Ukraine","url":"/world/ukraine"},{"title":"Football","url":"/football","children":[{"title":"Live scores","url":"/football/live","longTitle":"football/live"},{"title":"Tables","url":"/football/tables","longTitle":"football/tables"},{"title":"Fixtures","url":"/football/fixtures","longTitle":"football/fixtures"},{"title":"Results","url":"/football/results","longTitle":"football/results"},{"title":"Competitions","url":"/football/competitions","longTitle":"football/competitions"},{"title":"Clubs","url":"/football/teams","longTitle":"football/teams"}]},{"title":"Newsletters","url":"/email-newsletters"},{"title":"Business","url":"/business","children":[{"title":"Economics","url":"/business/economics"},{"title":"Banking","url":"/business/banking"},{"title":"Money","url":"/money","children":[{"title":"Property","url":"/money/property"},{"title":"Pensions","url":"/money/pensions"},{"title":"Savings","url":"/money/savings"},{"title":"Borrowing","url":"/money/debt"},{"title":"Careers","url":"/money/work-and-careers"}]},{"title":"Markets","url":"/business/stock-markets"},{"title":"Project Syndicate","url":"/business/series/project-syndicate-economists"},{"title":"B2B","url":"/business-to-business"},{"title":"Retail","url":"/business/retail"}]},{"title":"Environment","url":"/environment","children":[{"title":"Climate crisis","url":"/environment/climate-crisis"},{"title":"Wildlife","url":"/environment/wildlife"},{"title":"Energy","url":"/environment/energy"},{"title":"Pollution","url":"/environment/pollution"}]},{"title":"UK politics","url":"/politics"},{"title":"Society","url":"/society"},{"title":"Science","url":"/science"},{"title":"Tech","url":"/technology"},{"title":"Global development","url":"/global-development"},{"title":"Obituaries","url":"/obituaries"}]},{"title":"Opinion","url":"/commentisfree","longTitle":"Opinion home","iconName":"home","children":[{"title":"The Guardian view","url":"/profile/editorial"},{"title":"Columnists","url":"/index/contributors"},{"title":"Cartoons","url":"/tone/cartoons"},{"title":"Opinion videos","url":"/type/video+tone/comment"},{"title":"Letters","url":"/tone/letters"}]},{"title":"Sport","url":"/sport","longTitle":"Sport home","iconName":"home","children":[{"title":"Football","url":"/football","children":[{"title":"Live scores","url":"/football/live","longTitle":"football/live"},{"title":"Tables","url":"/football/tables","longTitle":"football/tables"},{"title":"Fixtures","url":"/football/fixtures","longTitle":"football/fixtures"},{"title":"Results","url":"/football/results","longTitle":"football/results"},{"title":"Competitions","url":"/football/competitions","longTitle":"football/competitions"},{"title":"Clubs","url":"/football/teams","longTitle":"football/teams"}]},{"title":"Cricket","url":"/sport/cricket"},{"title":"Rugby union","url":"/sport/rugby-union"},{"title":"Tennis","url":"/sport/tennis"},{"title":"Cycling","url":"/sport/cycling"},{"title":"F1","url":"/sport/formulaone"},{"title":"Golf","url":"/sport/golf"},{"title":"Boxing","url":"/sport/boxing"},{"title":"Rugby league","url":"/sport/rugbyleague"},{"title":"Racing","url":"/sport/horse-racing"},{"title":"US sports","url":"/sport/us-sport"}]},{"title":"Culture","url":"/culture","longTitle":"Culture home","iconName":"home","children":[{"title":"Film","url":"/film"},{"title":"Music","url":"/music"},{"title":"TV & radio","url":"/tv-and-radio"},{"title":"Books","url":"/books"},{"title":"Art & design","url":"/artanddesign"},{"title":"Stage","url":"/stage"},{"title":"Games","url":"/games"},{"title":"Classical","url":"/music/classicalmusicandopera"}]},{"title":"Lifestyle","url":"/lifeandstyle","longTitle":"Lifestyle home","iconName":"home","children":[{"title":"The Filter","url":"/uk/thefilter"},{"title":"Fashion","url":"/fashion"},{"title":"Food","url":"/food"},{"title":"Recipes","url":"/tone/recipes"},{"title":"Travel","url":"/travel","children":[{"title":"UK","url":"/travel/uk"},{"title":"Europe","url":"/travel/europe"},{"title":"US","url":"/travel/usa"}]},{"title":"Health & fitness","url":"/lifeandstyle/health-and-wellbeing"},{"title":"Women","url":"/lifeandstyle/women"},{"title":"Men","url":"/lifeandstyle/men"},{"title":"Love & sex","url":"/lifeandstyle/love-and-sex"},{"title":"Beauty","url":"/fashion/beauty"},{"title":"Home & garden","url":"/lifeandstyle/home-and-garden"},{"title":"Money","url":"/money","children":[{"title":"Property","url":"/money/property"},{"title":"Pensions","url":"/money/pensions"},{"title":"Savings","url":"/money/savings"},{"title":"Borrowing","url":"/money/debt"},{"title":"Careers","url":"/money/work-and-careers"}]},{"title":"Cars","url":"/technology/motoring"}]}],"otherLinks":[{"title":"The Guardian app","url":"https://app.adjust.com/16xt6hai"},{"title":"Video","url":"/video"},{"title":"Podcasts","url":"/podcasts"},{"title":"Pictures","url":"/inpictures"},{"title":"Newsletters","url":"/email-newsletters"},{"title":"Today's paper","url":"/theguardian","children":[{"title":"Obituaries","url":"/obituaries"},{"title":"G2","url":"/theguardian/g2"},{"title":"Journal","url":"/theguardian/journal"},{"title":"Saturday","url":"/theguardian/saturday"}]},{"title":"Inside the Guardian","url":"https://www.theguardian.com/insidetheguardian"},{"title":"The Observer","url":"/observer","children":[{"title":"Comment","url":"/theobserver/news/comment"},{"title":"The New Review","url":"/theobserver/new-review"},{"title":"Observer Magazine","url":"/theobserver/magazine"},{"title":"Observer Food Monthly","url":"/theobserver/foodmonthly"}]},{"title":"Guardian Weekly","url":"https://www.theguardian.com/weekly?INTCMP=gdnwb_mawns_editorial_gweekly_GW_TopNav_UK"},{"title":"Crosswords","url":"/crosswords","children":[{"title":"Blog","url":"/crosswords/crossword-blog"},{"title":"Quick","url":"/crosswords/series/quick"},{"title":"Speedy","url":"/crosswords/series/speedy"},{"title":"Quick cryptic","url":"/crosswords/series/quick-cryptic"},{"title":"Everyman","url":"/crosswords/series/everyman"},{"title":"Quiptic","url":"/crosswords/series/quiptic"},{"title":"Cryptic","url":"/crosswords/series/cryptic"},{"title":"Prize","url":"/crosswords/series/prize"},{"title":"Azed","url":"/crosswords/series/azed"},{"title":"Genius","url":"/crosswords/series/genius"},{"title":"Weekend","url":"/crosswords/series/weekend-crossword"},{"title":"Special","url":"/crosswords/series/special"}]},{"title":"Wordiply","url":"https://www.wordiply.com"},{"title":"Corrections","url":"/theguardian/series/corrections-and-clarifications"}],"brandExtensions":[{"title":"Search jobs","url":"https://jobs.theguardian.com"},{"title":"Hire with Guardian Jobs","url":"https://recruiters.theguardian.com/?utm_source=gdnwb&utm_medium=navbar&utm_campaign=Guardian_Navbar_Recruiters&CMP_TU=trdmkt&CMP_BUNIT=jobs"},{"title":"Holidays","url":"https://holidays.theguardian.com?INTCMP=holidays_uk_web_newheader"},{"title":"Live events","url":"https://www.theguardian.com/guardian-live-events?INTCMP=live_uk_header_dropdown"},{"title":"About Us","url":"/about"},{"title":"Digital Archive","url":"https://theguardian.newspapers.com"},{"title":"Guardian Print Shop","url":"/artanddesign/series/gnm-print-sales"},{"title":"Patrons","url":"https://patrons.theguardian.com/?INTCMP=header_patrons"},{"title":"Guardian Licensing","url":"https://licensing.theguardian.com/"}],"readerRevenueLinks":{"header":{"contribute":"https://support.theguardian.com/contribute?INTCMP=header_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=header_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=header_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=header_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_supporter_cta%22%7D"},"footer":{"contribute":"https://support.theguardian.com/contribute?INTCMP=footer_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=footer_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=footer_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=footer_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_supporter_cta%22%7D"},"sideMenu":{"contribute":"https://support.theguardian.com/contribute?INTCMP=side_menu_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22side_menu_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=side_menu_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22side_menu_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=side_menu_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22side_menu_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=mobilenav_print_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22mobilenav_print_cta%22%7D"},"ampHeader":{"contribute":"https://support.theguardian.com/contribute?INTCMP=header_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=header_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=amp_header_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22amp_header_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=header_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_supporter_cta%22%7D"},"ampFooter":{"contribute":"https://support.theguardian.com/contribute?INTCMP=amp_footer_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22amp_footer_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=amp_footer_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22amp_footer_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=footer_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=amp_footer_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22amp_footer_supporter_cta%22%7D"}}},"showBottomSocialButtons":true,"pageFooter":{"footerLinks":[[{"text":"About us","url":"/about","dataLinkName":"uk : footer : about us","extraClasses":""},{"text":"Help","url":"https://manage.theguardian.com/help-centre","dataLinkName":"uk : footer : tech feedback","extraClasses":"js-tech-feedback-report"},{"text":"Complaints & corrections","url":"/info/complaints-and-corrections","dataLinkName":"complaints","extraClasses":""},{"text":"SecureDrop","url":"https://www.theguardian.com/securedrop","dataLinkName":"securedrop","extraClasses":""},{"text":"Work for us","url":"https://workforus.theguardian.com","dataLinkName":"uk : footer : work for us","extraClasses":""},{"text":"Privacy policy","url":"/info/privacy","dataLinkName":"privacy","extraClasses":""},{"text":"Cookie policy","url":"/info/cookies","dataLinkName":"cookie","extraClasses":""},{"text":"Terms & conditions","url":"/help/terms-of-service","dataLinkName":"terms","extraClasses":""},{"text":"Contact us","url":"/help/contact-us","dataLinkName":"uk : footer : contact us","extraClasses":""}],[{"text":"All topics","url":"/index/subjects/a","dataLinkName":"uk : footer : all topics","extraClasses":""},{"text":"All writers","url":"/index/contributors","dataLinkName":"uk : footer : all contributors","extraClasses":""},{"text":"Modern Slavery Act","url":"https://uploads.guim.co.uk/2024/09/04/Modern_Slavery_Statement_2024_.pdf","dataLinkName":"uk : footer : modern slavery act statement","extraClasses":""},{"text":"Tax strategy","url":"https://uploads.guim.co.uk/2024/08/27/TAX_STRATEGY_FOR_THE_YEAR_ENDED_31_MARCH_2025.pdf","dataLinkName":"uk : footer : tax strategy","extraClasses":""},{"text":"Digital newspaper archive","url":"https://theguardian.newspapers.com","dataLinkName":"digital newspaper archive","extraClasses":""},{"text":"Facebook","url":"https://www.facebook.com/theguardian","dataLinkName":"uk : footer : facebook","extraClasses":""},{"text":"YouTube","url":"https://www.youtube.com/user/TheGuardian","dataLinkName":"uk : footer : youtube","extraClasses":""},{"text":"Instagram","url":"https://www.instagram.com/guardian","dataLinkName":"uk : footer : instagram","extraClasses":""},{"text":"LinkedIn","url":"https://www.linkedin.com/company/theguardian","dataLinkName":"uk : footer : linkedin","extraClasses":""},{"text":"Newsletters","url":"/email-newsletters?INTCMP=DOTCOM_FOOTER_NEWSLETTER_UK","dataLinkName":"uk : footer : newsletters","extraClasses":""}],[{"text":"Advertise with us","url":"https://advertising.theguardian.com","dataLinkName":"uk : footer : advertise with us","extraClasses":""},{"text":"Guardian Labs","url":"/guardian-labs","dataLinkName":"uk : footer : guardian labs","extraClasses":""},{"text":"Search jobs","url":"https://jobs.theguardian.com","dataLinkName":"uk : footer : jobs","extraClasses":""},{"text":"Patrons","url":"https://patrons.theguardian.com?INTCMP=footer_patrons","dataLinkName":"uk : footer : patrons","extraClasses":""}]]},"publication":"theguardian.com","shouldHideReaderRevenue":false,"slotMachineFlags":"","contributionsServiceUrl":"https://contributions.guardianapis.com","isSpecialReport":false,"showTableOfContents":false,"lang":"en","isRightToLeftLang":false}