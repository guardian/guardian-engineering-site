{"version":3,"headline":"Pondering some Scala performance questions","standfirst":"<p>The Scala compiler is a fascinating tool which powers a large proportion of the Guardian’s infrastructure. But sometimes the work that it does can seem somewhat mysterious. Guardian Scala developer Paul Roberts explores in detail one aspect of this mystery and looks at how understanding it can help us write code more effectively</p>","webTitle":"Pondering some Scala performance questions","mainMediaElements":[{"displayCredit":true,"_type":"model.dotcomrendering.pageElements.ImageBlockElement","role":"inline","media":{"allImages":[{"index":0,"fields":{"height":"1200","width":"2000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/2000.jpg"},{"index":1,"fields":{"height":"600","width":"1000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/1000.jpg"},{"index":2,"fields":{"height":"300","width":"500"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/500.jpg"},{"index":3,"fields":{"height":"84","width":"140"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/140.jpg"},{"index":4,"fields":{"height":"2700","width":"4500"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/4500.jpg"},{"index":5,"fields":{"isMaster":"true","height":"2700","width":"4500"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg"}]},"elementId":"7f56904e-888c-4c67-b4b0-9ab1354ed7e9","imageSources":[{"weighting":"inline","srcSet":[{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=620&quality=85&auto=format&fit=max&s=3b274ede65e70392d2c685531126361c","width":620},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=d351934d427b7f540f52400ec11ec2cf","width":1240},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=700&quality=85&auto=format&fit=max&s=1367fde7d89541245b9c968b6a0cbbca","width":700},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=700&quality=45&auto=format&fit=max&dpr=2&s=029cd5216d211934f98687b6be02cecb","width":1400},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=620&quality=85&auto=format&fit=max&s=3b274ede65e70392d2c685531126361c","width":620},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=d351934d427b7f540f52400ec11ec2cf","width":1240},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=645&quality=85&auto=format&fit=max&s=2a82ed0ad90a2932608493f5756d4f50","width":645},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=645&quality=45&auto=format&fit=max&dpr=2&s=c9be44a472c290938f006160e01a10aa","width":1290},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=465&quality=85&auto=format&fit=max&s=ccec66001607c3222cff9c2eb8794a12","width":465},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=465&quality=45&auto=format&fit=max&dpr=2&s=210be6a18c4539283521266d0888ab19","width":930}]},{"weighting":"thumbnail","srcSet":[]},{"weighting":"supporting","srcSet":[]},{"weighting":"showcase","srcSet":[{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1020&quality=85&auto=format&fit=max&s=f594b72bd306089d0fc3321fe6b43efb","width":1020},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1020&quality=45&auto=format&fit=max&dpr=2&s=dd1754abe7b11b44e2be5407e671e161","width":2040},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=940&quality=85&auto=format&fit=max&s=7dc90fc04572027ec385d32ef13f74ee","width":940},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=940&quality=45&auto=format&fit=max&dpr=2&s=68e1b4c0c684d2d50870ed17a7bfa4d6","width":1880},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=700&quality=85&auto=format&fit=max&s=1367fde7d89541245b9c968b6a0cbbca","width":700},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=700&quality=45&auto=format&fit=max&dpr=2&s=029cd5216d211934f98687b6be02cecb","width":1400},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=700&quality=85&auto=format&fit=max&s=1367fde7d89541245b9c968b6a0cbbca","width":700},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=700&quality=45&auto=format&fit=max&dpr=2&s=029cd5216d211934f98687b6be02cecb","width":1400},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=660&quality=85&auto=format&fit=max&s=cec8bb62a9936287c1d9655f01dbdd40","width":660},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=660&quality=45&auto=format&fit=max&dpr=2&s=95ba83fabdd7e473c41036dff6f18b3f","width":1320},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=645&quality=85&auto=format&fit=max&s=2a82ed0ad90a2932608493f5756d4f50","width":645},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=645&quality=45&auto=format&fit=max&dpr=2&s=c9be44a472c290938f006160e01a10aa","width":1290},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=465&quality=85&auto=format&fit=max&s=ccec66001607c3222cff9c2eb8794a12","width":465},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=465&quality=45&auto=format&fit=max&dpr=2&s=210be6a18c4539283521266d0888ab19","width":930}]},{"weighting":"halfwidth","srcSet":[]},{"weighting":"immersive","srcSet":[{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1900&quality=85&auto=format&fit=max&s=1aa904c2476140cc9f81f6c565f0f1da","width":1900},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1900&quality=45&auto=format&fit=max&dpr=2&s=9e806ee76d605785f5f0bd1207cfca46","width":3800},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1300&quality=85&auto=format&fit=max&s=5e825880046ec263aa3de8c6d145f9d9","width":1300},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1300&quality=45&auto=format&fit=max&dpr=2&s=6b4dcb57b264be435b4ebf52358bd5f7","width":2600},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1140&quality=85&auto=format&fit=max&s=940262bdfc1794111b2af113bbf14ed4","width":1140},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1140&quality=45&auto=format&fit=max&dpr=2&s=b055e61b09a6ea882e34ee0b72b9ed83","width":2280},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=980&quality=85&auto=format&fit=max&s=4238a4f4a6c9b4faa17c32288d6d29d1","width":980},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=980&quality=45&auto=format&fit=max&dpr=2&s=166b45a37f52996526c67db3ca16ae40","width":1960},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=740&quality=85&auto=format&fit=max&s=9cf749cb169867f590a8845647ec9a6d","width":740},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=740&quality=45&auto=format&fit=max&dpr=2&s=02072a4d23e5d58be9a04d6367efa887","width":1480},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=660&quality=85&auto=format&fit=max&s=cec8bb62a9936287c1d9655f01dbdd40","width":660},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=660&quality=45&auto=format&fit=max&dpr=2&s=95ba83fabdd7e473c41036dff6f18b3f","width":1320},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=480&quality=85&auto=format&fit=max&s=e6287a5de089ea8e32b766f76dd69a62","width":480},{"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=480&quality=45&auto=format&fit=max&dpr=2&s=1e5ced832c728cec3b6ea21439d16a4f","width":960}]}],"data":{"alt":"Man repairing racing car","caption":"Man tinkering on a race car.","credit":"Photograph: Paulo Maria/LiveMedia/REX/Shutterstock"}}],"main":"<figure class=\"element element-image\" data-media-id=\"d63a145b88fe56a67d0b0d0a5b4f33799c3687e8\"> <img src=\"https://media.guim.co.uk/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/1000.jpg\" alt=\"Man repairing racing car\" width=\"1000\" height=\"600\" class=\"gu-image\" /> <figcaption> <span class=\"element-image__caption\">Man tinkering on a race car.</span> <span class=\"element-image__credit\">Photograph: Paulo Maria/LiveMedia/REX/Shutterstock</span> </figcaption> </figure>","filterKeyEvents":false,"keyEvents":[],"blocks":[{"id":"616e943b8f08fb9a02c405dd","elements":[{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Scala is the programming language which underpins many of the most important tools which allow the Guardian to deliver its journalism. And when compared to other languages, Scala has a lot of wonderful tools for making your code simpler. However, sometimes this is achieved by hiding a lot of the complexity. Usually this is a good thing – it’s the compiler writer’s problem and we have the luxury of just being able to ignore it and get on with what we are trying to do. But occasionally it can actually influence the way our code is running and as a result, present us with surprises.</p>","elementId":"67b3377b-61bd-43de-9f84-3fad2a230d10"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>To have something to work with, I began playing around with solutions to <a href=\"https://projecteuler.net/problem=39\">Project Euler problem 39</a> (spoilers for problems after 100 are discouraged but this one is OK).</p>","elementId":"424113b2-a948-4d0d-acef-b57416513a38"},{"_type":"model.dotcomrendering.pageElements.BlockquoteBlockElement","html":"<blockquote>\n <p>If p is the perimeter of a right angle triangle with integral length sides, {a,b,c}, there are exactly three solutions for p = 120.</p>\n <p>{20,48,52}, {24,45,51}, {30,40,50}</p>\n <p>For which value of p ≤ 1000, is the number of solutions maximised?</p>\n</blockquote>","elementId":"db07e21e-4f39-432e-abe6-33d657b808a2"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>We want to find the combinations of three numbers which are valid lengths for the sides of a right-angled triangle and which add up in turn to each number (perimeter) under 1,000. The final answer will be the perimeter which has the greatest number of these triplets.</p>","elementId":"a22e0385-c43b-4fd1-9b56-ffe5dfb4c8da"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>There are almost certainly plenty of better ways to solve this problem than those discussed below – we are just using a naive brute-force approach – but the topic at hand is the relative performance of different Scala coding styles, and so it serves very well to illustrate this point.</p>","elementId":"4ad5e497-c54d-477b-aeed-f4b447b29e60"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>We could start by writing a function that finds the valid triplets for a given perimeter p. An initial instinct might be to reach for a for() loop.</p>","elementId":"40835545-932e-4f48-8b50-1c35e8f3ff5b"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"scala","elementId":"b9b5dcc0-e743-4fe6-b60b-977fe7c96cfb","html":"object ExampleScala {\n  def calc(p: Int) = {\n    var result = 0\n    for {\n      a <- 3 to p\n      b <- 1 until ((p - a) / 2)\n      c = p - (a + b)\n    } if (b * b + c * c == a * a) result += 1\n    result\n  }\n}"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Running this in the Scala REPL (the interactive coding environment) does indeed give us the solution:</p>","elementId":"0ca4f7ad-8a04-49bd-a6df-7c046c20374c"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"text","elementId":"d4e85f53-58b5-4e56-b9d2-67bc683c6a82","html":"scala> timed((3 to 1000).maxBy(ExampleScala.calc _))\ntook 1240123372ns (1240ms)\nval res1: Int = 840"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>but we can see that it takes roughly 1.3 seconds (for the definition of timed(), which is very simple, you can see <a href=\"https://gist.github.com/paulmr/2d2f3acf4e7033fe7e65e8114324b2c2\">this gist</a>).</p>","elementId":"f86e6e9a-0161-4158-8413-eda654e90e30"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>If you are at home in a language like Java or C, you might have assumed that this code was roughly equivalent to this Java snippet:</p>","elementId":"e53b23e8-9952-4f2f-9a80-f4310426b35f"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"java","elementId":"92791df3-ef39-4300-a52a-8cb453ad95ff","html":"public class ExampleJava {\n  public static int calc(int p) {\n    int result = 0;\n    for (int a = 3; a <= p; a++) {\n      for (int b = 1; b <= ((p - a) / 2); b++) {\n        int c = p - (a + b);\n        if (b * b + c * c == a * a) result++;\n      }\n    }\n    return result;\n  }\n}"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>but the above runs more than ten times quicker:</p>","elementId":"b04a7b4c-4dc4-4394-972b-921a6d287e02"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"text","elementId":"8253c7dc-b313-463d-a2fb-6871beb59c2e","html":"scala> timed((3 to 1000).maxBy(ExampleJava.calc _))\ntook 85822387ns (85ms)\nval res1: Int = 840"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>This suggests that although both languages have the for keyword, they result in very different executions. Perhaps because of its focus on immutable variables, Scala doesn’t have a direct equivalent to this Java for loop, but it does of course have while so we can easily write something in Scala that is roughly equivalent to the Java snippet:</p>","elementId":"7c6f3674-370f-4683-a682-e27a3941ab8e"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"scala","elementId":"174b5ae0-7e29-4da2-8095-ade44997bcfe","html":"object ExampleScala {\n  def calcWithWhile(p: Int) = {\n    var (result, a) = (0, 3)\n    while (a <= p) {\n      var b = 1\n      while (b < ((p - a) / 2)) {\n        val c = p - (a + b)\n        if (b * b + c * c == a * a)\n          result += 1\n          b += 1\n      }\n      a += 1\n    }\n    result\n  }\n}\n"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>To our poor sensitive Scala eyes, accustomed only to gazing on sublime functional concision, this may be unpleasant to look at. But how does it perform:</p>","elementId":"aaf545e3-4cbc-46f8-a1df-0449afd2cbdd"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"text","elementId":"58830a08-3afb-4e65-a997-ca966394bf59","html":"scala> timed((3 to 1000).maxBy(ExampleScala.calcWithWhile _))\ntook 66075510ns (66ms)\nval res0: Int = 840"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Even better than the Java version (incidentally in all these cases I am running from a cold JVM instance).</p>","elementId":"72c6596e-e11e-4d5a-9305-7fbfe99b3610"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>What is the difference between these two implementations? We can discover by using the -Xprint:parser option to show us what our Scala code looks like after some of the desugaring, in this case the removal of the for comprehensions (the wording alone here is telling – Java has for-loops, but Scala has for-comprehensions – clearly they aren’t the same thing …).</p>","elementId":"41f465b1-81c1-4d0d-a90f-9cb6f915eb21"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"scala","elementId":"d2c60907-34a3-4576-98b2-a92329246cb7","html":"def calc(p: Int) = {\n  var result = 0;\n  3.to(p).foreach(((a) => 1.until(p.$minus(a).$div(2)).map(((b) => {\n    val c = p.$minus(a.$plus(b));\n    scala.Tuple2(b, c)\n  })).foreach(((x$1) => x$1: @scala.unchecked match {\n    case scala.Tuple2((b @ _), (c @ _)) => if (b.$times(b).$plus(c.$times(c)).$eq$eq(a.$times(a)))\n      result.$plus$eq(1)\n    else\n      ()\n  }))));\n  result\n};"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Our code has been converted into the creation of a number of different anonymous functions, which are then called in a loop using foreach(). Even more alarming is the use of a map() call. foreach() does not keep the results and reconstruct them into another data structure like map() does, and so it is naturally much faster. This map() example is actually pairing each value of b with its corresponding c into a tuple, and building this back into the original sequence before applying another function which applies to each pairing and does the calculation.</p>","elementId":"ca165264-e791-4879-9ab8-7bd1af4bce56"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>This storing of the data into a newly summoned sequence before processing it is memory-hungry and entirely redundant. I was surprised to see this, as I had assumed that assignments within the for-comprehension were equivalent to assignments within the code block, but clearly this was not correct.</p>","elementId":"5c3040cd-fcb6-46db-9554-64bc2b23d375"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>This is borne out when we look at the stack traces produced by running this code with a profiler:</p>","elementId":"51354fe9-7eb4-47fe-aaaa-066ff1bdfd0e"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"text","elementId":"8872836a-b123-4e36-87d8-71696d001c00","html":"          ns  percent  samples  top\n  ----------  -------  -------  ---\n 30940000000   55.07%     3094  scala.collection.immutable.VectorBuilder.result\n  5000000000    8.90%      500  ExampleScala$.$anonfun$calc$2\n  3420000000    6.09%      342  scala.collection.immutable.VectorStatics$.foreachRec\n  2290000000    4.08%      229  scala.collection.immutable.VectorBuilder.advance1"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>It is spending 55% of its time building up Vectors that we don’t even need.</p>","elementId":"352c738e-3318-40ed-998d-93cc8fd4232e"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Therefore we can immediately make a quick performance gain by making a small and seemingly innocuous change to this code:</p>","elementId":"11709c5a-f5a3-4ca7-9ea4-a37bca6e36cc"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"scala","elementId":"80d4552f-e5a9-4ffa-b696-128f99eeff30","html":"object ExampleScala {\n  def calcNoAssign(p: Int) = {\n    var result = 0\n    for {\n      a <- 3 to p\n      b <- 1 until ((p - a) / 2)\n    } {\n      val c = p - (a + b)\n      if (b * b + c * c == a * a) result += 1\n    }\n    result\n  }\n}\n"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Note that the assignment is now moved down to the code block. How does this perform:</p>","elementId":"b81efd9c-0301-40a5-b1b7-13116dd875cf"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"text","elementId":"db2b1510-d5a7-46e9-a6d7-ca36b91d9ebf","html":"scala> timed((3 to 1000).maxBy(ExampleScala.calcNoAssign _))\ntook 302834504ns (302ms)\nval res0: Int = 840"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>302ms! Again a huge improvement. It is still a lot slower than the while loop version though. Why is that? I would speculate that this is due to the remaining lambda function creation and execution. Function calls are very expensive operations in terms of performance, due mainly to the fact that we need to store our running state somewhere before entering the next function so that we can return to that state again afterwards. Of course, this is what makes function calls powerful, so when you need this it’s the only way to go. But if you are solving a problem like this one, then that state is potentially redundant as each iteration can be calculated entirely without the state from the previous one. This also shows why tail recursion optimisation is so fast. Although it allows you to write code which conceptually looks exactly the same as a recursive function call, it actually throws away this execution state at each recursion point, because in the case where tail recursion optimisation is valid, that previous state is not required.</p>","elementId":"9254a693-50c0-4a9d-b5d0-7976249e5724"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>As a side-note, while looking into this issue, I came across the impressive <a href=\"https://typelevel.org/spire/api/spire/syntax/package$$cfor$.html#cfor%5BA%5D(init:A)(test:A=%3EBoolean,next:A=%3EA)(body:A=%3EUnit):Unit\">cfor()</a> macro from the TypeLevel <a href=\"https://typelevel.org/spire/\">Spire</a> library.</p>","elementId":"beffb91e-cdb6-48e0-9b18-17de6d8f93ff"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"scala","elementId":"a4e6c41a-6a64-4302-9865-db545d1b1b5c","html":"object ExampleScala {\n  import spire.syntax.cfor._\n  def calcWithCfor(p: Int) = {\n    var result = 0\n    cforRange(3 to p) { a =>\n      cforRange(1 until ((p-a)/2)) { b =>\n        val c = p-(a+b)\n        if(b*b + c*c == a*a) result += 1\n      }\n    }\n    result\n  }\n}"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"text","elementId":"145f281b-89a5-4af3-8f5f-8a9c62ca96c6","html":"scala> timed((3 to 1000).maxBy(ExampleScala.calcWithCfor _))\ntook 57206928ns (57ms)\nval res0: Int = 840"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Amazingly, this is the fastest result yet, even faster than the while loop solution.</p>","elementId":"eaf316e0-ba83-4632-a6a8-a5a886760999"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>One reassuring conclusion that we can make from all of this is that Scala is actually really performant when it needs to be. We just need to be careful about where and when we make use of its rich abstractions. Self-contained programming problems such as those you find on Project Euler and other sites can be a really useful way to experiment with Scala’s many different ways of solving a problem, so why not start exploring! And of course it’s never really about getting the right answer in the end, but much more about the route(s) you take to get there.</p>","elementId":"d6ff6afd-daff-4669-a494-e845c19eb330"}],"attributes":{"pinned":false,"keyEvent":false,"summary":false},"blockCreatedOn":1634644898000,"blockCreatedOnDisplay":"13.01 BST","blockLastUpdated":1634651135000,"blockLastUpdatedDisplay":"14.45 BST","blockFirstPublished":1634644898000,"blockFirstPublishedDisplay":"13.01 BST","blockFirstPublishedDisplayNoTimezone":"13.01","contributors":[],"primaryDateLine":"Tue 19 Oct 2021 13.01 BST","secondaryDateLine":"Last modified on Tue 17 May 2022 16.50 BST"}],"author":{"byline":"Paul Roberts"},"byline":"Paul Roberts","webPublicationDate":"2021-10-19T12:01:38.000Z","webPublicationDateDeprecated":"2021-10-19T12:01:38.000Z","webPublicationDateDisplay":"Tue 19 Oct 2021 13.01 BST","webPublicationSecondaryDateDisplay":"Last modified on Tue 17 May 2022 16.50 BST","editionLongForm":"UK edition","editionId":"UK","pageId":"info/2021/oct/19/pondering-some-scala-performance-questions","canonicalUrl":"https://www.theguardian.com/info/2021/oct/19/pondering-some-scala-performance-questions","format":{"design":"ArticleDesign","theme":"NewsPillar","display":"StandardDisplay"},"designType":"Article","tags":[{"id":"info/series/engineering-blog","type":"Series","title":"Engineering blog"},{"id":"type/article","type":"Type","title":"Article"},{"id":"profile/paul-roberts","type":"Contributor","title":"Paul Roberts"}],"pillar":"news","isLegacyInteractive":false,"isImmersive":false,"sectionLabel":"","sectionUrl":"","sectionName":"info","subMetaSectionLinks":[{"url":"/info/series/engineering-blog","title":"Engineering blog"}],"subMetaKeywordLinks":[],"shouldHideAds":false,"isAdFreeUser":false,"webURL":"https://www.theguardian.com/info/2021/oct/19/pondering-some-scala-performance-questions","linkedData":[{"@type":"NewsArticle","@context":"https://schema.org","@id":"https://www.theguardian.com/info/2021/oct/19/pondering-some-scala-performance-questions","publisher":{"@type":"Organization","@context":"https://schema.org","@id":"https://www.theguardian.com#publisher","name":"The Guardian","url":"https://www.theguardian.com/","logo":{"@type":"ImageObject","url":"https://uploads.guim.co.uk/2018/01/31/TheGuardian_AMP.png","width":190,"height":60},"sameAs":["https://www.facebook.com/theguardian","https://twitter.com/guardian","https://www.youtube.com/user/TheGuardian"]},"isAccessibleForFree":true,"isPartOf":{"@type":["CreativeWork","Product"],"name":"The Guardian","productID":"theguardian.com:basic"},"image":["https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctYWdlLTIwMjEucG5n&enable=upscale&s=d40ed7a85b42b02ce764e356696d3f8a","https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1200&height=1200&quality=85&auto=format&fit=crop&s=7a2025b092e268a202e27c1778465a1b","https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1200&height=900&quality=85&auto=format&fit=crop&s=87470bd67137ecab7f1464c7fa07ede1","https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1200&quality=85&auto=format&fit=max&s=f10353d741f8c2091e89f8da4b11a735"],"author":[{"@type":"Person","name":"Paul Roberts","sameAs":"https://www.theguardian.com/profile/paul-roberts"}],"datePublished":"2021-10-19T12:01:38.000Z","headline":"Pondering some Scala performance questions","dateModified":"2022-05-17T15:50:54.000Z","mainEntityOfPage":"https://www.theguardian.com/info/2021/oct/19/pondering-some-scala-performance-questions"},{"@type":"WebPage","@context":"https://schema.org","@id":"https://www.theguardian.com/info/2021/oct/19/pondering-some-scala-performance-questions","potentialAction":{"@type":"ViewAction","target":"android-app://com.guardian/https/www.theguardian.com/info/2021/oct/19/pondering-some-scala-performance-questions"}}],"openGraphData":{"og:url":"https://www.theguardian.com/info/2021/oct/19/pondering-some-scala-performance-questions","article:author":"https://www.theguardian.com/profile/paul-roberts","og:image:width":"1200","og:image":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctYWdlLTIwMjEucG5n&enable=upscale&s=d40ed7a85b42b02ce764e356696d3f8a","al:ios:url":"gnmguardian://info/2021/oct/19/pondering-some-scala-performance-questions?contenttype=Article&source=applinks","article:publisher":"https://www.facebook.com/theguardian","og:title":"Pondering some Scala performance questions","fb:app_id":"180444840287","article:modified_time":"2022-05-17T15:50:54.000Z","og:image:height":"720","og:description":"The Scala compiler is a fascinating tool which powers a large proportion of the Guardian’s infrastructure. But sometimes the work that it does can seem somewhat mysterious. Guardian Scala developer Paul Roberts explores in detail one aspect of this mystery and looks at how understanding it can help us write code more effectively","og:type":"article","al:ios:app_store_id":"409128287","article:section":"Info","article:published_time":"2021-10-19T12:01:38.000Z","article:tag":"","al:ios:app_name":"The Guardian","og:site_name":"the Guardian"},"twitterData":{"twitter:app:id:iphone":"409128287","twitter:app:name:googleplay":"The Guardian","twitter:app:name:ipad":"The Guardian","twitter:card":"summary_large_image","twitter:app:name:iphone":"The Guardian","twitter:app:id:ipad":"409128287","twitter:app:id:googleplay":"com.guardian","twitter:app:url:googleplay":"guardian://www.theguardian.com/info/2021/oct/19/pondering-some-scala-performance-questions","twitter:app:url:iphone":"gnmguardian://info/2021/oct/19/pondering-some-scala-performance-questions?contenttype=Article&source=twitter","twitter:image":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctYWdlLTIwMjEucG5n&s=636464c05773b586dbab0973307e343d","twitter:site":"@guardian","twitter:app:url:ipad":"gnmguardian://info/2021/oct/19/pondering-some-scala-performance-questions?contenttype=Article&source=twitter"},"config":{"switches":{"lightbox":true,"abPrebidKeywords":true,"personaliseSignInGateAfterCheckout":true,"abSignInGateMainVariant":true,"prebidAppnexusUkRow":true,"prebidMagnite":true,"commercialMetrics":true,"prebidTrustx":true,"scAdFreeBanner":false,"adaptiveSite":true,"prebidPermutiveAudience":true,"compareVariantDecision":false,"enableSentryReporting":true,"lazyLoadContainers":true,"ampArticleSwitch":false,"remarketing":true,"articleEndSlot":true,"keyEventsCarousel":true,"registerWithPhone":false,"darkModeWeb":true,"targeting":true,"remoteHeader":true,"slotBodyEnd":true,"ampPrebidOzone":false,"extendedMostPopularFronts":true,"emailInlineInFooter":true,"showNewPrivacyWordingOnEmailSignupEmbeds":true,"prebidAnalytics":true,"extendedMostPopular":true,"ampContentAbTesting":false,"prebidCriteo":true,"okta":true,"imrWorldwide":true,"acast":true,"twitterUwt":true,"abAuxiaSignInGate":false,"abDeferPermutiveLoad":true,"prebidAppnexusInvcode":true,"ampPrebidPubmatic":false,"a9HeaderBidding":true,"prebidAppnexus":true,"enableDiscussionSwitch":true,"prebidXaxis":true,"stickyVideos":true,"interactiveFullHeaderSwitch":true,"discussionAllPageSize":true,"prebidUserSync":true,"audioOnwardJourneySwitch":true,"abMovePermutiveSegmentation":false,"brazeTaylorReport":false,"externalVideoEmbeds":true,"abTheTradeDesk":true,"callouts":true,"sentinelLogger":true,"geoMostPopular":true,"weAreHiring":false,"relatedContent":true,"thirdPartyEmbedTracking":true,"prebidOzone":true,"ampLiveblogSwitch":false,"ampAmazon":false,"prebidAdYouLike":true,"mostViewedFronts":true,"optOutAdvertising":true,"abSignInGateMainControl":true,"googleSearch":true,"abOptOutFrequencyCap":true,"brazeSwitch":true,"prebidKargo":true,"consentManagement":true,"idProfileNavigation":true,"confiantAdVerification":true,"discussionAllowAnonymousRecommendsSwitch":false,"dcrCrosswords":true,"absoluteServerTimes":false,"permutive":true,"comscore":true,"ampPrebidCriteo":false,"prebidTheTradeDesk":true,"loopVideoTest":false,"newsletterOnwards":false,"youtubeIma":true,"webFonts":true,"liveBlogTopSponsorship":true,"abAdBlockAsk":false,"ophan":true,"crosswordSvgThumbnails":true,"prebidTriplelift":true,"prebidPubmatic":true,"serverShareCounts":false,"autoRefresh":true,"enhanceTweets":true,"prebidIndexExchange":true,"prebidOpenx":true,"prebidHeaderBidding":true,"idCookieRefresh":true,"discussionPageSize":true,"smartAppBanner":false,"historyTags":true,"brazeContentCards":true,"remoteBanner":true,"emailSignupRecaptcha":true,"prebidSmart":true,"shouldLoadGoogletag":true,"inizio":true,"europeBetaFront":true},"abTests":{},"googletagUrl":"//securepubads.g.doubleclick.net/tag/js/gpt.js","stage":"PROD","frontendAssetsFullURL":"https://assets.guim.co.uk/","ampIframeUrl":"https://assets.guim.co.uk/data/vendor/2533d5cb94302889e6a8f1b24b5329e7/amp-iframe.html","tones":"","facebookIaAdUnitRoot":"facebook-instant-articles","avatarApiUrl":"https://avatar.theguardian.com","isSplash":false,"isColumn":false,"membershipUrl":"https://membership.theguardian.com","headline":"Pondering some Scala performance questions","isImmersive":false,"author":"Paul Roberts","ipsosTag":"guardian","isProd":true,"series":"Engineering blog","toneIds":"","membershipAccess":"","allowUserGeneratedContent":false,"commissioningDesks":"","webPublicationDate":1634644898000,"forecastsapiurl":"/weatherapi/forecast","supportUrl":"https://support.theguardian.com","isNumberedList":false,"commercialBundleUrl":"https://assets.guim.co.uk/commercial/47e59a6f2531251d895a/graun.standalone.commercial.js","idOAuthUrl":"https://oauth.theguardian.com","webTitle":"Pondering some Scala performance questions","isPhotoEssay":false,"idWebAppUrl":"https://oauth.theguardian.com","a9PublisherId":"3722","isFront":false,"inBodyInternalLinkCount":0,"googleSearchUrl":"//www.google.co.uk/cse/cse.js","inBodyExternalLinkCount":4,"showRelatedContent":true,"lightboxImages":{"id":"info/2021/oct/19/pondering-some-scala-performance-questions","headline":"Pondering some Scala performance questions","shouldHideAdverts":false,"standfirst":"<p>The Scala compiler is a fascinating tool which powers a large proportion of the Guardian’s infrastructure. But sometimes the work that it does can seem somewhat mysterious. Guardian Scala developer Paul Roberts explores in detail one aspect of this mystery and looks at how understanding it can help us write code more effectively</p>","images":[{"caption":"Man tinkering on a race car.","credit":"Photograph: Paulo Maria/LiveMedia/REX/Shutterstock","displayCredit":true,"src":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=700&quality=85&auto=format&fit=max&s=1367fde7d89541245b9c968b6a0cbbca","srcsets":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1920&quality=85&auto=format&fit=max&s=b33149caf78dc555e70f2f3c463f3a6f 1920w, https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1225&quality=85&auto=format&fit=max&s=0722dce0d8e5d3e7e5c346f8b4bd040d 1225w, https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=1065&quality=85&auto=format&fit=max&s=8a9cc13bac70ee9e874eb0da83b2e79f 1065w, https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=965&quality=85&auto=format&fit=max&s=b58a7d1cefc74277d664cb9c82e7e358 965w, https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=725&quality=85&auto=format&fit=max&s=d7a18bc5a0747e2c40fe50be926ccdf0 725w, https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=645&quality=85&auto=format&fit=max&s=2a82ed0ad90a2932608493f5756d4f50 645w, https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/master/4500.jpg?width=465&quality=85&auto=format&fit=max&s=ccec66001607c3222cff9c2eb8794a12 465w","sizes":"(min-width: 1300px) 1920px, (min-width: 1140px) 1225px, (min-width: 980px) 1065px, (min-width: 740px) 965px, (min-width: 660px) 725px, (min-width: 480px) 645px, 465px","ratio":1.6666666666666667,"role":"None","parentContentId":"info/2021/oct/19/pondering-some-scala-performance-questions","id":"info/2021/oct/19/pondering-some-scala-performance-questions"}]},"googleSearchId":"007466294097402385199:m2ealvuxh1i","shouldHideReaderRevenue":false,"idUrl":"https://profile.theguardian.com","hasSurveyAd":false,"omnitureAmpAccount":"guardiangu-thirdpartyapps","dfpAdUnitRoot":"theguardian.com","host":"https://www.theguardian.com","blogIds":"","sectionName":"Info","hasMultipleVideosInPage":false,"hasShowcaseMainElement":false,"googleRecaptchaSiteKey":"6LdzlmsdAAAAALFH63cBVagSFPuuHXQ9OfpIDdMc","fbAppId":"180444840287","isContent":true,"shortUrlId":"/p/ja6eb","dfpAccountId":"59666047","plistaPublicApiKey":"462925f4f131001fd974bebe","wordCount":1480,"hasLiveBlogTopAd":false,"dcrSentryDsn":"https://1937ab71c8804b2b8438178dfdd6468f@sentry.io/1377847","cardStyle":"news","adUnit":"/59666047/theguardian.com/info/article/ng","discussionApiUrl":"https://discussion.theguardian.com/discussion-api","isSensitive":false,"ophanEmbedJsUrl":"//j.ophan.co.uk/ophan.embed","edition":"UK","brazeApiKey":"7f28c639-8bda-48ff-a3f6-24345abfc07c","blogs":"","discussionApiClientHeader":"nextgen","section":"info","userAttributesApiUrl":"https://members-data-api.theguardian.com/user-attributes","videoDuration":0,"dfpHost":"pubads.g.doubleclick.net","weatherapiurl":"/weatherapi/city","sentryPublicApiKey":"344003a8d11c41d8800fbad8383fdc50","shortUrl":"https://www.theguardian.com/p/ja6eb","thumbnail":"https://i.guim.co.uk/img/media/d63a145b88fe56a67d0b0d0a5b4f33799c3687e8/0_150_4500_2700/500.jpg?quality=85&auto=format&fit=max&s=89a2756b57b9ed38bc32f7f38ee8b33e","pillar":"News","pageId":"info/2021/oct/19/pondering-some-scala-performance-questions","references":[],"beaconUrl":"//phar.gu-web.net","commentable":false,"discussionD2Uid":"zHoBy6HNKsk","ophanJsUrl":"//j.ophan.co.uk/ophan.ng","contributorBio":"","keywordIds":"","contentType":"Article","isDev":false,"isHosted":false,"isAdFree":false,"stripePublicToken":"pk_live_2O6zPMHXNs2AGea4bAmq5R7Z","omnitureAccount":"guardiangu-network","locationapiurl":"/weatherapi/locations?query=","authorIds":"profile/paul-roberts","isPaidContent":false,"hasYouTubeAtom":false,"externalEmbedHost":"https://embed.theguardian.com","thirdPartyAppsAccount":"guardiangu-thirdpartyapps","ajaxUrl":"https://api.nextgen.guardianapps.co.uk","byline":"Paul Roberts","keywords":"","contentId":"info/2021/oct/19/pondering-some-scala-performance-questions","nonKeywordTagIds":"info/series/engineering-blog,type/article,profile/paul-roberts","mobileAppsAdUnitRoot":"beta-guardian-app","hasPageSkin":false,"requiresMembershipAccess":false,"seriesTags":"Engineering blog","revisionNumber":"DEV","seriesId":"info/series/engineering-blog","optimizeEpicUrl":"https://support.theguardian.com/epic/control/index.html","assetsPath":"https://assets.guim.co.uk/","mmaUrl":"https://manage.theguardian.com","isLive":false,"richLink":"","campaigns":[],"isLiveBlog":false,"pageCode":"10298972","avatarImagesUrl":"https://avatar.guim.co.uk","publication":"theguardian.com","sentryHost":"app.getsentry.com/35463","buildNumber":"DEV","userBenefitsApiUrl":"https://user-benefits.guardianapis.com/benefits/me","sharedAdTargeting":{"se":["engineering-blog"],"ct":"article","su":["0"],"edition":"uk","p":"ng","sh":"https://www.theguardian.com/p/ja6eb","co":["paul-roberts"],"url":"/info/2021/oct/19/pondering-some-scala-performance-questions"},"onwardWebSocket":"ws://api.nextgen.guardianapps.co.uk/recently-published","productionOffice":"Uk","shouldHideAdverts":false,"idApiUrl":"https://idapi.theguardian.com","pbIndexSites":[{"bp":"D","id":208247},{"bp":"M","id":213519},{"bp":"T","id":215454}],"googletagJsUrl":"//securepubads.g.doubleclick.net/tag/js/gpt.js","calloutsUrl":"https://callouts.guardianapis.com/formstack-campaign/submit","isPreview":false},"guardianBaseURL":"https://www.theguardian.com","contentType":"Article","hasRelated":true,"hasStoryPackage":false,"beaconURL":"//phar.gu-web.net","isCommentable":false,"commercialProperties":{"US":{"adTargeting":[{"name":"su","value":["0"]},{"name":"url","value":"/info/2021/oct/19/pondering-some-scala-performance-questions"},{"name":"edition","value":"us"},{"name":"ct","value":"article"},{"name":"co","value":["paul-roberts"]},{"name":"sh","value":"https://www.theguardian.com/p/ja6eb"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"}]},"AU":{"adTargeting":[{"name":"su","value":["0"]},{"name":"url","value":"/info/2021/oct/19/pondering-some-scala-performance-questions"},{"name":"edition","value":"au"},{"name":"ct","value":"article"},{"name":"co","value":["paul-roberts"]},{"name":"sh","value":"https://www.theguardian.com/p/ja6eb"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"}]},"UK":{"adTargeting":[{"name":"su","value":["0"]},{"name":"url","value":"/info/2021/oct/19/pondering-some-scala-performance-questions"},{"name":"edition","value":"uk"},{"name":"ct","value":"article"},{"name":"co","value":["paul-roberts"]},{"name":"sh","value":"https://www.theguardian.com/p/ja6eb"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"}]},"INT":{"adTargeting":[{"name":"su","value":["0"]},{"name":"url","value":"/info/2021/oct/19/pondering-some-scala-performance-questions"},{"name":"ct","value":"article"},{"name":"co","value":["paul-roberts"]},{"name":"sh","value":"https://www.theguardian.com/p/ja6eb"},{"name":"edition","value":"int"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"}]},"EUR":{"adTargeting":[{"name":"su","value":["0"]},{"name":"url","value":"/info/2021/oct/19/pondering-some-scala-performance-questions"},{"name":"ct","value":"article"},{"name":"co","value":["paul-roberts"]},{"name":"sh","value":"https://www.theguardian.com/p/ja6eb"},{"name":"edition","value":"eur"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"}]}},"pageType":{"hasShowcaseMainElement":false,"isFront":false,"isLiveblog":false,"isMinuteArticle":false,"isPaidContent":false,"isPreview":false,"isSensitive":false},"trailText":"The Scala compiler is a fascinating tool which powers a large proportion of the Guardian’s infrastructure. But sometimes the work that it does can seem somewhat mysterious. Guardian Scala developer Paul Roberts explores in detail one aspect of this mystery and looks at how understanding it can help us write code more effectively","nav":{"currentUrl":"/info","pillars":[{"title":"News","url":"/","longTitle":"Headlines","iconName":"home","children":[{"title":"UK","url":"/uk-news","longTitle":"UK news","children":[{"title":"UK politics","url":"/politics"},{"title":"Education","url":"/education","children":[{"title":"Schools","url":"/education/schools"},{"title":"Teachers","url":"/teacher-network"},{"title":"Universities","url":"/education/universities"},{"title":"Students","url":"/education/students"}]},{"title":"Media","url":"/media"},{"title":"Society","url":"/society"},{"title":"Law","url":"/law"},{"title":"Scotland","url":"/uk/scotland"},{"title":"Wales","url":"/uk/wales"},{"title":"Northern Ireland","url":"/uk/northernireland"}]},{"title":"US politics","url":"/us-news/us-politics"},{"title":"World","url":"/world","longTitle":"World news","children":[{"title":"Europe","url":"/world/europe-news"},{"title":"US","url":"/us-news","longTitle":"US news"},{"title":"Americas","url":"/world/americas"},{"title":"Asia","url":"/world/asia"},{"title":"Australia","url":"/australia-news","longTitle":"Australia news"},{"title":"Middle East","url":"/world/middleeast"},{"title":"Africa","url":"/world/africa"},{"title":"Inequality","url":"/inequality"},{"title":"Global development","url":"/global-development"}]},{"title":"Climate crisis","url":"/environment/climate-crisis"},{"title":"Middle East","url":"/world/middleeast"},{"title":"Ukraine","url":"/world/ukraine"},{"title":"Football","url":"/football","children":[{"title":"Live scores","url":"/football/live","longTitle":"football/live"},{"title":"Tables","url":"/football/tables","longTitle":"football/tables"},{"title":"Fixtures","url":"/football/fixtures","longTitle":"football/fixtures"},{"title":"Results","url":"/football/results","longTitle":"football/results"},{"title":"Competitions","url":"/football/competitions","longTitle":"football/competitions"},{"title":"Clubs","url":"/football/teams","longTitle":"football/teams"}]},{"title":"Newsletters","url":"/email-newsletters"},{"title":"Business","url":"/business","children":[{"title":"Economics","url":"/business/economics"},{"title":"Banking","url":"/business/banking"},{"title":"Money","url":"/money","children":[{"title":"Property","url":"/money/property"},{"title":"Pensions","url":"/money/pensions"},{"title":"Savings","url":"/money/savings"},{"title":"Borrowing","url":"/money/debt"},{"title":"Careers","url":"/money/work-and-careers"}]},{"title":"Markets","url":"/business/stock-markets"},{"title":"Project Syndicate","url":"/business/series/project-syndicate-economists"},{"title":"B2B","url":"/business-to-business"},{"title":"Retail","url":"/business/retail"}]},{"title":"Environment","url":"/environment","children":[{"title":"Climate crisis","url":"/environment/climate-crisis"},{"title":"Wildlife","url":"/environment/wildlife"},{"title":"Energy","url":"/environment/energy"},{"title":"Pollution","url":"/environment/pollution"}]},{"title":"UK politics","url":"/politics"},{"title":"Society","url":"/society"},{"title":"Science","url":"/science"},{"title":"Tech","url":"/technology"},{"title":"Global development","url":"/global-development"},{"title":"Obituaries","url":"/obituaries"}]},{"title":"Opinion","url":"/commentisfree","longTitle":"Opinion home","iconName":"home","children":[{"title":"The Guardian view","url":"/profile/editorial"},{"title":"Columnists","url":"/index/contributors"},{"title":"Cartoons","url":"/tone/cartoons"},{"title":"Opinion videos","url":"/type/video+tone/comment"},{"title":"Letters","url":"/tone/letters"}]},{"title":"Sport","url":"/sport","longTitle":"Sport home","iconName":"home","children":[{"title":"Football","url":"/football","children":[{"title":"Live scores","url":"/football/live","longTitle":"football/live"},{"title":"Tables","url":"/football/tables","longTitle":"football/tables"},{"title":"Fixtures","url":"/football/fixtures","longTitle":"football/fixtures"},{"title":"Results","url":"/football/results","longTitle":"football/results"},{"title":"Competitions","url":"/football/competitions","longTitle":"football/competitions"},{"title":"Clubs","url":"/football/teams","longTitle":"football/teams"}]},{"title":"Cricket","url":"/sport/cricket"},{"title":"Rugby union","url":"/sport/rugby-union"},{"title":"Tennis","url":"/sport/tennis"},{"title":"Cycling","url":"/sport/cycling"},{"title":"F1","url":"/sport/formulaone"},{"title":"Golf","url":"/sport/golf"},{"title":"Boxing","url":"/sport/boxing"},{"title":"Rugby league","url":"/sport/rugbyleague"},{"title":"Racing","url":"/sport/horse-racing"},{"title":"US sports","url":"/sport/us-sport"}]},{"title":"Culture","url":"/culture","longTitle":"Culture home","iconName":"home","children":[{"title":"Film","url":"/film"},{"title":"Music","url":"/music"},{"title":"TV & radio","url":"/tv-and-radio"},{"title":"Books","url":"/books"},{"title":"Art & design","url":"/artanddesign"},{"title":"Stage","url":"/stage"},{"title":"Games","url":"/games"},{"title":"Classical","url":"/music/classicalmusicandopera"}]},{"title":"Lifestyle","url":"/lifeandstyle","longTitle":"Lifestyle home","iconName":"home","children":[{"title":"The Filter","url":"/uk/thefilter"},{"title":"Fashion","url":"/fashion"},{"title":"Food","url":"/food"},{"title":"Recipes","url":"/tone/recipes"},{"title":"Travel","url":"/travel","children":[{"title":"UK","url":"/travel/uk"},{"title":"Europe","url":"/travel/europe"},{"title":"US","url":"/travel/usa"}]},{"title":"Health & fitness","url":"/lifeandstyle/health-and-wellbeing"},{"title":"Women","url":"/lifeandstyle/women"},{"title":"Men","url":"/lifeandstyle/men"},{"title":"Love & sex","url":"/lifeandstyle/love-and-sex"},{"title":"Beauty","url":"/fashion/beauty"},{"title":"Home & garden","url":"/lifeandstyle/home-and-garden"},{"title":"Money","url":"/money","children":[{"title":"Property","url":"/money/property"},{"title":"Pensions","url":"/money/pensions"},{"title":"Savings","url":"/money/savings"},{"title":"Borrowing","url":"/money/debt"},{"title":"Careers","url":"/money/work-and-careers"}]},{"title":"Cars","url":"/technology/motoring"}]}],"otherLinks":[{"title":"The Guardian app","url":"https://app.adjust.com/16xt6hai"},{"title":"Video","url":"/video"},{"title":"Podcasts","url":"/podcasts"},{"title":"Pictures","url":"/inpictures"},{"title":"Newsletters","url":"/email-newsletters"},{"title":"Today's paper","url":"/theguardian","children":[{"title":"Obituaries","url":"/obituaries"},{"title":"G2","url":"/theguardian/g2"},{"title":"Journal","url":"/theguardian/journal"},{"title":"Saturday","url":"/theguardian/saturday"}]},{"title":"Inside the Guardian","url":"https://www.theguardian.com/insidetheguardian"},{"title":"The Observer","url":"/observer","children":[{"title":"Comment","url":"/theobserver/news/comment"},{"title":"The New Review","url":"/theobserver/new-review"},{"title":"Observer Magazine","url":"/theobserver/magazine"},{"title":"Observer Food Monthly","url":"/theobserver/foodmonthly"}]},{"title":"Guardian Weekly","url":"https://www.theguardian.com/weekly?INTCMP=gdnwb_mawns_editorial_gweekly_GW_TopNav_UK"},{"title":"Crosswords","url":"/crosswords","children":[{"title":"Blog","url":"/crosswords/crossword-blog"},{"title":"Quick","url":"/crosswords/series/quick"},{"title":"Speedy","url":"/crosswords/series/speedy"},{"title":"Quick cryptic","url":"/crosswords/series/quick-cryptic"},{"title":"Everyman","url":"/crosswords/series/everyman"},{"title":"Quiptic","url":"/crosswords/series/quiptic"},{"title":"Cryptic","url":"/crosswords/series/cryptic"},{"title":"Prize","url":"/crosswords/series/prize"},{"title":"Azed","url":"/crosswords/series/azed"},{"title":"Genius","url":"/crosswords/series/genius"},{"title":"Weekend","url":"/crosswords/series/weekend-crossword"},{"title":"Special","url":"/crosswords/series/special"}]},{"title":"Wordiply","url":"https://www.wordiply.com"},{"title":"Corrections","url":"/theguardian/series/corrections-and-clarifications"}],"brandExtensions":[{"title":"Search jobs","url":"https://jobs.theguardian.com"},{"title":"Hire with Guardian Jobs","url":"https://recruiters.theguardian.com/?utm_source=gdnwb&utm_medium=navbar&utm_campaign=Guardian_Navbar_Recruiters&CMP_TU=trdmkt&CMP_BUNIT=jobs"},{"title":"Holidays","url":"https://holidays.theguardian.com?INTCMP=holidays_uk_web_newheader"},{"title":"Live events","url":"https://www.theguardian.com/guardian-live-events?INTCMP=live_uk_header_dropdown"},{"title":"About Us","url":"/about"},{"title":"Digital Archive","url":"https://theguardian.newspapers.com"},{"title":"Guardian Print Shop","url":"/artanddesign/series/gnm-print-sales"},{"title":"Patrons","url":"https://patrons.theguardian.com/?INTCMP=header_patrons"},{"title":"Guardian Licensing","url":"https://licensing.theguardian.com/"}],"readerRevenueLinks":{"header":{"contribute":"https://support.theguardian.com/contribute?INTCMP=header_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=header_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=header_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=header_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_supporter_cta%22%7D"},"footer":{"contribute":"https://support.theguardian.com/contribute?INTCMP=footer_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=footer_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=footer_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=footer_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_supporter_cta%22%7D"},"sideMenu":{"contribute":"https://support.theguardian.com/contribute?INTCMP=side_menu_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22side_menu_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=side_menu_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22side_menu_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=side_menu_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22side_menu_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=mobilenav_print_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22mobilenav_print_cta%22%7D"},"ampHeader":{"contribute":"https://support.theguardian.com/contribute?INTCMP=header_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=header_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=amp_header_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22amp_header_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=header_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_supporter_cta%22%7D"},"ampFooter":{"contribute":"https://support.theguardian.com/contribute?INTCMP=amp_footer_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22amp_footer_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=amp_footer_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22amp_footer_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=footer_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=amp_footer_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22amp_footer_supporter_cta%22%7D"}}},"showBottomSocialButtons":true,"pageFooter":{"footerLinks":[[{"text":"About us","url":"/about","dataLinkName":"uk : footer : about us","extraClasses":""},{"text":"Help","url":"https://manage.theguardian.com/help-centre","dataLinkName":"uk : footer : tech feedback","extraClasses":"js-tech-feedback-report"},{"text":"Complaints & corrections","url":"/info/complaints-and-corrections","dataLinkName":"complaints","extraClasses":""},{"text":"SecureDrop","url":"https://www.theguardian.com/securedrop","dataLinkName":"securedrop","extraClasses":""},{"text":"Work for us","url":"https://workforus.theguardian.com","dataLinkName":"uk : footer : work for us","extraClasses":""},{"text":"Privacy policy","url":"/info/privacy","dataLinkName":"privacy","extraClasses":""},{"text":"Cookie policy","url":"/info/cookies","dataLinkName":"cookie","extraClasses":""},{"text":"Terms & conditions","url":"/help/terms-of-service","dataLinkName":"terms","extraClasses":""},{"text":"Contact us","url":"/help/contact-us","dataLinkName":"uk : footer : contact us","extraClasses":""}],[{"text":"All topics","url":"/index/subjects/a","dataLinkName":"uk : footer : all topics","extraClasses":""},{"text":"All writers","url":"/index/contributors","dataLinkName":"uk : footer : all contributors","extraClasses":""},{"text":"Modern Slavery Act","url":"https://uploads.guim.co.uk/2024/09/04/Modern_Slavery_Statement_2024_.pdf","dataLinkName":"uk : footer : modern slavery act statement","extraClasses":""},{"text":"Tax strategy","url":"https://uploads.guim.co.uk/2024/08/27/TAX_STRATEGY_FOR_THE_YEAR_ENDED_31_MARCH_2025.pdf","dataLinkName":"uk : footer : tax strategy","extraClasses":""},{"text":"Digital newspaper archive","url":"https://theguardian.newspapers.com","dataLinkName":"digital newspaper archive","extraClasses":""},{"text":"Facebook","url":"https://www.facebook.com/theguardian","dataLinkName":"uk : footer : facebook","extraClasses":""},{"text":"YouTube","url":"https://www.youtube.com/user/TheGuardian","dataLinkName":"uk : footer : youtube","extraClasses":""},{"text":"Instagram","url":"https://www.instagram.com/guardian","dataLinkName":"uk : footer : instagram","extraClasses":""},{"text":"LinkedIn","url":"https://www.linkedin.com/company/theguardian","dataLinkName":"uk : footer : linkedin","extraClasses":""},{"text":"Newsletters","url":"/email-newsletters?INTCMP=DOTCOM_FOOTER_NEWSLETTER_UK","dataLinkName":"uk : footer : newsletters","extraClasses":""}],[{"text":"Advertise with us","url":"https://advertising.theguardian.com","dataLinkName":"uk : footer : advertise with us","extraClasses":""},{"text":"Guardian Labs","url":"/guardian-labs","dataLinkName":"uk : footer : guardian labs","extraClasses":""},{"text":"Search jobs","url":"https://jobs.theguardian.com","dataLinkName":"uk : footer : jobs","extraClasses":""},{"text":"Patrons","url":"https://patrons.theguardian.com?INTCMP=footer_patrons","dataLinkName":"uk : footer : patrons","extraClasses":""}]]},"publication":"theguardian.com","shouldHideReaderRevenue":false,"slotMachineFlags":"","contributionsServiceUrl":"https://contributions.guardianapis.com","isSpecialReport":false,"showTableOfContents":false,"lang":"en","isRightToLeftLang":false}