{"version":3,"headline":"Taming data transfer costs with Elasticsearch","standfirst":"<p>Here we outline how an upgrade to open source search and analytics engine, Elasticsearch, led to unexpected cost-savings</p>","webTitle":"Taming data transfer costs with Elasticsearch","mainMediaElements":[{"displayCredit":true,"_type":"model.dotcomrendering.pageElements.ImageBlockElement","role":"inline","media":{"allImages":[{"index":0,"fields":{"height":"1200","width":"2000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/2000.jpg"},{"index":1,"fields":{"height":"600","width":"1000"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/1000.jpg"},{"index":2,"fields":{"height":"300","width":"500"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/500.jpg"},{"index":3,"fields":{"height":"84","width":"140"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/140.jpg"},{"index":4,"fields":{"height":"2018","width":"3364"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/3364.jpg"},{"index":5,"fields":{"isMaster":"true","height":"2018","width":"3364"},"mediaType":"Image","mimeType":"image/jpeg","url":"https://media.guim.co.uk/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg"}]},"elementId":"f20c259f-0b70-42d5-96d1-78cab449803a","imageSources":[{"weighting":"inline","srcSet":[{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=620&quality=85&auto=format&fit=max&s=a8224fa8fcf683f32fcb720022b28904","width":620},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=f2f5d4c5fcaf5afb76a883233e9d4b26","width":1240},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=700&quality=85&auto=format&fit=max&s=b173a9e3aa77d8ab1212eccd3f3d0ca5","width":700},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=700&quality=45&auto=format&fit=max&dpr=2&s=1c4c0b2bfcff49932375c3c6fed6dbe4","width":1400},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=620&quality=85&auto=format&fit=max&s=a8224fa8fcf683f32fcb720022b28904","width":620},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=620&quality=45&auto=format&fit=max&dpr=2&s=f2f5d4c5fcaf5afb76a883233e9d4b26","width":1240},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=645&quality=85&auto=format&fit=max&s=ec888e891409b89df97d58c28dda66d8","width":645},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=645&quality=45&auto=format&fit=max&dpr=2&s=60fc299bc4c0950938f9986c86f5d1e0","width":1290},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=465&quality=85&auto=format&fit=max&s=49c9e31ac11e5ddbf2378c5a05d2b4a4","width":465},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=465&quality=45&auto=format&fit=max&dpr=2&s=e23903bfd38b024b23b05c247e661be3","width":930}]},{"weighting":"thumbnail","srcSet":[]},{"weighting":"supporting","srcSet":[]},{"weighting":"showcase","srcSet":[{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1020&quality=85&auto=format&fit=max&s=4903e36ee7fbcb97c5265ad98a6a450e","width":1020},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1020&quality=45&auto=format&fit=max&dpr=2&s=d296c88f70d68d7be742ffc62d24e761","width":2040},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=940&quality=85&auto=format&fit=max&s=fa4ac0507e4b66adefaea00396b22de6","width":940},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=940&quality=45&auto=format&fit=max&dpr=2&s=520a19d34e5118944202568e8855dc3d","width":1880},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=700&quality=85&auto=format&fit=max&s=b173a9e3aa77d8ab1212eccd3f3d0ca5","width":700},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=700&quality=45&auto=format&fit=max&dpr=2&s=1c4c0b2bfcff49932375c3c6fed6dbe4","width":1400},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=700&quality=85&auto=format&fit=max&s=b173a9e3aa77d8ab1212eccd3f3d0ca5","width":700},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=700&quality=45&auto=format&fit=max&dpr=2&s=1c4c0b2bfcff49932375c3c6fed6dbe4","width":1400},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=660&quality=85&auto=format&fit=max&s=530badb8f9c4eff3bff73b92ee3de85b","width":660},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=660&quality=45&auto=format&fit=max&dpr=2&s=39927695a9f826b49e6b8d5bcb96089f","width":1320},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=645&quality=85&auto=format&fit=max&s=ec888e891409b89df97d58c28dda66d8","width":645},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=645&quality=45&auto=format&fit=max&dpr=2&s=60fc299bc4c0950938f9986c86f5d1e0","width":1290},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=465&quality=85&auto=format&fit=max&s=49c9e31ac11e5ddbf2378c5a05d2b4a4","width":465},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=465&quality=45&auto=format&fit=max&dpr=2&s=e23903bfd38b024b23b05c247e661be3","width":930}]},{"weighting":"halfwidth","srcSet":[]},{"weighting":"immersive","srcSet":[{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1900&quality=85&auto=format&fit=max&s=f8d892c960d5df7010971360bc01fa10","width":1900},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1900&quality=45&auto=format&fit=max&dpr=2&s=c556faa5a927441a8a0171726cd156ff","width":3800},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1300&quality=85&auto=format&fit=max&s=975f6c345e8be65cd23a57c2cb8963c3","width":1300},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1300&quality=45&auto=format&fit=max&dpr=2&s=a397e05011255cb0d10b09030d4b3619","width":2600},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1140&quality=85&auto=format&fit=max&s=48c7680242f942999416cc3672c790dc","width":1140},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1140&quality=45&auto=format&fit=max&dpr=2&s=3b18fc930473ad7e81ef0b1d7cb275cf","width":2280},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=980&quality=85&auto=format&fit=max&s=9e10356d09684a0292e5879fecc45a46","width":980},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=980&quality=45&auto=format&fit=max&dpr=2&s=d1c5c343ab35852a62e0675fd3a1eaf5","width":1960},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=740&quality=85&auto=format&fit=max&s=123f1aa657b7d571c65231680f4b9f56","width":740},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=740&quality=45&auto=format&fit=max&dpr=2&s=235ecc79b8d8cd167155883d2acf7872","width":1480},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=660&quality=85&auto=format&fit=max&s=530badb8f9c4eff3bff73b92ee3de85b","width":660},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=660&quality=45&auto=format&fit=max&dpr=2&s=39927695a9f826b49e6b8d5bcb96089f","width":1320},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=480&quality=85&auto=format&fit=max&s=0045845d58275672654f6de6a361b2dc","width":480},{"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=480&quality=45&auto=format&fit=max&dpr=2&s=a3532d130b04cb8fb7e2b234ed06a508","width":960}]}],"data":{"alt":"How an upgrade to open source search and analytics engine led to unexpected cost-savings","caption":"How an upgrade to open source search and analytics engine led to unexpected cost-savings","credit":"Photograph: Leonhard Föger/Reuters"}}],"main":"<figure class=\"element element-image\" data-media-id=\"12c27583426492e29feff5e96d9e7cc236e55864\"> <img src=\"https://media.guim.co.uk/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/1000.jpg\" alt=\"How an upgrade to open source search and analytics engine led to unexpected cost-savings\" width=\"1000\" height=\"600\" class=\"gu-image\" /> <figcaption> <span class=\"element-image__caption\">How an upgrade to open source search and analytics engine led to unexpected cost-savings</span> <span class=\"element-image__credit\">Photograph: Leonhard Föger/Reuters</span> </figcaption> </figure>","filterKeyEvents":false,"keyEvents":[],"blocks":[{"id":"5e399a558f086a28115a5748","elements":[{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Recently, we decided to upgrade the Elasticsearch cluster powering the Content API. Elastic had released version 7.1, which is where we wanted to be. At the same time, Elastic <a href=\"https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/java-api.html\">deprecated the Java client</a> we were using to talk to Elasticsearch. We had several options before us: use the low-level REST client, the high-level REST client or switch to a Scala-based library like Elastic4s. None of these options were entirely satisfactory, but we eventually chose to go with the high-level client which was designed to be very close to the Java client. Indeed, the amount of work needed was quite small and, credit where credit is due, well-documented by the Elastic team.</p>","elementId":"e1920872-e73b-4e5b-86ff-40f177aeaeb1"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>After a perfect roll-out, we noticed a substantial spike in our data transfer costs, and it was interesting to figure out its origin and a solution to that problem. That it happened right after the upgrade seemed too much of a coincidence, so we began investigating.</p>","elementId":"baee00eb-5c9c-4239-b0ef-b419c8e10d17"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>A quick lookup in the AWS Cost Explorer helped us isolate the spike to be caused by traffic between our ES cluster and the application providing the client facing API that people are used to when they interact with <a href=\"https://open-platform.theguardian.com\">the Guardian Open Platform</a>. We did everything by the book, we were sure there wasn’t a bug in our code, so we zoned in on the switch to the new client.</p>","elementId":"d7f0d8f8-c06e-48b4-8732-f3e6bd7b17be"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The obsolete Java client uses a proprietary protocol and a binary format to exchange data with ES nodes — the same used for communication <em>between</em> nodes — but the new client uses HTTP as its protocol and JSON as the data format. What wasn’t clear at the time, came as a sudden realisation that with HTTP – user agents must indicate how they would like content to be encoded by means of the Content-Encoding header. If they don’t, content will be sent in plain text. Spoiler alert: the ES REST client doesn’t supply any Content-Encoding header by default. We were <a href=\"https://github.com/elastic/elasticsearch/issues/24349\">not the only ones to notice</a>.</p>","elementId":"4d91bf59-42d9-4918-a209-a25aaff2f7e3"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>With that, we had a pretty solid hypothesis and started thinking about a solution. The natural first idea was to enable compression. As the REST client uses Apache’s async-http-client under the hood, it is a matter of setting things up at initialisation time:</p>","elementId":"903656cd-5748-4f94-b240-ae038fce40be"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"scala","elementId":"251de355-2fe1-4838-b6b6-e865ce713070","html":"val hosts: List[HttpHost] = ???\nval client = new RestHighLevelClient(\n  RestClient.builder(hosts: _*)\n    .setHttpClientConfigCallback(new RestClientBuilder.HttpClientConfigCallback {\n      def customizeHttpClient(httpClientBuilder: HttpAsyncClientBuilder): HttpAsyncClientBuilder =\n        httpClientBuilder.addInterceptorLast(new RequestAcceptEncoding())\n    })\n)"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>There is some additional complexity to handle, due to the fact that the Apache client <a href=\"https://issues.apache.org/jira/browse/HTTPCLIENT-1822\">does not support transparent decompression</a>. In a nutshell, decompression has to be done at the point of use, by taking the entity out of the ES response object and unzipping it. This is <a href=\"https://github.com/sksamuel/elastic4s/pull/1473/files\">how elastic4s does it</a>.</p>","elementId":"f7024d51-137a-495c-a5b7-1c76df3ffb03"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The same change in our code would have been trivial. However, we took a moment to think about the issue. While we made the assumption that costs increased due to the spike in the volume of our traffic, we didn’t really identify why we were paying in the first place. The fine print on the <a href=\"https://aws.amazon.com/ec2/pricing/on-demand/\">pricing page</a> for EC2 data transfer states, “Data transferred between Amazon EC2, Amazon RDS, Amazon Redshift, Amazon ElastiCache instances and Elastic Network Interfaces in the same Availability Zone is free.”</p>","elementId":"d2352714-3e53-4d25-b6ac-427a21d21b57"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>We had two options, to either use compression and reduce costs, or swimlane traffic so that it never crosses AZ boundaries and remove data transfer costs once and for all — or do both. We decided to explore the second route first, since we were afraid of adding too much overhead for content compression/decompression.</p>","elementId":"dbcd9acd-f2c2-44e8-86ad-510386d0b58f"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Here’s a rough layout of the Content API:</p>","elementId":"9240724b-b00d-45c9-b654-00ce9088d4d8"},{"displayCredit":true,"_type":"model.dotcomrendering.pageElements.ImageBlockElement","role":"inline","media":{"allImages":[{"index":0,"fields":{"height":"587","width":"925"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/925.png"},{"index":1,"fields":{"isMaster":"true","height":"587","width":"925"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png"},{"index":2,"fields":{"height":"317","width":"500"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/500.png"},{"index":3,"fields":{"height":"89","width":"140"},"mediaType":"Image","mimeType":"image/png","url":"https://media.guim.co.uk/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/140.png"}]},"elementId":"1c97a28d-1e22-4cd5-a206-7b441aaaba90","imageSources":[{"weighting":"inline","srcSet":[{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=620&quality=85&auto=format&fit=max&s=62c8dca7f86aba1bdc41423af408f822","width":620},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=620&quality=45&auto=format&fit=max&dpr=2&s=89942b3dacbdb5c2b2cc53f6f7017246","width":1240},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=605&quality=85&auto=format&fit=max&s=eac6637b6a98df58c15b09d115be318e","width":605},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=605&quality=45&auto=format&fit=max&dpr=2&s=0f32300aea5efe45b958bc9f7aaf87c0","width":1210},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=445&quality=85&auto=format&fit=max&s=0f96644163e00699ed7eded3a0531cd6","width":445},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=445&quality=45&auto=format&fit=max&dpr=2&s=c176e1080d29512c4478f3b57e0988d7","width":890}]},{"weighting":"thumbnail","srcSet":[{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=140&quality=85&auto=format&fit=max&s=6784703d48cc98f1b05fd1b076566321","width":140},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=140&quality=45&auto=format&fit=max&dpr=2&s=1554921569cb8bcf1035e46d71f7eb32","width":280},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=120&quality=85&auto=format&fit=max&s=609f4f35f1561f3402f42cbfa04b3916","width":120},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=120&quality=45&auto=format&fit=max&dpr=2&s=3591004ae2b08dd5003f92c2d154eaf5","width":240}]},{"weighting":"supporting","srcSet":[{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=380&quality=85&auto=format&fit=max&s=e02bc65784087ca75e1f591f1d86de76","width":380},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=380&quality=45&auto=format&fit=max&dpr=2&s=9438cf9947788b2c668a70f3300aab74","width":760},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=300&quality=85&auto=format&fit=max&s=a63bdfb06bb25ad636386b633ffbb208","width":300},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=300&quality=45&auto=format&fit=max&dpr=2&s=fa7b0d77dc9766455cbe99eb6c4177ae","width":600},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=620&quality=85&auto=format&fit=max&s=62c8dca7f86aba1bdc41423af408f822","width":620},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=620&quality=45&auto=format&fit=max&dpr=2&s=89942b3dacbdb5c2b2cc53f6f7017246","width":1240},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=605&quality=85&auto=format&fit=max&s=eac6637b6a98df58c15b09d115be318e","width":605},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=605&quality=45&auto=format&fit=max&dpr=2&s=0f32300aea5efe45b958bc9f7aaf87c0","width":1210},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=445&quality=85&auto=format&fit=max&s=0f96644163e00699ed7eded3a0531cd6","width":445},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=445&quality=45&auto=format&fit=max&dpr=2&s=c176e1080d29512c4478f3b57e0988d7","width":890}]},{"weighting":"showcase","srcSet":[{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=860&quality=85&auto=format&fit=max&s=62d1c137e578188bf95eff75e16855d0","width":860},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=860&quality=45&auto=format&fit=max&dpr=2&s=c026b43a3f04d4427b5c50ae4724c41c","width":1720},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=780&quality=85&auto=format&fit=max&s=eac42576a25bc960ae4f85d9f5791adf","width":780},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=780&quality=45&auto=format&fit=max&dpr=2&s=2cd983b1f3e2f1d5bcf226ea386e8b92","width":1560},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=620&quality=85&auto=format&fit=max&s=62c8dca7f86aba1bdc41423af408f822","width":620},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=620&quality=45&auto=format&fit=max&dpr=2&s=89942b3dacbdb5c2b2cc53f6f7017246","width":1240},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=605&quality=85&auto=format&fit=max&s=eac6637b6a98df58c15b09d115be318e","width":605},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=605&quality=45&auto=format&fit=max&dpr=2&s=0f32300aea5efe45b958bc9f7aaf87c0","width":1210},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=445&quality=85&auto=format&fit=max&s=0f96644163e00699ed7eded3a0531cd6","width":445},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=445&quality=45&auto=format&fit=max&dpr=2&s=c176e1080d29512c4478f3b57e0988d7","width":890}]},{"weighting":"halfwidth","srcSet":[{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=620&quality=85&auto=format&fit=max&s=62c8dca7f86aba1bdc41423af408f822","width":620},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=620&quality=45&auto=format&fit=max&dpr=2&s=89942b3dacbdb5c2b2cc53f6f7017246","width":1240},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=605&quality=85&auto=format&fit=max&s=eac6637b6a98df58c15b09d115be318e","width":605},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=605&quality=45&auto=format&fit=max&dpr=2&s=0f32300aea5efe45b958bc9f7aaf87c0","width":1210},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=445&quality=85&auto=format&fit=max&s=0f96644163e00699ed7eded3a0531cd6","width":445},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=445&quality=45&auto=format&fit=max&dpr=2&s=c176e1080d29512c4478f3b57e0988d7","width":890}]},{"weighting":"immersive","srcSet":[{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=1900&quality=85&auto=format&fit=max&s=8cd191fde6863e782eaebcf585977075","width":1900},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=1900&quality=45&auto=format&fit=max&dpr=2&s=595761b2087e6c8d9ff4cb5a98d5f0a5","width":3800},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=1300&quality=85&auto=format&fit=max&s=f79416c04b1f6528d793ab78737bf133","width":1300},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=1300&quality=45&auto=format&fit=max&dpr=2&s=ac95daa1c86f52991dfa87003b5ffdd7","width":2600},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=1140&quality=85&auto=format&fit=max&s=e43c08ae108b214ce2b13eca00ef8c0c","width":1140},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=1140&quality=45&auto=format&fit=max&dpr=2&s=db7f25bb6a37a20d2044420ad93fad42","width":2280},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=980&quality=85&auto=format&fit=max&s=13b32434465afa1235e56e881dfe4e74","width":980},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=980&quality=45&auto=format&fit=max&dpr=2&s=6b817f283041189c9563814caeb69ae4","width":1960},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=740&quality=85&auto=format&fit=max&s=833297e54bee769cf4b2f287523843ab","width":740},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=740&quality=45&auto=format&fit=max&dpr=2&s=bfa83c4100a6021d5fa3e8d9d5d2d3f9","width":1480},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=660&quality=85&auto=format&fit=max&s=296a159607829b2d7024080052b28698","width":660},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=660&quality=45&auto=format&fit=max&dpr=2&s=d0ec4a1f4fc6c6ef39422fd96d0990ac","width":1320},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=480&quality=85&auto=format&fit=max&s=14ec045b2cb93a6b0ba8bf137a2c3793","width":480},{"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=480&quality=45&auto=format&fit=max&dpr=2&s=59c4c7b3ae74e05e344621e275a56b5c","width":960}]}],"data":{"alt":"The Content API","caption":"CAPI","credit":"Photograph: The Guardian"}},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Concierge is the name of the application I mentioned earlier. Each instance maintains open connections to the ES nodes in the cluster. The REST client is not trying to be clever here, whenever there’s more than one node, requests are dispatched to each in a round-robin fashion. So, let’s address this ... we not only had a cost motivation, but also, the load-balancer is already dispatching requests using a more sophisticated routing algorithm; by using RR behind it, we were kind of ruining all of that.</p>","elementId":"ce7f3155-f36e-4f10-8da5-6fdf08a0f2e3"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Right, here’s the plan of attack:</p>","elementId":"86a7a1c3-14c0-41dd-acbb-c1eb82b6eb66"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Ensure all content is replicated in each AZ</h2>","elementId":"baf72392-78d5-45e9-bc47-e55ce1f3efe1"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Elasticsearch is a distributed application where each data node contains units of storage (shards) which contain all the content produced at the Guardian. Fortunately, it gives us the ability to determine how those units are spread and replicated. At a minimum, then, we must have two replicas for each shard, for a total of three, one in each AZ. This was already the case for us, but if it were not, all we would have to do is update the settings for each index in the cluster, e.g.</p>","elementId":"3497004a-26b9-4f40-bfa2-714756e30077"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"text","elementId":"cafcd996-deb3-49e5-9315-a9f3f6f6cc54","html":"curl -X PUT \"localhost:9200/<index>/_settings\" -H 'Content-Type: application/json' -d'\n{\n    \"index\" : {\n        \"number_of_replicas\" : 2\n    }\n}"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Ensure proper shard distribution</h2>","elementId":"264bf2f2-0ded-4530-9ccc-fc0ff31240fb"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>It is not enough to have replicas, one must make sure shards are physically distributed correctly over the network. This is achieved with <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/allocation-awareness.html\">shard allocation awareness</a>.</p>","elementId":"6f63f053-2cde-4910-bafd-3ce31e68eb98"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>We are using the <a href=\"https://www.elastic.co/guide/en/elasticsearch/plugins/current/discovery-ec2.html\">EC2 discovery plugin</a> to handle cluster formation in AWS. Luckily, it can tag an instance with an attribute, aws_availability_zone, to identify in which AZ it is. This is done in the Elasticsearch configuration:</p>","elementId":"c8df908a-d52a-4494-944c-3010a4a4ebc7"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"text","elementId":"2cd275cc-ca24-41c5-9430-5a9ea850e87e","html":"# let the EC2 discovery plugin add the aws_availability_zone attribute to the node\ncloud.node.auto_attributes: true"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>All we have to do next is use that attribute in the shard allocation awareness algorithm. This is also specified in the configuration:</p>","elementId":"f64007f1-ec4c-4ff5-b6ae-ea4be2e3626a"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"text","elementId":"e3c274d5-5bbd-4698-a1de-d6a760288f4f","html":"# let ES distribute shard according to that attribute\ncluster.routing.allocation.awareness.attributes: aws_availability_zone"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Connect clients to nodes within the same AZ</h2>","elementId":"dd640209-7fa6-4351-af28-9b88eb891697"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The cluster is now correctly setup. The next step is in Concierge – it can only connect to Elasticsearch nodes in the same AZ. To get that list of hosts, we use the EC2 API. For example:</p>","elementId":"6c74d98f-b807-4ad3-b940-f0c5bf310e12"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"scala","elementId":"ede956e1-5c4f-4544-bea9-8a068ab58641","html":"def findElasticsearchHostsInEc2(client: Ec2Client, az: String): List[HttpHost] = {\n  val request = DescribeInstancesRequest.builder.filters(\n    Filter.builder.name(\"instance-state-name\").values(InstanceStateName.Running.toString).build,\n    Filter.builder.name(\"availability-zone\").values(az).build,\n    ...\n  ).build\n  val response = client.describeInstances(request)\n  val instances = response.reservations.asScala.flatMap(_.instances.asScala)\n  instances.map(i => new HttpHost(i.privateIpAddress, 9200, \"http\"))\n}"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Ensure we can scale the cluster up and down</h2>","elementId":"9f561722-fd11-4c33-b248-17c4c09c4cbe"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>In the event where we need to scale up or down, we want Concierge to automatically update client connections. The Elasticsearch client provides a node sniffer which does exactly that.</p>","elementId":"7bf480df-bfa7-43d9-8be2-b96c43d63909"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The default implementation uses the <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-info.html\">node info API</a>, which cannot help us here as it doesn’t know anything about availability zones—and it doesn’t seem possible to restrict a query using node attributes. That’s OK, we can just provide our own, for example:</p>","elementId":"4136019b-7add-418c-920c-a8f5bb0a27d6"},{"_type":"model.dotcomrendering.pageElements.CodeBlockElement","isMandatory":false,"language":"scala","elementId":"3bff6354-c2fa-42e1-ac22-b8ea04511f01","html":"val nodesSniffer = new NodesSniffer {\n  override def sniff: java.util.List[Node] =\n    findElasticsearchHostsInEc2(ec2Client, availabilityZone)\n      .map(new Node(_))\n      .asJava\n}\n\nval sniffer = Sniffer\n  .builder(esClient.getLowLevelClient())\n  .setNodesSniffer(nodesSniffer)\n  .build"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>And voila!</p>","elementId":"a50e2d70-401d-4717-99bf-5e981750ff2b"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>So free we want to buy more</h2>","elementId":"227c37a3-cf25-4edd-9a70-7e4f25377c9c"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>With the above changes, we get all the traffic between Concierge and Elasticsearch, our most expensive cost center, for free!</p>","elementId":"4a28f6a1-e4e9-4b28-9241-40a19b56b6d1"}],"attributes":{"pinned":false,"keyEvent":false,"summary":false},"blockCreatedOn":1580834943000,"blockCreatedOnDisplay":"16.49 GMT","blockLastUpdated":1619182646000,"blockLastUpdatedDisplay":"13.57 BST","blockFirstPublished":1580834943000,"blockFirstPublishedDisplay":"16.49 GMT","blockFirstPublishedDisplayNoTimezone":"16.49","contributors":[],"primaryDateLine":"Tue 4 Feb 2020 16.49 GMT","secondaryDateLine":"Last modified on Fri 23 Apr 2021 13.57 BST"}],"author":{"byline":"Regis Kuckaertz"},"byline":"Regis Kuckaertz","webPublicationDate":"2020-02-04T16:49:03.000Z","webPublicationDateDeprecated":"2020-02-04T16:49:03.000Z","webPublicationDateDisplay":"Tue 4 Feb 2020 16.49 GMT","webPublicationSecondaryDateDisplay":"Last modified on Fri 23 Apr 2021 13.57 BST","editionLongForm":"UK edition","editionId":"UK","pageId":"info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch","canonicalUrl":"https://www.theguardian.com/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch","format":{"design":"ArticleDesign","theme":"NewsPillar","display":"StandardDisplay"},"designType":"Article","tags":[{"id":"info/series/engineering-blog","type":"Series","title":"Engineering blog"},{"id":"info/info","type":"Keyword","title":"Information"},{"id":"type/article","type":"Type","title":"Article"},{"id":"profile/regis-kuckaertz","type":"Contributor","title":"Regis Kuckaertz"}],"pillar":"news","isLegacyInteractive":false,"isImmersive":false,"sectionLabel":"Information","sectionUrl":"info/info","sectionName":"info","subMetaSectionLinks":[{"url":"/info/info","title":"Information"},{"url":"/info/series/engineering-blog","title":"Engineering blog"}],"subMetaKeywordLinks":[],"shouldHideAds":false,"isAdFreeUser":false,"webURL":"https://www.theguardian.com/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch","linkedData":[{"@type":"NewsArticle","@context":"https://schema.org","@id":"https://www.theguardian.com/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch","publisher":{"@type":"Organization","@context":"https://schema.org","@id":"https://www.theguardian.com#publisher","name":"The Guardian","url":"https://www.theguardian.com/","logo":{"@type":"ImageObject","url":"https://uploads.guim.co.uk/2018/01/31/TheGuardian_AMP.png","width":190,"height":60},"sameAs":["https://www.facebook.com/theguardian","https://twitter.com/guardian","https://www.youtube.com/user/TheGuardian"]},"isAccessibleForFree":true,"isPartOf":{"@type":["CreativeWork","Product"],"name":"The Guardian","productID":"theguardian.com:basic"},"image":["https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctZGVmYXVsdC5wbmc&enable=upscale&s=33f391a55eb076f8611d6cb4e8b0bb63","https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1200&height=1200&quality=85&auto=format&fit=crop&s=d616a42941857d023f7da27126e1f0ff","https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1200&height=900&quality=85&auto=format&fit=crop&s=193fc7ddd102456765afbbc140a62693","https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1200&quality=85&auto=format&fit=max&s=91edb0050bdd5e688dd63e2440c77c75"],"author":[{"@type":"Person","name":"Regis Kuckaertz","sameAs":"https://www.theguardian.com/profile/regis-kuckaertz"}],"datePublished":"2020-02-04T16:49:03.000Z","headline":"Taming data transfer costs with Elasticsearch","dateModified":"2021-04-23T12:57:27.000Z","mainEntityOfPage":"https://www.theguardian.com/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch"},{"@type":"WebPage","@context":"https://schema.org","@id":"https://www.theguardian.com/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch","potentialAction":{"@type":"ViewAction","target":"android-app://com.guardian/https/www.theguardian.com/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch"}}],"openGraphData":{"og:url":"http://www.theguardian.com/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch","article:author":"https://www.theguardian.com/profile/regis-kuckaertz","og:image:width":"1200","og:image":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctZGVmYXVsdC5wbmc&enable=upscale&s=33f391a55eb076f8611d6cb4e8b0bb63","al:ios:url":"gnmguardian://info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch?contenttype=Article&source=applinks","article:publisher":"https://www.facebook.com/theguardian","og:title":"Taming data transfer costs with Elasticsearch","fb:app_id":"180444840287","article:modified_time":"2021-04-23T12:57:27.000Z","og:image:height":"720","og:description":"Here we outline how an upgrade to open source search and analytics engine, Elasticsearch, led to unexpected cost-savings","og:type":"article","al:ios:app_store_id":"409128287","article:section":"Info","article:published_time":"2020-02-04T16:49:03.000Z","article:tag":"Information","al:ios:app_name":"The Guardian","og:site_name":"the Guardian"},"twitterData":{"twitter:app:id:iphone":"409128287","twitter:app:name:googleplay":"The Guardian","twitter:app:name:ipad":"The Guardian","twitter:card":"summary_large_image","twitter:app:name:iphone":"The Guardian","twitter:app:id:ipad":"409128287","twitter:app:id:googleplay":"com.guardian","twitter:app:url:googleplay":"guardian://www.theguardian.com/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch","twitter:app:url:iphone":"gnmguardian://info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch?contenttype=Article&source=twitter","twitter:image":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctZGVmYXVsdC5wbmc&s=d46277c9369ccaa8f881c9283f524370","twitter:site":"@guardian","twitter:app:url:ipad":"gnmguardian://info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch?contenttype=Article&source=twitter"},"config":{"switches":{"lightbox":true,"abPrebidKeywords":true,"personaliseSignInGateAfterCheckout":true,"abSignInGateMainVariant":true,"prebidAppnexusUkRow":true,"prebidMagnite":true,"commercialMetrics":true,"prebidTrustx":true,"scAdFreeBanner":false,"adaptiveSite":true,"prebidPermutiveAudience":true,"compareVariantDecision":false,"enableSentryReporting":true,"lazyLoadContainers":true,"ampArticleSwitch":false,"remarketing":true,"articleEndSlot":true,"keyEventsCarousel":true,"registerWithPhone":false,"darkModeWeb":true,"targeting":true,"remoteHeader":true,"slotBodyEnd":true,"ampPrebidOzone":false,"extendedMostPopularFronts":true,"emailInlineInFooter":true,"showNewPrivacyWordingOnEmailSignupEmbeds":true,"prebidAnalytics":true,"extendedMostPopular":true,"ampContentAbTesting":false,"prebidCriteo":true,"okta":true,"imrWorldwide":true,"acast":true,"twitterUwt":true,"abAuxiaSignInGate":false,"abDeferPermutiveLoad":true,"prebidAppnexusInvcode":true,"ampPrebidPubmatic":false,"a9HeaderBidding":true,"prebidAppnexus":true,"enableDiscussionSwitch":true,"prebidXaxis":true,"stickyVideos":true,"interactiveFullHeaderSwitch":true,"discussionAllPageSize":true,"prebidUserSync":true,"audioOnwardJourneySwitch":true,"abMovePermutiveSegmentation":false,"brazeTaylorReport":false,"externalVideoEmbeds":true,"abTheTradeDesk":true,"callouts":true,"sentinelLogger":true,"geoMostPopular":true,"weAreHiring":false,"relatedContent":true,"thirdPartyEmbedTracking":true,"prebidOzone":true,"ampLiveblogSwitch":false,"ampAmazon":false,"prebidAdYouLike":true,"mostViewedFronts":true,"optOutAdvertising":true,"abSignInGateMainControl":true,"googleSearch":true,"abOptOutFrequencyCap":true,"brazeSwitch":true,"prebidKargo":true,"consentManagement":true,"idProfileNavigation":true,"confiantAdVerification":true,"discussionAllowAnonymousRecommendsSwitch":false,"dcrCrosswords":true,"absoluteServerTimes":false,"permutive":true,"comscore":true,"ampPrebidCriteo":false,"prebidTheTradeDesk":true,"loopVideoTest":false,"newsletterOnwards":false,"youtubeIma":true,"webFonts":true,"liveBlogTopSponsorship":true,"abAdBlockAsk":false,"ophan":true,"crosswordSvgThumbnails":true,"prebidTriplelift":true,"prebidPubmatic":true,"serverShareCounts":false,"autoRefresh":true,"enhanceTweets":true,"prebidIndexExchange":true,"prebidOpenx":true,"prebidHeaderBidding":true,"idCookieRefresh":true,"discussionPageSize":true,"smartAppBanner":false,"historyTags":true,"brazeContentCards":true,"remoteBanner":true,"emailSignupRecaptcha":true,"prebidSmart":true,"shouldLoadGoogletag":true,"inizio":true,"europeBetaFront":true},"abTests":{},"googletagUrl":"//securepubads.g.doubleclick.net/tag/js/gpt.js","stage":"PROD","frontendAssetsFullURL":"https://assets.guim.co.uk/","ampIframeUrl":"https://assets.guim.co.uk/data/vendor/2533d5cb94302889e6a8f1b24b5329e7/amp-iframe.html","tones":"","facebookIaAdUnitRoot":"facebook-instant-articles","avatarApiUrl":"https://avatar.theguardian.com","isSplash":false,"isColumn":false,"membershipUrl":"https://membership.theguardian.com","headline":"Taming data transfer costs with Elasticsearch","isImmersive":false,"author":"Regis Kuckaertz","ipsosTag":"guardian","isProd":true,"series":"Engineering blog","toneIds":"","membershipAccess":"","allowUserGeneratedContent":false,"commissioningDesks":"","webPublicationDate":1580834943000,"forecastsapiurl":"/weatherapi/forecast","supportUrl":"https://support.theguardian.com","isNumberedList":false,"commercialBundleUrl":"https://assets.guim.co.uk/commercial/47e59a6f2531251d895a/graun.standalone.commercial.js","idOAuthUrl":"https://oauth.theguardian.com","webTitle":"Taming data transfer costs with Elasticsearch","isPhotoEssay":false,"idWebAppUrl":"https://oauth.theguardian.com","a9PublisherId":"3722","isFront":false,"inBodyInternalLinkCount":0,"googleSearchUrl":"//www.google.co.uk/cse/cse.js","inBodyExternalLinkCount":9,"showRelatedContent":true,"lightboxImages":{"id":"info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch","headline":"Taming data transfer costs with Elasticsearch","shouldHideAdverts":false,"standfirst":"<p>Here we outline how an upgrade to open source search and analytics engine, Elasticsearch, led to unexpected cost-savings</p>","images":[{"caption":"How an upgrade to open source search and analytics engine led to unexpected cost-savings","credit":"Photograph: Leonhard Föger/Reuters","displayCredit":true,"src":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=700&quality=85&auto=format&fit=max&s=b173a9e3aa77d8ab1212eccd3f3d0ca5","srcsets":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1920&quality=85&auto=format&fit=max&s=8e05c339742ec94c39464e783103cabb 1920w, https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1225&quality=85&auto=format&fit=max&s=91af05c6bc1063588e1cbd726f134b7b 1225w, https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=1065&quality=85&auto=format&fit=max&s=7b01069fdfbb5d576a4967cb6ffa36bb 1065w, https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=965&quality=85&auto=format&fit=max&s=9f7443d89f5d5ba3832ee0bb779267fe 965w, https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=725&quality=85&auto=format&fit=max&s=bb742bbda54230212c24cf439f012bb3 725w, https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=645&quality=85&auto=format&fit=max&s=ec888e891409b89df97d58c28dda66d8 645w, https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/master/3364.jpg?width=465&quality=85&auto=format&fit=max&s=49c9e31ac11e5ddbf2378c5a05d2b4a4 465w","sizes":"(min-width: 1300px) 1920px, (min-width: 1140px) 1225px, (min-width: 980px) 1065px, (min-width: 740px) 965px, (min-width: 660px) 725px, (min-width: 480px) 645px, 465px","ratio":1.6669970267591674,"role":"None","parentContentId":"info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch","id":"info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch"},{"caption":"CAPI","credit":"Photograph: The Guardian","displayCredit":true,"src":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=700&quality=85&auto=format&fit=max&s=d97433010204e9872d60185e2d0dcb97","srcsets":"https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=1920&quality=85&auto=format&fit=max&s=71cd64c69ba241ce67c4efdf776f03cb 1920w, https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=1225&quality=85&auto=format&fit=max&s=e9b7597a92ceb69b8d1ebcf9dfbf49a0 1225w, https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=1065&quality=85&auto=format&fit=max&s=da8eb5429208f8877d9535e5e8452cc6 1065w, https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=965&quality=85&auto=format&fit=max&s=87e33b796a286bb5445f1021390f45a4 965w, https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=725&quality=85&auto=format&fit=max&s=e2edfac7324c96a53de8e2c30f94472e 725w, https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=645&quality=85&auto=format&fit=max&s=7d490bf3f7ea68ed4aac905b28581dbb 645w, https://i.guim.co.uk/img/media/a7fb5090355329bd5d37f7222b4ff3d6c57c9c31/0_0_925_587/master/925.png?width=465&quality=85&auto=format&fit=max&s=f0bc3f40b7402345c3cdc5fd89849f58 465w","sizes":"(min-width: 1300px) 1920px, (min-width: 1140px) 1225px, (min-width: 980px) 1065px, (min-width: 740px) 965px, (min-width: 660px) 725px, (min-width: 480px) 645px, 465px","ratio":1.575809199318569,"role":"None","parentContentId":"info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch","id":"info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch"}]},"googleSearchId":"007466294097402385199:m2ealvuxh1i","shouldHideReaderRevenue":false,"idUrl":"https://profile.theguardian.com","hasSurveyAd":false,"omnitureAmpAccount":"guardiangu-thirdpartyapps","dfpAdUnitRoot":"theguardian.com","host":"https://www.theguardian.com","blogIds":"","sectionName":"Info","hasMultipleVideosInPage":false,"hasShowcaseMainElement":false,"googleRecaptchaSiteKey":"6LdzlmsdAAAAALFH63cBVagSFPuuHXQ9OfpIDdMc","fbAppId":"180444840287","isContent":true,"shortUrlId":"/p/d8x9d","dfpAccountId":"59666047","plistaPublicApiKey":"462925f4f131001fd974bebe","wordCount":1134,"hasLiveBlogTopAd":false,"dcrSentryDsn":"https://1937ab71c8804b2b8438178dfdd6468f@sentry.io/1377847","cardStyle":"news","adUnit":"/59666047/theguardian.com/info/article/ng","discussionApiUrl":"https://discussion.theguardian.com/discussion-api","isSensitive":false,"ophanEmbedJsUrl":"//j.ophan.co.uk/ophan.embed","edition":"UK","brazeApiKey":"7f28c639-8bda-48ff-a3f6-24345abfc07c","blogs":"","discussionApiClientHeader":"nextgen","section":"info","userAttributesApiUrl":"https://members-data-api.theguardian.com/user-attributes","videoDuration":0,"dfpHost":"pubads.g.doubleclick.net","weatherapiurl":"/weatherapi/city","sentryPublicApiKey":"344003a8d11c41d8800fbad8383fdc50","shortUrl":"https://www.theguardian.com/p/d8x9d","thumbnail":"https://i.guim.co.uk/img/media/12c27583426492e29feff5e96d9e7cc236e55864/68_0_3364_2018/500.jpg?quality=85&auto=format&fit=max&s=9ceb384b5d67af9360666aa0bf1e913b","pillar":"News","pageId":"info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch","references":[],"beaconUrl":"//phar.gu-web.net","commentable":false,"discussionD2Uid":"zHoBy6HNKsk","ophanJsUrl":"//j.ophan.co.uk/ophan.ng","contributorBio":"","keywordIds":"info/info","contentType":"Article","isDev":false,"isHosted":false,"isAdFree":false,"stripePublicToken":"pk_live_2O6zPMHXNs2AGea4bAmq5R7Z","omnitureAccount":"guardiangu-network","locationapiurl":"/weatherapi/locations?query=","authorIds":"profile/regis-kuckaertz","isPaidContent":false,"hasYouTubeAtom":false,"externalEmbedHost":"https://embed.theguardian.com","thirdPartyAppsAccount":"guardiangu-thirdpartyapps","ajaxUrl":"https://api.nextgen.guardianapps.co.uk","byline":"Regis Kuckaertz","keywords":"Information","contentId":"info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch","nonKeywordTagIds":"info/series/engineering-blog,type/article,profile/regis-kuckaertz","mobileAppsAdUnitRoot":"beta-guardian-app","hasPageSkin":false,"requiresMembershipAccess":false,"seriesTags":"Engineering blog","revisionNumber":"DEV","seriesId":"info/series/engineering-blog","optimizeEpicUrl":"https://support.theguardian.com/epic/control/index.html","assetsPath":"https://assets.guim.co.uk/","mmaUrl":"https://manage.theguardian.com","isLive":false,"richLink":"","campaigns":[],"isLiveBlog":false,"pageCode":"7067182","avatarImagesUrl":"https://avatar.guim.co.uk","publication":"theguardian.com","sentryHost":"app.getsentry.com/35463","buildNumber":"DEV","userBenefitsApiUrl":"https://user-benefits.guardianapis.com/benefits/me","sharedAdTargeting":{"se":["engineering-blog"],"ct":"article","su":["0"],"edition":"uk","p":"ng","k":["info"],"sh":"https://www.theguardian.com/p/d8x9d","co":["regis-kuckaertz"],"url":"/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch"},"onwardWebSocket":"ws://api.nextgen.guardianapps.co.uk/recently-published","productionOffice":"Uk","shouldHideAdverts":false,"idApiUrl":"https://idapi.theguardian.com","pbIndexSites":[{"bp":"D","id":208247},{"bp":"M","id":213519},{"bp":"T","id":215454}],"googletagJsUrl":"//securepubads.g.doubleclick.net/tag/js/gpt.js","calloutsUrl":"https://callouts.guardianapis.com/formstack-campaign/submit","isPreview":false},"guardianBaseURL":"https://www.theguardian.com","contentType":"Article","hasRelated":true,"hasStoryPackage":false,"beaconURL":"//phar.gu-web.net","isCommentable":false,"commercialProperties":{"US":{"adTargeting":[{"name":"su","value":["0"]},{"name":"k","value":["info"]},{"name":"edition","value":"us"},{"name":"ct","value":"article"},{"name":"co","value":["regis-kuckaertz"]},{"name":"url","value":"/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch"},{"name":"sh","value":"https://www.theguardian.com/p/d8x9d"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"}]},"AU":{"adTargeting":[{"name":"su","value":["0"]},{"name":"ct","value":"article"},{"name":"co","value":["regis-kuckaertz"]},{"name":"url","value":"/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch"},{"name":"sh","value":"https://www.theguardian.com/p/d8x9d"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"},{"name":"k","value":["info"]},{"name":"edition","value":"au"}]},"UK":{"adTargeting":[{"name":"su","value":["0"]},{"name":"k","value":["info"]},{"name":"edition","value":"uk"},{"name":"ct","value":"article"},{"name":"co","value":["regis-kuckaertz"]},{"name":"url","value":"/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch"},{"name":"sh","value":"https://www.theguardian.com/p/d8x9d"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"}]},"INT":{"adTargeting":[{"name":"su","value":["0"]},{"name":"k","value":["info"]},{"name":"ct","value":"article"},{"name":"co","value":["regis-kuckaertz"]},{"name":"url","value":"/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch"},{"name":"sh","value":"https://www.theguardian.com/p/d8x9d"},{"name":"edition","value":"int"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"}]},"EUR":{"adTargeting":[{"name":"su","value":["0"]},{"name":"k","value":["info"]},{"name":"ct","value":"article"},{"name":"co","value":["regis-kuckaertz"]},{"name":"edition","value":"eur"},{"name":"url","value":"/info/2020/feb/04/taming-data-transfer-costs-with-elasticsearch"},{"name":"sh","value":"https://www.theguardian.com/p/d8x9d"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"}]}},"pageType":{"hasShowcaseMainElement":false,"isFront":false,"isLiveblog":false,"isMinuteArticle":false,"isPaidContent":false,"isPreview":false,"isSensitive":false},"trailText":"Here we outline how an upgrade to open source search and analytics engine, Elasticsearch, led to unexpected cost-savings","nav":{"currentUrl":"/info","pillars":[{"title":"News","url":"/","longTitle":"Headlines","iconName":"home","children":[{"title":"UK","url":"/uk-news","longTitle":"UK news","children":[{"title":"UK politics","url":"/politics"},{"title":"Education","url":"/education","children":[{"title":"Schools","url":"/education/schools"},{"title":"Teachers","url":"/teacher-network"},{"title":"Universities","url":"/education/universities"},{"title":"Students","url":"/education/students"}]},{"title":"Media","url":"/media"},{"title":"Society","url":"/society"},{"title":"Law","url":"/law"},{"title":"Scotland","url":"/uk/scotland"},{"title":"Wales","url":"/uk/wales"},{"title":"Northern Ireland","url":"/uk/northernireland"}]},{"title":"US politics","url":"/us-news/us-politics"},{"title":"World","url":"/world","longTitle":"World news","children":[{"title":"Europe","url":"/world/europe-news"},{"title":"US","url":"/us-news","longTitle":"US news"},{"title":"Americas","url":"/world/americas"},{"title":"Asia","url":"/world/asia"},{"title":"Australia","url":"/australia-news","longTitle":"Australia news"},{"title":"Middle East","url":"/world/middleeast"},{"title":"Africa","url":"/world/africa"},{"title":"Inequality","url":"/inequality"},{"title":"Global development","url":"/global-development"}]},{"title":"Climate crisis","url":"/environment/climate-crisis"},{"title":"Middle East","url":"/world/middleeast"},{"title":"Ukraine","url":"/world/ukraine"},{"title":"Football","url":"/football","children":[{"title":"Live scores","url":"/football/live","longTitle":"football/live"},{"title":"Tables","url":"/football/tables","longTitle":"football/tables"},{"title":"Fixtures","url":"/football/fixtures","longTitle":"football/fixtures"},{"title":"Results","url":"/football/results","longTitle":"football/results"},{"title":"Competitions","url":"/football/competitions","longTitle":"football/competitions"},{"title":"Clubs","url":"/football/teams","longTitle":"football/teams"}]},{"title":"Newsletters","url":"/email-newsletters"},{"title":"Business","url":"/business","children":[{"title":"Economics","url":"/business/economics"},{"title":"Banking","url":"/business/banking"},{"title":"Money","url":"/money","children":[{"title":"Property","url":"/money/property"},{"title":"Pensions","url":"/money/pensions"},{"title":"Savings","url":"/money/savings"},{"title":"Borrowing","url":"/money/debt"},{"title":"Careers","url":"/money/work-and-careers"}]},{"title":"Markets","url":"/business/stock-markets"},{"title":"Project Syndicate","url":"/business/series/project-syndicate-economists"},{"title":"B2B","url":"/business-to-business"},{"title":"Retail","url":"/business/retail"}]},{"title":"Environment","url":"/environment","children":[{"title":"Climate crisis","url":"/environment/climate-crisis"},{"title":"Wildlife","url":"/environment/wildlife"},{"title":"Energy","url":"/environment/energy"},{"title":"Pollution","url":"/environment/pollution"}]},{"title":"UK politics","url":"/politics"},{"title":"Society","url":"/society"},{"title":"Science","url":"/science"},{"title":"Tech","url":"/technology"},{"title":"Global development","url":"/global-development"},{"title":"Obituaries","url":"/obituaries"}]},{"title":"Opinion","url":"/commentisfree","longTitle":"Opinion home","iconName":"home","children":[{"title":"The Guardian view","url":"/profile/editorial"},{"title":"Columnists","url":"/index/contributors"},{"title":"Cartoons","url":"/tone/cartoons"},{"title":"Opinion videos","url":"/type/video+tone/comment"},{"title":"Letters","url":"/tone/letters"}]},{"title":"Sport","url":"/sport","longTitle":"Sport home","iconName":"home","children":[{"title":"Football","url":"/football","children":[{"title":"Live scores","url":"/football/live","longTitle":"football/live"},{"title":"Tables","url":"/football/tables","longTitle":"football/tables"},{"title":"Fixtures","url":"/football/fixtures","longTitle":"football/fixtures"},{"title":"Results","url":"/football/results","longTitle":"football/results"},{"title":"Competitions","url":"/football/competitions","longTitle":"football/competitions"},{"title":"Clubs","url":"/football/teams","longTitle":"football/teams"}]},{"title":"Cricket","url":"/sport/cricket"},{"title":"Rugby union","url":"/sport/rugby-union"},{"title":"Tennis","url":"/sport/tennis"},{"title":"Cycling","url":"/sport/cycling"},{"title":"F1","url":"/sport/formulaone"},{"title":"Golf","url":"/sport/golf"},{"title":"Boxing","url":"/sport/boxing"},{"title":"Rugby league","url":"/sport/rugbyleague"},{"title":"Racing","url":"/sport/horse-racing"},{"title":"US sports","url":"/sport/us-sport"}]},{"title":"Culture","url":"/culture","longTitle":"Culture home","iconName":"home","children":[{"title":"Film","url":"/film"},{"title":"Music","url":"/music"},{"title":"TV & radio","url":"/tv-and-radio"},{"title":"Books","url":"/books"},{"title":"Art & design","url":"/artanddesign"},{"title":"Stage","url":"/stage"},{"title":"Games","url":"/games"},{"title":"Classical","url":"/music/classicalmusicandopera"}]},{"title":"Lifestyle","url":"/lifeandstyle","longTitle":"Lifestyle home","iconName":"home","children":[{"title":"The Filter","url":"/uk/thefilter"},{"title":"Fashion","url":"/fashion"},{"title":"Food","url":"/food"},{"title":"Recipes","url":"/tone/recipes"},{"title":"Travel","url":"/travel","children":[{"title":"UK","url":"/travel/uk"},{"title":"Europe","url":"/travel/europe"},{"title":"US","url":"/travel/usa"}]},{"title":"Health & fitness","url":"/lifeandstyle/health-and-wellbeing"},{"title":"Women","url":"/lifeandstyle/women"},{"title":"Men","url":"/lifeandstyle/men"},{"title":"Love & sex","url":"/lifeandstyle/love-and-sex"},{"title":"Beauty","url":"/fashion/beauty"},{"title":"Home & garden","url":"/lifeandstyle/home-and-garden"},{"title":"Money","url":"/money","children":[{"title":"Property","url":"/money/property"},{"title":"Pensions","url":"/money/pensions"},{"title":"Savings","url":"/money/savings"},{"title":"Borrowing","url":"/money/debt"},{"title":"Careers","url":"/money/work-and-careers"}]},{"title":"Cars","url":"/technology/motoring"}]}],"otherLinks":[{"title":"The Guardian app","url":"https://app.adjust.com/16xt6hai"},{"title":"Video","url":"/video"},{"title":"Podcasts","url":"/podcasts"},{"title":"Pictures","url":"/inpictures"},{"title":"Newsletters","url":"/email-newsletters"},{"title":"Today's paper","url":"/theguardian","children":[{"title":"Obituaries","url":"/obituaries"},{"title":"G2","url":"/theguardian/g2"},{"title":"Journal","url":"/theguardian/journal"},{"title":"Saturday","url":"/theguardian/saturday"}]},{"title":"Inside the Guardian","url":"https://www.theguardian.com/insidetheguardian"},{"title":"The Observer","url":"/observer","children":[{"title":"Comment","url":"/theobserver/news/comment"},{"title":"The New Review","url":"/theobserver/new-review"},{"title":"Observer Magazine","url":"/theobserver/magazine"},{"title":"Observer Food Monthly","url":"/theobserver/foodmonthly"}]},{"title":"Guardian Weekly","url":"https://www.theguardian.com/weekly?INTCMP=gdnwb_mawns_editorial_gweekly_GW_TopNav_UK"},{"title":"Crosswords","url":"/crosswords","children":[{"title":"Blog","url":"/crosswords/crossword-blog"},{"title":"Quick","url":"/crosswords/series/quick"},{"title":"Speedy","url":"/crosswords/series/speedy"},{"title":"Quick cryptic","url":"/crosswords/series/quick-cryptic"},{"title":"Everyman","url":"/crosswords/series/everyman"},{"title":"Quiptic","url":"/crosswords/series/quiptic"},{"title":"Cryptic","url":"/crosswords/series/cryptic"},{"title":"Prize","url":"/crosswords/series/prize"},{"title":"Azed","url":"/crosswords/series/azed"},{"title":"Genius","url":"/crosswords/series/genius"},{"title":"Weekend","url":"/crosswords/series/weekend-crossword"},{"title":"Special","url":"/crosswords/series/special"}]},{"title":"Wordiply","url":"https://www.wordiply.com"},{"title":"Corrections","url":"/theguardian/series/corrections-and-clarifications"}],"brandExtensions":[{"title":"Search jobs","url":"https://jobs.theguardian.com"},{"title":"Hire with Guardian Jobs","url":"https://recruiters.theguardian.com/?utm_source=gdnwb&utm_medium=navbar&utm_campaign=Guardian_Navbar_Recruiters&CMP_TU=trdmkt&CMP_BUNIT=jobs"},{"title":"Holidays","url":"https://holidays.theguardian.com?INTCMP=holidays_uk_web_newheader"},{"title":"Live events","url":"https://www.theguardian.com/guardian-live-events?INTCMP=live_uk_header_dropdown"},{"title":"About Us","url":"/about"},{"title":"Digital Archive","url":"https://theguardian.newspapers.com"},{"title":"Guardian Print Shop","url":"/artanddesign/series/gnm-print-sales"},{"title":"Patrons","url":"https://patrons.theguardian.com/?INTCMP=header_patrons"},{"title":"Guardian Licensing","url":"https://licensing.theguardian.com/"}],"readerRevenueLinks":{"header":{"contribute":"https://support.theguardian.com/contribute?INTCMP=header_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=header_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=header_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=header_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_supporter_cta%22%7D"},"footer":{"contribute":"https://support.theguardian.com/contribute?INTCMP=footer_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=footer_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=footer_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=footer_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_supporter_cta%22%7D"},"sideMenu":{"contribute":"https://support.theguardian.com/contribute?INTCMP=side_menu_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22side_menu_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=side_menu_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22side_menu_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=side_menu_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22side_menu_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=mobilenav_print_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22mobilenav_print_cta%22%7D"},"ampHeader":{"contribute":"https://support.theguardian.com/contribute?INTCMP=header_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=header_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=amp_header_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22amp_header_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=header_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_supporter_cta%22%7D"},"ampFooter":{"contribute":"https://support.theguardian.com/contribute?INTCMP=amp_footer_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22amp_footer_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=amp_footer_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22amp_footer_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=footer_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=amp_footer_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22amp_footer_supporter_cta%22%7D"}}},"showBottomSocialButtons":true,"pageFooter":{"footerLinks":[[{"text":"About us","url":"/about","dataLinkName":"uk : footer : about us","extraClasses":""},{"text":"Help","url":"https://manage.theguardian.com/help-centre","dataLinkName":"uk : footer : tech feedback","extraClasses":"js-tech-feedback-report"},{"text":"Complaints & corrections","url":"/info/complaints-and-corrections","dataLinkName":"complaints","extraClasses":""},{"text":"SecureDrop","url":"https://www.theguardian.com/securedrop","dataLinkName":"securedrop","extraClasses":""},{"text":"Work for us","url":"https://workforus.theguardian.com","dataLinkName":"uk : footer : work for us","extraClasses":""},{"text":"Privacy policy","url":"/info/privacy","dataLinkName":"privacy","extraClasses":""},{"text":"Cookie policy","url":"/info/cookies","dataLinkName":"cookie","extraClasses":""},{"text":"Terms & conditions","url":"/help/terms-of-service","dataLinkName":"terms","extraClasses":""},{"text":"Contact us","url":"/help/contact-us","dataLinkName":"uk : footer : contact us","extraClasses":""}],[{"text":"All topics","url":"/index/subjects/a","dataLinkName":"uk : footer : all topics","extraClasses":""},{"text":"All writers","url":"/index/contributors","dataLinkName":"uk : footer : all contributors","extraClasses":""},{"text":"Modern Slavery Act","url":"https://uploads.guim.co.uk/2024/09/04/Modern_Slavery_Statement_2024_.pdf","dataLinkName":"uk : footer : modern slavery act statement","extraClasses":""},{"text":"Tax strategy","url":"https://uploads.guim.co.uk/2024/08/27/TAX_STRATEGY_FOR_THE_YEAR_ENDED_31_MARCH_2025.pdf","dataLinkName":"uk : footer : tax strategy","extraClasses":""},{"text":"Digital newspaper archive","url":"https://theguardian.newspapers.com","dataLinkName":"digital newspaper archive","extraClasses":""},{"text":"Facebook","url":"https://www.facebook.com/theguardian","dataLinkName":"uk : footer : facebook","extraClasses":""},{"text":"YouTube","url":"https://www.youtube.com/user/TheGuardian","dataLinkName":"uk : footer : youtube","extraClasses":""},{"text":"Instagram","url":"https://www.instagram.com/guardian","dataLinkName":"uk : footer : instagram","extraClasses":""},{"text":"LinkedIn","url":"https://www.linkedin.com/company/theguardian","dataLinkName":"uk : footer : linkedin","extraClasses":""},{"text":"Newsletters","url":"/email-newsletters?INTCMP=DOTCOM_FOOTER_NEWSLETTER_UK","dataLinkName":"uk : footer : newsletters","extraClasses":""}],[{"text":"Advertise with us","url":"https://advertising.theguardian.com","dataLinkName":"uk : footer : advertise with us","extraClasses":""},{"text":"Guardian Labs","url":"/guardian-labs","dataLinkName":"uk : footer : guardian labs","extraClasses":""},{"text":"Search jobs","url":"https://jobs.theguardian.com","dataLinkName":"uk : footer : jobs","extraClasses":""},{"text":"Patrons","url":"https://patrons.theguardian.com?INTCMP=footer_patrons","dataLinkName":"uk : footer : patrons","extraClasses":""}]]},"publication":"theguardian.com","shouldHideReaderRevenue":false,"slotMachineFlags":"","contributionsServiceUrl":"https://contributions.guardianapis.com","isSpecialReport":false,"showTableOfContents":false,"lang":"en","isRightToLeftLang":false}