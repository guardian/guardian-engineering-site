{"version":3,"headline":"Upgrading Elasticsearch: Content API’s dual stack strategy","standfirst":"<p>Evaluation and explanation of process used to upgrade Elasticsearch with Route53 and a dual stack strategy on the Content API team at the Guardian. </p>","webTitle":"Upgrading Elasticsearch: Content API’s dual stack strategy","mainMediaElements":[{"displayCredit":true,"_type":"model.dotcomrendering.pageElements.ImageBlockElement","role":"inline","media":{"allImages":[{"index":0,"fields":{"height":"1020","width":"680"},"mediaType":"Image","mimeType":"image/jpeg","url":"http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg"},{"index":1,"fields":{"height":"720","width":"480"},"mediaType":"Image","mimeType":"image/jpeg","url":"http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497959/6ad11e77-1a24-4c24-9e60-aaeab30d61c8-480x720.jpeg"},{"index":2,"fields":{"height":"420","width":"280"},"mediaType":"Image","mimeType":"image/jpeg","url":"http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2015/3/25/1427302498126/c975b09d-f176-4ecb-aa9c-a3da840c1c1f-280x420.jpeg"},{"index":3,"fields":{"height":"600","width":"400"},"mediaType":"Image","mimeType":"image/jpeg","url":"http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2015/3/25/1427302498302/7af797e7-f59f-42fc-bfb6-0b6a46180fae-400x600.jpeg"},{"index":4,"fields":{"height":"480","width":"320"},"mediaType":"Image","mimeType":"image/jpeg","url":"http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2015/3/25/1427302498462/57af06d4-4e98-4ddb-a204-20a72963091c-320x480.jpeg"},{"index":5,"fields":{"height":"300","width":"200"},"mediaType":"Image","mimeType":"image/jpeg","url":"http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2015/3/25/1427302498598/a43b9807-e9d1-458a-973c-aed675e902a3-200x300.jpeg"},{"index":6,"fields":{"height":"360","width":"240"},"mediaType":"Image","mimeType":"image/jpeg","url":"http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2015/3/25/1427302498719/3ed9aa8b-defe-46ab-86d7-838e04672765-240x360.jpeg"},{"index":7,"fields":{"height":"660","width":"440"},"mediaType":"Image","mimeType":"image/jpeg","url":"http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2015/3/25/1427302498858/b3882412-4d28-41ba-b81e-3cba0ebab676-440x660.jpeg"},{"index":8,"fields":{"height":"540","width":"360"},"mediaType":"Image","mimeType":"image/jpeg","url":"http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2015/3/25/1427302499050/b4ecb955-9b22-4f48-97f5-743d88b746a6-360x540.jpeg"},{"index":9,"fields":{"height":"240","width":"160"},"mediaType":"Image","mimeType":"image/jpeg","url":"http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2015/3/25/1427302499185/d75113a0-6b4a-4b39-b414-4339605643b8-160x240.jpeg"},{"index":10,"fields":{"height":"180","width":"120"},"mediaType":"Image","mimeType":"image/jpeg","url":"http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2015/3/25/1427302499345/3a9fa214-fbab-4bbf-aa91-c3697928dd67-120x180.jpeg"}]},"elementId":"912a5dfb-ea5c-4bc9-9ff1-76ab687b84f4","imageSources":[{"weighting":"inline","srcSet":[{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=620&quality=85&auto=format&fit=max&s=096ac4d27c5d6a9ed787eab2f0ee52b1","width":620},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=620&quality=45&auto=format&fit=max&dpr=2&s=86c2557a563bcb8532cfbb7f9b72147a","width":1240},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=700&quality=85&auto=format&fit=max&s=6ed5698436d18b4b15862badcd763580","width":700},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=700&quality=45&auto=format&fit=max&dpr=2&s=7b400bfe7552717f7e4aa67fcf4427b7","width":1400},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=620&quality=85&auto=format&fit=max&s=096ac4d27c5d6a9ed787eab2f0ee52b1","width":620},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=620&quality=45&auto=format&fit=max&dpr=2&s=86c2557a563bcb8532cfbb7f9b72147a","width":1240},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=645&quality=85&auto=format&fit=max&s=e3ccf7e09816532ce0ee7c8a11db698c","width":645},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=645&quality=45&auto=format&fit=max&dpr=2&s=b52f9dc7d6b4ff32f1428d1f7d49dec8","width":1290},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=465&quality=85&auto=format&fit=max&s=2fde5b60b1d89ba76c4bfd9d02000c25","width":465},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=465&quality=45&auto=format&fit=max&dpr=2&s=e33bb36c433a4d58a6b7da6f58d7394e","width":930}]},{"weighting":"thumbnail","srcSet":[]},{"weighting":"supporting","srcSet":[]},{"weighting":"showcase","srcSet":[{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=1020&quality=85&auto=format&fit=max&s=821cabb049b19bb1278da74ab3aa133f","width":1020},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=1020&quality=45&auto=format&fit=max&dpr=2&s=69342ef766b1168c42a8830704a236e6","width":2040},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=940&quality=85&auto=format&fit=max&s=23386d3eaa89a15c05764ccf6370b6d4","width":940},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=940&quality=45&auto=format&fit=max&dpr=2&s=82ca712dc06be46c841a205a1a0c4e47","width":1880},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=700&quality=85&auto=format&fit=max&s=6ed5698436d18b4b15862badcd763580","width":700},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=700&quality=45&auto=format&fit=max&dpr=2&s=7b400bfe7552717f7e4aa67fcf4427b7","width":1400},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=700&quality=85&auto=format&fit=max&s=6ed5698436d18b4b15862badcd763580","width":700},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=700&quality=45&auto=format&fit=max&dpr=2&s=7b400bfe7552717f7e4aa67fcf4427b7","width":1400},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=660&quality=85&auto=format&fit=max&s=bdee7d844c06fd169e5883f943028e84","width":660},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=660&quality=45&auto=format&fit=max&dpr=2&s=d374458039964a6d7131eb8d621a2faa","width":1320},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=645&quality=85&auto=format&fit=max&s=e3ccf7e09816532ce0ee7c8a11db698c","width":645},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=645&quality=45&auto=format&fit=max&dpr=2&s=b52f9dc7d6b4ff32f1428d1f7d49dec8","width":1290},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=465&quality=85&auto=format&fit=max&s=2fde5b60b1d89ba76c4bfd9d02000c25","width":465},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=465&quality=45&auto=format&fit=max&dpr=2&s=e33bb36c433a4d58a6b7da6f58d7394e","width":930}]},{"weighting":"halfwidth","srcSet":[]},{"weighting":"immersive","srcSet":[{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=1900&quality=85&auto=format&fit=max&s=ec4c5ec29188ed0f5ef6fe2316dcb660","width":1900},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=1900&quality=45&auto=format&fit=max&dpr=2&s=b1ecf18d7d04e0fe114278744d10331e","width":3800},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=1300&quality=85&auto=format&fit=max&s=4fdc4e7e9694290416bfd7848bd659a5","width":1300},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=1300&quality=45&auto=format&fit=max&dpr=2&s=cbede562fa030c94223f93291deb30ce","width":2600},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=1140&quality=85&auto=format&fit=max&s=8ab3c17cf3f5db6b9f595cd13cc60266","width":1140},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=1140&quality=45&auto=format&fit=max&dpr=2&s=afe61023aeb37ad18a954cb228c3656b","width":2280},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=980&quality=85&auto=format&fit=max&s=df79f7f1c356d04ef6d1ccdcae84883e","width":980},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=980&quality=45&auto=format&fit=max&dpr=2&s=cb9695e71bdf927680615aa590179b37","width":1960},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=740&quality=85&auto=format&fit=max&s=8fb8e5cfe5d2c76db73c91aa642b0c66","width":740},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=740&quality=45&auto=format&fit=max&dpr=2&s=86fdab6c57c9392fc7ccc6eb2e3e1160","width":1480},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=660&quality=85&auto=format&fit=max&s=bdee7d844c06fd169e5883f943028e84","width":660},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=660&quality=45&auto=format&fit=max&dpr=2&s=d374458039964a6d7131eb8d621a2faa","width":1320},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=480&quality=85&auto=format&fit=max&s=ec03ab1d388817295413aaba15390cf1","width":480},{"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=480&quality=45&auto=format&fit=max&dpr=2&s=2a7b3f7a9a020297127ec3cccd55e50b","width":960}]}],"data":{"alt":"Content API lego tower","caption":"Content API’s infamous lego tower.","credit":"Photograph: Digital Development at the Guardian"}}],"main":"<figure class=\"element element-image\" data-media-id=\"376ea799b303d188ea8a35e082f44664bc419b2c\"> <img src=\"http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2015/3/25/1427302498126/c975b09d-f176-4ecb-aa9c-a3da840c1c1f-280x420.jpeg\" alt=\"Content API lego tower\" width=\"280\" height=\"420\" class=\"gu-image\" /> <figcaption> <span class=\"element-image__caption\">Content API’s infamous lego tower.</span> <span class=\"element-image__credit\">Photograph: Digital Development at the Guardian</span> </figcaption> </figure>","filterKeyEvents":false,"keyEvents":[],"blocks":[{"id":"55128571e4b0eb9e6a3d402a","elements":[{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Here on the <a href=\"http://open-platform.theguardian.com/\">Content API</a> team, we’ve recently had to upgrade <a href=\"https://www.elastic.co/products/elasticsearch\">Elasticsearch</a> on our cluster. The upgrade was especially painful because we were several major versions behind the latest (we were running Elasticsearch 1.1.1) meaning that we would need to recreate the Elasticsearch index. The reason for running such an old version was that we have been focused on stability over the last few months in light of the release of the new theguardian.com website, which meant avoiding potentially disruptive operations such as upgrades.<br></p>","elementId":"7c1b020e-583d-4828-bff2-13441eb8e6de"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>We set out with the following goals for our Elasticsearch upgrade:<br></p>","elementId":"bcfaaa03-3753-4eac-acad-f44d5aaeb739"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<ul>\n <li>zero downtime to any of our clients</li>\n <li>the ability to easily switch back in the event of any problems</li>\n <li>increased automation, to make it easier on whoever has to do this next (ha!)</li>\n</ul>","elementId":"7b08e700-ed6f-4aab-8cea-73741af088ae"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>With these goals in mind, we decided to try out AWS’s Route 53 service.</p>","elementId":"9a646e40-89cb-41a9-93dd-72766365e7bf"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Route 53</h2>","elementId":"00b13734-0583-4942-8684-60e67bbd1d82"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Route 53 is “a highly available and scalable cloud Domain Name System (DNS) web service” provided by Amazon Web Services. Effectively what this means is that it allows you to connect requests from your users to your applications (running on infrastructure inside or outside of AWS), with support for a variety of different routing strategies (latency-based routing, weighted round robin etc.)<br></p>","elementId":"b2986883-6cff-4ca3-bdaf-f0b1d3509b4c"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Beyond our already heavy use of AWS and the fact that it plays nicely with our existing AWS infrastructure, we primarily decided on Route 53 because it gives us fine-grained control over what percentage of traffic goes where. This allows us, for example, to spin up a new stack on demand for a particularly risky change and direct a small percentage of traffic to it to test it out in the wild under production conditions. Or, in the case of our Elasticsearch upgrade, move all of our traffic to a replica stack so we can work on our existing stack in isolation, without fear of causing catastrophic problems in production.<br></p>","elementId":"13c4a133-ad17-43eb-b3c5-2b59f9e98dc3"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>This granular control of traffic means you can ramp up at your own pace while providing 0% downtime, with Route 53 respecting the TTL of the Elastic Load Balancers (60 seconds), allowing for quick failover in the event of an incident. Route 53 also provides us with the possibility of using round robin/blue-green deployment, something we are keen to consider at some point.<br></p>","elementId":"98ac0931-d042-431f-a1ed-db98b68ab78b"},{"_type":"model.dotcomrendering.pageElements.PullquoteBlockElement","role":"inline","attribution":"","elementId":"e6d554b1-f9b6-4f46-95da-a685cc2dcb8b","isThirdPartyTracking":false,"html":"Granular control of traffic means you can ramp up at your own pace while providing 0% downtime."},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>If you want to learn more about Amazon’s Route 53 you can view the documentation here: <a href=\"http://aws.amazon.com/documentation/route53/\">http://aws.amazon.com/documentation/route53/</a><br></p>","elementId":"ca69ca31-a023-4d86-9e24-7db47478a64b"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Upgrading Elasticsearch on the Content API</h2>","elementId":"57a3ef8d-7c09-4883-a35f-9d3b0cc53c3c"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Our high level strategy for upgrading Elasticsearch with Route 53 was:<br></p>","elementId":"6140fd95-f35c-4141-9e3c-fdf0e6bb4f11"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<ol>\n <li>Create a new stack with the new Elasticsearch version.</li>\n <li>Populate that stack with all of the data matching the existing stack, whilst ensuring that both stacks are also receiving all new updates.</li>\n <li>Configure Route 53 to direct traffic to the new stack, ramping up slowly while monitoring for issues.</li>\n <li>Upgrade Elasticsearch on the existing stack.</li>\n <li>Point Route 53 back to the newly upgraded stack, ramping up slowly once again.</li>\n <li>After ensuring everything is running smoothly, delete the replica stack.</li>\n</ol>","elementId":"dc3356c1-6e31-4945-b920-d3f1a336325d"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Difficulties experienced</h2>","elementId":"17b246ee-7128-4f46-a97b-bea719a561e9"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Although using Route 53 has been beneficial in helping us upgrade Elasticsearch and minimize the impact on end users, we did have some difficulties. The most problematic issue was that many of our API clients did not respect the DNS record time to live (TTL) values being broadcast by Route 53. As we ramped up the ratio of traffic being directed to the replica stack, we quickly found with our internal monitoring tools that our Route 53 settings were not being reflected in the number of requests hitting the respective load balancers of each stack.<br></p>","elementId":"e2dd883c-2845-45ce-bade-d9c064e5e817"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>When clients receive DNS records from Route 53, those records come with a TTL (in our case, this was set to 60 seconds). So clients should only use an IP address for 60 seconds, before contacting the Route 53 DNS servers again to perform another DNS resolution. This means that when we tell Route 53 to route clients to a new stack, the change should take effect within 60 seconds. But this was not happening - some clients were ignoring the TTL of the DNS record and continuing to connect to the original stack indefinitely. This was worrying, as it means we can’t failover to a new stack quickly in the event of any problems with the current stack.<br></p>","elementId":"f8a6fcab-8b18-479f-a08a-ce229d59bccb"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>As we could see which API keys were hitting which load balancer, we are able to work out that the problem was not systematic, but rather specific to certain clients who were using our very own <a href=\"https://github.com/guardian/content-api-scala-client\">Content API Scala client</a>. This raised suspicions that the Scala client was over-zealously caching DNS records.<br></p>","elementId":"5556c65a-7f23-492f-b776-736c68185d32"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>How we Tested</h2>","elementId":"73efb325-8f4a-4d72-9626-31991ce53944"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>The problem with troubleshooting this issue was that DNS caching can happen at so many levels of the stack. The Content API Scala client uses the <a href=\"https://github.com/dispatch/reboot\">Dispatch</a> HTTP client internally, which is built on top of <a href=\"https://github.com/AsyncHttpClient/async-http-client\">AsyncHttpClient</a>, which in turn uses Netty for its low-level HTTP processing. Moving further down the stack, the JRE also performs DNS caching (although it is only enabled under certain conditions) and the OS also has a DNS cache.</p>","elementId":"f922ffde-1ba5-4ef1-bb67-fc38b0cc7620"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>We started at the bottom of the stack, checking that the OS was respecting the TTL of DNS records. This was pretty simple to test. We just set up a loop to send a request every few seconds using curl, changed the Route 53 settings, and checked that curl started connecting to the new IP address after 60 seconds.<br></p>","elementId":"18a02c78-f37e-444b-be9e-cf00a6214f22"},{"_type":"model.dotcomrendering.pageElements.EmbedBlockElement","isMandatory":false,"sourceDomain":"gist.github.com","safe":false,"alt":"Code sample.","elementId":"dce55693-857d-47ad-881b-f4630f1614a0","isThirdPartyTracking":true,"html":"<script src=\"https://gist.github.com/LATaylor-guardian/eba99e74e89f421d72f3.js\"></script>"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Having eliminated the OS, we looked at the Java runtime’s DNS caching functionality. After trawling through a lot of contradictory documentation and JDK source code, we decided that the JRE was not the culprit. Because we are not using a SecurityDispatcher, the JRE does not cache DNS records for more than 30 seconds.</p>","elementId":"91c9fbc8-a27a-4a99-ba4b-f6985e9e0b43"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Finally we wrote a simple test harness for the Scala client. It used basically the same approach as we used to test the OS-level DNS cache above, but this time sending requests using the Scala client and using tcpdump to see what IP address the client was connecting to.</p>","elementId":"9535403d-4a7f-415d-8fe8-0e6cd24164d0"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>What we found</h2>","elementId":"d0a60980-bf66-4e3b-bf00-00b0c27d56bf"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Hunting through the source code of Dispatch, AsyncHttpClient and Netty, we eventually narrowed it down to AsyncHttpClient. As a performance optimisation, AsyncHttpClient pools Netty channels for reuse. By default it expires an idle connection after 60 seconds, but if a connection is used more than once per minute then it will be pooled and reused indefinitely. Of course, most of the internal Guardian services that use the Content API make a lot more than one request per minute!</p>","elementId":"8e5ed99a-e4e1-40fa-8f1f-42746a043e69"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Resolution for the Content API Scala client</h2>","elementId":"457dec9c-4d17-4410-962c-308935efdb44"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Luckily, this channel pooling behaviour is configurable, so it turned out to be <a href=\"https://github.com/guardian/content-api-scala-client/pull/65\">a one line fix</a>. We simply had to configure AsyncHttpClient not to reuse connections for more than 60 seconds.</p>","elementId":"ccc86c2f-4875-4e01-8966-9dcbd45bd649"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Resolution for Other Clients</h2>","elementId":"65831f0f-5a77-4120-9378-b518a804051f"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Besides the Content API Scala client, the same problem also occurred in a number of other applications, namely those using the Play framework’s ‘play-ws’ library. Like Dispatch, play-ws uses AsyncHttpClient internally, so these applications needed to be fixed in the same way.</p>","elementId":"19f8602d-d308-4514-9911-fb91405c9c78"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Unfortunately Play does not make it possible to access the configuration parameter that we need to set, so we wrote <a href=\"https://github.com/cb372/play-configurable-ningwsplugin\">a Play plugin</a> that does. We’ve also made a pull request to the Play framework to make this possible without a plugin in future.</p>","elementId":"cabe4434-489f-4d54-8d0d-45cedba257a6"},{"_type":"model.dotcomrendering.pageElements.SubheadingBlockElement","html":"<h2>Conclusions</h2>","elementId":"12c45390-79d9-4da7-952a-99bc85c4826d"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Overall, we’re somewhat sceptical that Route 53 as an out-of-the-box solution is the right one for us going forward. As most of the heavy consumers of the Content API reside internally at the Guardian and therefore use the <a href=\"https://github.com/guardian/content-api-scala-client\">Scala client</a> for the Content API, we can ensure that the DNS TTLs are respected by a majority of clients. And this also rings true for those external clients using the latest version of the Scala client (which we most certainly recommend). But for those who choose not to use the Scala client and roll their own solution, we have no guarantee that they will respect the TTLs of our DNS records.</p>","elementId":"82f95aa8-853f-49ef-a9de-ae1e119a612a"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>Now that we have rolled out our update to the Content API Scala client, we have an effective means for upgrading Elasticsearch for the time being in a manner that satisfies the needs of the Guardian. But as the Content API becomes more and more widely used externally, the need for a more resilient solution will only continue to grow.</p>","elementId":"fce2b30d-25ff-427b-9c22-beb4b0201af0"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>An alternative solution that would give us more control would be to place a proxy server such as <a href=\"http://www.haproxy.org/\">HAProxy</a> in front of our stacks. This would allow us to route traffic dynamically, with the bonus that any routing changes can be applied instantly. But it comes with an operations overhead, as it is one more system to maintain. It’s also a potentially dangerous single point of failure, as a typo in the proxy server’s configuration file could stop any traffic from reaching our API.</p>","elementId":"b4032961-f27a-43bf-8e1f-8e88f31f5db2"},{"_type":"model.dotcomrendering.pageElements.TextBlockElement","html":"<p>If there are any other solutions for zero-downtime, granular cross-stack routing on AWS, we’d love to hear about them! Please let us know in the comments, the <a href=\"https://groups.google.com/forum/#!forum/guardian-api-talk\">Guardian API Google group</a> or contact us on <a href=\"https://twitter.com/openplatform\">Twitter</a>.</p>","elementId":"2f0b4707-0dfb-491d-be4e-902c27df09df"}],"attributes":{"pinned":false,"keyEvent":false,"summary":false},"blockCreatedOn":1427381763000,"blockCreatedOnDisplay":"14.56 GMT","blockLastUpdated":1427290688000,"blockLastUpdatedDisplay":"13.38 GMT","blockFirstPublished":1427381763000,"blockFirstPublishedDisplay":"14.56 GMT","blockFirstPublishedDisplayNoTimezone":"14.56","contributors":[],"primaryDateLine":"Thu 26 Mar 2015 14.56 GMT","secondaryDateLine":"Last modified on Thu 12 Nov 2020 16.31 GMT"}],"author":{"byline":"Luke Taylor and Chris Birchall"},"byline":"Luke Taylor and Chris Birchall","webPublicationDate":"2015-03-26T14:56:03.000Z","webPublicationDateDeprecated":"2015-03-26T14:56:03.000Z","webPublicationDateDisplay":"Thu 26 Mar 2015 14.56 GMT","webPublicationSecondaryDateDisplay":"Last modified on Thu 12 Nov 2020 16.31 GMT","editionLongForm":"UK edition","editionId":"UK","pageId":"info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy","canonicalUrl":"https://www.theguardian.com/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy","format":{"design":"ArticleDesign","theme":"NewsPillar","display":"StandardDisplay"},"designType":"Article","tags":[{"id":"info/series/engineering-blog","type":"Series","title":"Engineering blog"},{"id":"technology/technology","type":"Keyword","title":"Technology"},{"id":"technology/programming","type":"Keyword","title":"Programming"},{"id":"technology/cloud-computing","type":"Keyword","title":"Cloud computing"},{"id":"technology/computing","type":"Keyword","title":"Computing"},{"id":"technology/internet","type":"Keyword","title":"Internet"},{"id":"type/article","type":"Type","title":"Article"},{"id":"tone/blog","type":"Tone","title":"Blogposts"},{"id":"profile/luke-taylor","type":"Contributor","title":"Luke Taylor"},{"id":"profile/chris-birchall","type":"Contributor","title":"Chris Birchall"}],"pillar":"news","isLegacyInteractive":false,"isImmersive":false,"sectionLabel":"Technology","sectionUrl":"technology/technology","sectionName":"info","subMetaSectionLinks":[{"url":"/technology/technology","title":"Technology"},{"url":"/info/series/engineering-blog","title":"Engineering blog"}],"subMetaKeywordLinks":[{"url":"/technology/programming","title":"Programming"},{"url":"/technology/cloud-computing","title":"Cloud computing"},{"url":"/technology/computing","title":"Computing"},{"url":"/technology/internet","title":"Internet"},{"url":"/tone/blog","title":"blogposts"}],"shouldHideAds":false,"isAdFreeUser":false,"webURL":"https://www.theguardian.com/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy","linkedData":[{"@type":"NewsArticle","@context":"https://schema.org","@id":"https://www.theguardian.com/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy","publisher":{"@type":"Organization","@context":"https://schema.org","@id":"https://www.theguardian.com#publisher","name":"The Guardian","url":"https://www.theguardian.com/","logo":{"@type":"ImageObject","url":"https://uploads.guim.co.uk/2018/01/31/TheGuardian_AMP.png","width":190,"height":60},"sameAs":["https://www.facebook.com/theguardian","https://twitter.com/guardian","https://www.youtube.com/user/TheGuardian"]},"isAccessibleForFree":true,"isPartOf":{"@type":["CreativeWork","Product"],"name":"The Guardian","productID":"theguardian.com:basic"},"image":["https://i.guim.co.uk/img/media/315f4f55befeba7522ba1a4c237e6d78ffb6b4a7/0_0_1020_612/master/1020.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctYWdlLTIwMTUucG5n&enable=upscale&s=a9f3ff52025ec084b8cc7ba9c8f5c3d1","https://i.guim.co.uk/img/media/315f4f55befeba7522ba1a4c237e6d78ffb6b4a7/0_0_1020_612/master/1020.jpg?width=1200&height=1200&quality=85&auto=format&fit=crop&s=7eaa595bed80f2884d97354a360997fd","https://i.guim.co.uk/img/media/315f4f55befeba7522ba1a4c237e6d78ffb6b4a7/0_0_1020_612/master/1020.jpg?width=1200&height=900&quality=85&auto=format&fit=crop&s=502ca3f63dd5aec157a4e106ec0a9cde","https://i.guim.co.uk/img/media/315f4f55befeba7522ba1a4c237e6d78ffb6b4a7/0_0_1020_612/master/1020.jpg?width=1200&quality=85&auto=format&fit=max&s=eaab70e178c8767f7944563a833da6b8"],"author":[{"@type":"Person","name":"Luke Taylor","sameAs":"https://www.theguardian.com/profile/luke-taylor"},{"@type":"Person","name":"Chris Birchall","sameAs":"https://www.theguardian.com/profile/chris-birchall"}],"datePublished":"2015-03-26T14:56:03.000Z","headline":"Upgrading Elasticsearch: Content API’s dual stack strategy","dateModified":"2020-11-12T16:31:11.000Z","mainEntityOfPage":"https://www.theguardian.com/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy"},{"@type":"WebPage","@context":"https://schema.org","@id":"https://www.theguardian.com/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy","potentialAction":{"@type":"ViewAction","target":"android-app://com.guardian/https/www.theguardian.com/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy"}}],"openGraphData":{"og:url":"http://www.theguardian.com/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy","article:author":"https://www.theguardian.com/profile/luke-taylor,https://www.theguardian.com/profile/chris-birchall","og:image:width":"1200","og:image":"https://i.guim.co.uk/img/media/315f4f55befeba7522ba1a4c237e6d78ffb6b4a7/0_0_1020_612/master/1020.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctYWdlLTIwMTUucG5n&enable=upscale&s=a9f3ff52025ec084b8cc7ba9c8f5c3d1","al:ios:url":"gnmguardian://info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy?contenttype=Article&source=applinks","article:publisher":"https://www.facebook.com/theguardian","og:title":"Upgrading Elasticsearch: Content API’s dual stack strategy","fb:app_id":"180444840287","article:modified_time":"2020-11-12T16:31:11.000Z","og:image:height":"720","og:description":"Evaluation and explanation of process used to upgrade Elasticsearch with Route53 and a dual stack strategy on the Content API team at the Guardian.","og:type":"article","al:ios:app_store_id":"409128287","article:section":"Info","article:published_time":"2015-03-26T14:56:03.000Z","article:tag":"Technology,Programming,Cloud computing,Computing,Internet","al:ios:app_name":"The Guardian","og:site_name":"the Guardian"},"twitterData":{"twitter:app:id:iphone":"409128287","twitter:app:name:googleplay":"The Guardian","twitter:app:name:ipad":"The Guardian","twitter:card":"summary_large_image","twitter:app:name:iphone":"The Guardian","twitter:app:id:ipad":"409128287","twitter:app:id:googleplay":"com.guardian","twitter:app:url:googleplay":"guardian://www.theguardian.com/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy","twitter:app:url:iphone":"gnmguardian://info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy?contenttype=Article&source=twitter","twitter:image":"https://i.guim.co.uk/img/media/315f4f55befeba7522ba1a4c237e6d78ffb6b4a7/0_0_1020_612/master/1020.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctYWdlLTIwMTUucG5n&s=a910df835f2431aad0b8d809ba6572fb","twitter:site":"@guardian","twitter:app:url:ipad":"gnmguardian://info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy?contenttype=Article&source=twitter"},"config":{"switches":{"lightbox":true,"abPrebidKeywords":true,"personaliseSignInGateAfterCheckout":true,"abSignInGateMainVariant":true,"prebidAppnexusUkRow":true,"prebidMagnite":true,"commercialMetrics":true,"prebidTrustx":true,"scAdFreeBanner":false,"adaptiveSite":true,"prebidPermutiveAudience":true,"compareVariantDecision":false,"enableSentryReporting":true,"lazyLoadContainers":true,"ampArticleSwitch":false,"remarketing":true,"articleEndSlot":true,"keyEventsCarousel":true,"registerWithPhone":false,"darkModeWeb":true,"targeting":true,"remoteHeader":true,"slotBodyEnd":true,"ampPrebidOzone":false,"extendedMostPopularFronts":true,"emailInlineInFooter":true,"showNewPrivacyWordingOnEmailSignupEmbeds":true,"prebidAnalytics":true,"extendedMostPopular":true,"ampContentAbTesting":false,"prebidCriteo":true,"okta":true,"imrWorldwide":true,"acast":true,"twitterUwt":true,"abAuxiaSignInGate":false,"abDeferPermutiveLoad":true,"prebidAppnexusInvcode":true,"ampPrebidPubmatic":false,"a9HeaderBidding":true,"prebidAppnexus":true,"enableDiscussionSwitch":true,"prebidXaxis":true,"stickyVideos":true,"interactiveFullHeaderSwitch":true,"discussionAllPageSize":true,"prebidUserSync":true,"audioOnwardJourneySwitch":true,"abMovePermutiveSegmentation":false,"brazeTaylorReport":false,"externalVideoEmbeds":true,"abTheTradeDesk":true,"callouts":true,"sentinelLogger":true,"geoMostPopular":true,"weAreHiring":false,"relatedContent":true,"thirdPartyEmbedTracking":true,"prebidOzone":true,"ampLiveblogSwitch":false,"ampAmazon":false,"prebidAdYouLike":true,"mostViewedFronts":true,"optOutAdvertising":true,"abSignInGateMainControl":true,"googleSearch":true,"abOptOutFrequencyCap":true,"brazeSwitch":true,"prebidKargo":true,"consentManagement":true,"idProfileNavigation":true,"confiantAdVerification":true,"discussionAllowAnonymousRecommendsSwitch":false,"dcrCrosswords":true,"absoluteServerTimes":false,"permutive":true,"comscore":true,"ampPrebidCriteo":false,"prebidTheTradeDesk":true,"loopVideoTest":false,"newsletterOnwards":false,"youtubeIma":true,"webFonts":true,"liveBlogTopSponsorship":true,"abAdBlockAsk":false,"ophan":true,"crosswordSvgThumbnails":true,"prebidTriplelift":true,"prebidPubmatic":true,"serverShareCounts":false,"autoRefresh":true,"enhanceTweets":true,"prebidIndexExchange":true,"prebidOpenx":true,"prebidHeaderBidding":true,"idCookieRefresh":true,"discussionPageSize":true,"smartAppBanner":false,"historyTags":true,"brazeContentCards":true,"remoteBanner":true,"emailSignupRecaptcha":true,"prebidSmart":true,"shouldLoadGoogletag":true,"inizio":true,"europeBetaFront":true},"abTests":{},"googletagUrl":"//securepubads.g.doubleclick.net/tag/js/gpt.js","stage":"PROD","frontendAssetsFullURL":"https://assets.guim.co.uk/","ampIframeUrl":"https://assets.guim.co.uk/data/vendor/2533d5cb94302889e6a8f1b24b5329e7/amp-iframe.html","tones":"Blogposts","facebookIaAdUnitRoot":"facebook-instant-articles","avatarApiUrl":"https://avatar.theguardian.com","isSplash":false,"isColumn":false,"membershipUrl":"https://membership.theguardian.com","headline":"Upgrading Elasticsearch: Content API’s dual stack strategy","isImmersive":false,"author":"Luke Taylor,Chris Birchall","ipsosTag":"guardian","isProd":true,"series":"Engineering blog","toneIds":"tone/blog","membershipAccess":"","allowUserGeneratedContent":false,"commissioningDesks":"","webPublicationDate":1427381763000,"forecastsapiurl":"/weatherapi/forecast","supportUrl":"https://support.theguardian.com","isNumberedList":false,"commercialBundleUrl":"https://assets.guim.co.uk/commercial/47e59a6f2531251d895a/graun.standalone.commercial.js","idOAuthUrl":"https://oauth.theguardian.com","webTitle":"Upgrading Elasticsearch: Content API’s dual stack strategy","isPhotoEssay":false,"idWebAppUrl":"https://oauth.theguardian.com","a9PublisherId":"3722","isFront":false,"inBodyInternalLinkCount":0,"googleSearchUrl":"//www.google.co.uk/cse/cse.js","inBodyExternalLinkCount":12,"showRelatedContent":true,"lightboxImages":{"id":"info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy","headline":"Upgrading Elasticsearch: Content API’s dual stack strategy","shouldHideAdverts":false,"standfirst":"<p>Evaluation and explanation of process used to upgrade Elasticsearch with Route53 and a dual stack strategy on the Content API team at the Guardian. </p>","images":[{"caption":"Content API’s infamous lego tower.","credit":"Photograph: Digital Development at the Guardian","displayCredit":true,"src":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=700&quality=85&auto=format&fit=max&s=6ed5698436d18b4b15862badcd763580","srcsets":"https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=1920&quality=85&auto=format&fit=max&s=71628386cce9b9d2f6395d61966b3437 1920w, https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=1225&quality=85&auto=format&fit=max&s=a08692fabb431b3f797d8711ad3bfd82 1225w, https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=1065&quality=85&auto=format&fit=max&s=0d3eeee11537f0dab50e4dedd39ace19 1065w, https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=965&quality=85&auto=format&fit=max&s=bad9e22140df17ece668378544553ef3 965w, https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=725&quality=85&auto=format&fit=max&s=89c73b8cda3120cbb367b2e1c6a03d75 725w, https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=645&quality=85&auto=format&fit=max&s=e3ccf7e09816532ce0ee7c8a11db698c 645w, https://i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2015/3/25/1427302497657/d12e6983-1fa1-4baa-ad87-8417dfdd94fa-680x1020.jpeg?width=465&quality=85&auto=format&fit=max&s=2fde5b60b1d89ba76c4bfd9d02000c25 465w","sizes":"(min-width: 1300px) 1920px, (min-width: 1140px) 1225px, (min-width: 980px) 1065px, (min-width: 740px) 965px, (min-width: 660px) 725px, (min-width: 480px) 645px, 465px","ratio":0.6666666666666666,"role":"None","parentContentId":"info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy","id":"info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy"}]},"googleSearchId":"007466294097402385199:m2ealvuxh1i","shouldHideReaderRevenue":false,"idUrl":"https://profile.theguardian.com","hasSurveyAd":false,"omnitureAmpAccount":"guardiangu-thirdpartyapps","dfpAdUnitRoot":"theguardian.com","host":"https://www.theguardian.com","blogIds":"","sectionName":"Info","hasMultipleVideosInPage":false,"hasShowcaseMainElement":false,"googleRecaptchaSiteKey":"6LdzlmsdAAAAALFH63cBVagSFPuuHXQ9OfpIDdMc","fbAppId":"180444840287","isContent":true,"shortUrlId":"/p/47xvx","dfpAccountId":"59666047","plistaPublicApiKey":"462925f4f131001fd974bebe","wordCount":1515,"hasLiveBlogTopAd":false,"dcrSentryDsn":"https://1937ab71c8804b2b8438178dfdd6468f@sentry.io/1377847","cardStyle":"news","adUnit":"/59666047/theguardian.com/info/article/ng","discussionApiUrl":"https://discussion.theguardian.com/discussion-api","isSensitive":false,"ophanEmbedJsUrl":"//j.ophan.co.uk/ophan.embed","edition":"UK","brazeApiKey":"7f28c639-8bda-48ff-a3f6-24345abfc07c","blogs":"","discussionApiClientHeader":"nextgen","section":"info","userAttributesApiUrl":"https://members-data-api.theguardian.com/user-attributes","videoDuration":0,"dfpHost":"pubads.g.doubleclick.net","weatherapiurl":"/weatherapi/city","sentryPublicApiKey":"344003a8d11c41d8800fbad8383fdc50","shortUrl":"https://www.theguardian.com/p/47xvx","thumbnail":"https://i.guim.co.uk/img/media/315f4f55befeba7522ba1a4c237e6d78ffb6b4a7/0_0_1020_612/500.jpg?quality=85&auto=format&fit=max&s=3af9f5befd18c1be17f0efd3bf527045","pillar":"News","pageId":"info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy","references":[{"rich-link":"https://www.theguardian.com/info/ng-interactive/2021/jun/25/techscape-sign-up"}],"beaconUrl":"//phar.gu-web.net","commentable":true,"discussionD2Uid":"zHoBy6HNKsk","ophanJsUrl":"//j.ophan.co.uk/ophan.ng","contributorBio":"","keywordIds":"technology/technology,technology/programming,technology/cloud-computing,technology/computing,technology/internet","contentType":"Article","isDev":false,"isHosted":false,"isAdFree":false,"stripePublicToken":"pk_live_2O6zPMHXNs2AGea4bAmq5R7Z","omnitureAccount":"guardiangu-network","locationapiurl":"/weatherapi/locations?query=","authorIds":"profile/luke-taylor,profile/chris-birchall","isPaidContent":false,"hasYouTubeAtom":false,"externalEmbedHost":"https://embed.theguardian.com","thirdPartyAppsAccount":"guardiangu-thirdpartyapps","ajaxUrl":"https://api.nextgen.guardianapps.co.uk","byline":"Luke Taylor and Chris Birchall","keywords":"Technology,Programming,Cloud computing,Computing,Internet","contentId":"info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy","nonKeywordTagIds":"info/series/engineering-blog,type/article,tone/blog,profile/luke-taylor,profile/chris-birchall","mobileAppsAdUnitRoot":"beta-guardian-app","hasPageSkin":false,"requiresMembershipAccess":false,"seriesTags":"Engineering blog","revisionNumber":"DEV","seriesId":"info/series/engineering-blog","optimizeEpicUrl":"https://support.theguardian.com/epic/control/index.html","assetsPath":"https://assets.guim.co.uk/","mmaUrl":"https://manage.theguardian.com","isLive":false,"richLink":"/info/ng-interactive/2021/jun/25/techscape-sign-up","campaigns":[],"isLiveBlog":false,"pageCode":"2264275","avatarImagesUrl":"https://avatar.guim.co.uk","publication":"theguardian.com","sentryHost":"app.getsentry.com/35463","buildNumber":"DEV","userBenefitsApiUrl":"https://user-benefits.guardianapis.com/benefits/me","sharedAdTargeting":{"se":["engineering-blog"],"ct":"article","su":["0"],"edition":"uk","tn":["blog"],"p":"ng","k":["programming","computing","technology","internet","cloud-computing"],"sh":"https://www.theguardian.com/p/47xvx","co":["luke-taylor","chris-birchall"],"url":"/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy"},"onwardWebSocket":"ws://api.nextgen.guardianapps.co.uk/recently-published","productionOffice":"Uk","shouldHideAdverts":false,"idApiUrl":"https://idapi.theguardian.com","pbIndexSites":[{"bp":"D","id":208247},{"bp":"M","id":213519},{"bp":"T","id":215454}],"googletagJsUrl":"//securepubads.g.doubleclick.net/tag/js/gpt.js","calloutsUrl":"https://callouts.guardianapis.com/formstack-campaign/submit","isPreview":false},"guardianBaseURL":"https://www.theguardian.com","contentType":"Article","hasRelated":true,"hasStoryPackage":false,"beaconURL":"//phar.gu-web.net","isCommentable":true,"commercialProperties":{"US":{"adTargeting":[{"name":"su","value":["0"]},{"name":"edition","value":"us"},{"name":"sh","value":"https://www.theguardian.com/p/47xvx"},{"name":"ct","value":"article"},{"name":"co","value":["luke-taylor","chris-birchall"]},{"name":"k","value":["programming","computing","technology","internet","cloud-computing"]},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"},{"name":"tn","value":["blog"]},{"name":"url","value":"/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy"}]},"AU":{"adTargeting":[{"name":"su","value":["0"]},{"name":"edition","value":"au"},{"name":"sh","value":"https://www.theguardian.com/p/47xvx"},{"name":"ct","value":"article"},{"name":"co","value":["luke-taylor","chris-birchall"]},{"name":"k","value":["programming","computing","technology","internet","cloud-computing"]},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"},{"name":"tn","value":["blog"]},{"name":"url","value":"/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy"}]},"UK":{"adTargeting":[{"name":"su","value":["0"]},{"name":"ct","value":"article"},{"name":"co","value":["luke-taylor","chris-birchall"]},{"name":"k","value":["programming","computing","technology","internet","cloud-computing"]},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"},{"name":"edition","value":"uk"},{"name":"sh","value":"https://www.theguardian.com/p/47xvx"},{"name":"tn","value":["blog"]},{"name":"url","value":"/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy"}]},"INT":{"adTargeting":[{"name":"su","value":["0"]},{"name":"sh","value":"https://www.theguardian.com/p/47xvx"},{"name":"ct","value":"article"},{"name":"co","value":["luke-taylor","chris-birchall"]},{"name":"k","value":["programming","computing","technology","internet","cloud-computing"]},{"name":"edition","value":"int"},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"},{"name":"tn","value":["blog"]},{"name":"url","value":"/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy"}]},"EUR":{"adTargeting":[{"name":"su","value":["0"]},{"name":"sh","value":"https://www.theguardian.com/p/47xvx"},{"name":"ct","value":"article"},{"name":"co","value":["luke-taylor","chris-birchall"]},{"name":"edition","value":"eur"},{"name":"k","value":["programming","computing","technology","internet","cloud-computing"]},{"name":"se","value":["engineering-blog"]},{"name":"p","value":"ng"},{"name":"tn","value":["blog"]},{"name":"url","value":"/info/developer-blog/2015/mar/26/upgrading-elasticsearch-content-apis-dual-stack-strategy"}]}},"pageType":{"hasShowcaseMainElement":false,"isFront":false,"isLiveblog":false,"isMinuteArticle":false,"isPaidContent":false,"isPreview":false,"isSensitive":false},"trailText":"Evaluation and explanation of process used to upgrade Elasticsearch with Route53 and a dual stack strategy on the Content API team at the Guardian. ","nav":{"currentUrl":"/info","pillars":[{"title":"News","url":"/","longTitle":"Headlines","iconName":"home","children":[{"title":"UK","url":"/uk-news","longTitle":"UK news","children":[{"title":"UK politics","url":"/politics"},{"title":"Education","url":"/education","children":[{"title":"Schools","url":"/education/schools"},{"title":"Teachers","url":"/teacher-network"},{"title":"Universities","url":"/education/universities"},{"title":"Students","url":"/education/students"}]},{"title":"Media","url":"/media"},{"title":"Society","url":"/society"},{"title":"Law","url":"/law"},{"title":"Scotland","url":"/uk/scotland"},{"title":"Wales","url":"/uk/wales"},{"title":"Northern Ireland","url":"/uk/northernireland"}]},{"title":"US politics","url":"/us-news/us-politics"},{"title":"World","url":"/world","longTitle":"World news","children":[{"title":"Europe","url":"/world/europe-news"},{"title":"US","url":"/us-news","longTitle":"US news"},{"title":"Americas","url":"/world/americas"},{"title":"Asia","url":"/world/asia"},{"title":"Australia","url":"/australia-news","longTitle":"Australia news"},{"title":"Middle East","url":"/world/middleeast"},{"title":"Africa","url":"/world/africa"},{"title":"Inequality","url":"/inequality"},{"title":"Global development","url":"/global-development"}]},{"title":"Climate crisis","url":"/environment/climate-crisis"},{"title":"Middle East","url":"/world/middleeast"},{"title":"Ukraine","url":"/world/ukraine"},{"title":"Football","url":"/football","children":[{"title":"Live scores","url":"/football/live","longTitle":"football/live"},{"title":"Tables","url":"/football/tables","longTitle":"football/tables"},{"title":"Fixtures","url":"/football/fixtures","longTitle":"football/fixtures"},{"title":"Results","url":"/football/results","longTitle":"football/results"},{"title":"Competitions","url":"/football/competitions","longTitle":"football/competitions"},{"title":"Clubs","url":"/football/teams","longTitle":"football/teams"}]},{"title":"Newsletters","url":"/email-newsletters"},{"title":"Business","url":"/business","children":[{"title":"Economics","url":"/business/economics"},{"title":"Banking","url":"/business/banking"},{"title":"Money","url":"/money","children":[{"title":"Property","url":"/money/property"},{"title":"Pensions","url":"/money/pensions"},{"title":"Savings","url":"/money/savings"},{"title":"Borrowing","url":"/money/debt"},{"title":"Careers","url":"/money/work-and-careers"}]},{"title":"Markets","url":"/business/stock-markets"},{"title":"Project Syndicate","url":"/business/series/project-syndicate-economists"},{"title":"B2B","url":"/business-to-business"},{"title":"Retail","url":"/business/retail"}]},{"title":"Environment","url":"/environment","children":[{"title":"Climate crisis","url":"/environment/climate-crisis"},{"title":"Wildlife","url":"/environment/wildlife"},{"title":"Energy","url":"/environment/energy"},{"title":"Pollution","url":"/environment/pollution"}]},{"title":"UK politics","url":"/politics"},{"title":"Society","url":"/society"},{"title":"Science","url":"/science"},{"title":"Tech","url":"/technology"},{"title":"Global development","url":"/global-development"},{"title":"Obituaries","url":"/obituaries"}]},{"title":"Opinion","url":"/commentisfree","longTitle":"Opinion home","iconName":"home","children":[{"title":"The Guardian view","url":"/profile/editorial"},{"title":"Columnists","url":"/index/contributors"},{"title":"Cartoons","url":"/tone/cartoons"},{"title":"Opinion videos","url":"/type/video+tone/comment"},{"title":"Letters","url":"/tone/letters"}]},{"title":"Sport","url":"/sport","longTitle":"Sport home","iconName":"home","children":[{"title":"Football","url":"/football","children":[{"title":"Live scores","url":"/football/live","longTitle":"football/live"},{"title":"Tables","url":"/football/tables","longTitle":"football/tables"},{"title":"Fixtures","url":"/football/fixtures","longTitle":"football/fixtures"},{"title":"Results","url":"/football/results","longTitle":"football/results"},{"title":"Competitions","url":"/football/competitions","longTitle":"football/competitions"},{"title":"Clubs","url":"/football/teams","longTitle":"football/teams"}]},{"title":"Cricket","url":"/sport/cricket"},{"title":"Rugby union","url":"/sport/rugby-union"},{"title":"Tennis","url":"/sport/tennis"},{"title":"Cycling","url":"/sport/cycling"},{"title":"F1","url":"/sport/formulaone"},{"title":"Golf","url":"/sport/golf"},{"title":"Boxing","url":"/sport/boxing"},{"title":"Rugby league","url":"/sport/rugbyleague"},{"title":"Racing","url":"/sport/horse-racing"},{"title":"US sports","url":"/sport/us-sport"}]},{"title":"Culture","url":"/culture","longTitle":"Culture home","iconName":"home","children":[{"title":"Film","url":"/film"},{"title":"Music","url":"/music"},{"title":"TV & radio","url":"/tv-and-radio"},{"title":"Books","url":"/books"},{"title":"Art & design","url":"/artanddesign"},{"title":"Stage","url":"/stage"},{"title":"Games","url":"/games"},{"title":"Classical","url":"/music/classicalmusicandopera"}]},{"title":"Lifestyle","url":"/lifeandstyle","longTitle":"Lifestyle home","iconName":"home","children":[{"title":"The Filter","url":"/uk/thefilter"},{"title":"Fashion","url":"/fashion"},{"title":"Food","url":"/food"},{"title":"Recipes","url":"/tone/recipes"},{"title":"Travel","url":"/travel","children":[{"title":"UK","url":"/travel/uk"},{"title":"Europe","url":"/travel/europe"},{"title":"US","url":"/travel/usa"}]},{"title":"Health & fitness","url":"/lifeandstyle/health-and-wellbeing"},{"title":"Women","url":"/lifeandstyle/women"},{"title":"Men","url":"/lifeandstyle/men"},{"title":"Love & sex","url":"/lifeandstyle/love-and-sex"},{"title":"Beauty","url":"/fashion/beauty"},{"title":"Home & garden","url":"/lifeandstyle/home-and-garden"},{"title":"Money","url":"/money","children":[{"title":"Property","url":"/money/property"},{"title":"Pensions","url":"/money/pensions"},{"title":"Savings","url":"/money/savings"},{"title":"Borrowing","url":"/money/debt"},{"title":"Careers","url":"/money/work-and-careers"}]},{"title":"Cars","url":"/technology/motoring"}]}],"otherLinks":[{"title":"The Guardian app","url":"https://app.adjust.com/16xt6hai"},{"title":"Video","url":"/video"},{"title":"Podcasts","url":"/podcasts"},{"title":"Pictures","url":"/inpictures"},{"title":"Newsletters","url":"/email-newsletters"},{"title":"Today's paper","url":"/theguardian","children":[{"title":"Obituaries","url":"/obituaries"},{"title":"G2","url":"/theguardian/g2"},{"title":"Journal","url":"/theguardian/journal"},{"title":"Saturday","url":"/theguardian/saturday"}]},{"title":"Inside the Guardian","url":"https://www.theguardian.com/insidetheguardian"},{"title":"The Observer","url":"/observer","children":[{"title":"Comment","url":"/theobserver/news/comment"},{"title":"The New Review","url":"/theobserver/new-review"},{"title":"Observer Magazine","url":"/theobserver/magazine"},{"title":"Observer Food Monthly","url":"/theobserver/foodmonthly"}]},{"title":"Guardian Weekly","url":"https://www.theguardian.com/weekly?INTCMP=gdnwb_mawns_editorial_gweekly_GW_TopNav_UK"},{"title":"Crosswords","url":"/crosswords","children":[{"title":"Blog","url":"/crosswords/crossword-blog"},{"title":"Quick","url":"/crosswords/series/quick"},{"title":"Speedy","url":"/crosswords/series/speedy"},{"title":"Quick cryptic","url":"/crosswords/series/quick-cryptic"},{"title":"Everyman","url":"/crosswords/series/everyman"},{"title":"Quiptic","url":"/crosswords/series/quiptic"},{"title":"Cryptic","url":"/crosswords/series/cryptic"},{"title":"Prize","url":"/crosswords/series/prize"},{"title":"Azed","url":"/crosswords/series/azed"},{"title":"Genius","url":"/crosswords/series/genius"},{"title":"Weekend","url":"/crosswords/series/weekend-crossword"},{"title":"Special","url":"/crosswords/series/special"}]},{"title":"Wordiply","url":"https://www.wordiply.com"},{"title":"Corrections","url":"/theguardian/series/corrections-and-clarifications"}],"brandExtensions":[{"title":"Search jobs","url":"https://jobs.theguardian.com"},{"title":"Hire with Guardian Jobs","url":"https://recruiters.theguardian.com/?utm_source=gdnwb&utm_medium=navbar&utm_campaign=Guardian_Navbar_Recruiters&CMP_TU=trdmkt&CMP_BUNIT=jobs"},{"title":"Holidays","url":"https://holidays.theguardian.com?INTCMP=holidays_uk_web_newheader"},{"title":"Live events","url":"https://www.theguardian.com/guardian-live-events?INTCMP=live_uk_header_dropdown"},{"title":"About Us","url":"/about"},{"title":"Digital Archive","url":"https://theguardian.newspapers.com"},{"title":"Guardian Print Shop","url":"/artanddesign/series/gnm-print-sales"},{"title":"Patrons","url":"https://patrons.theguardian.com/?INTCMP=header_patrons"},{"title":"Guardian Licensing","url":"https://licensing.theguardian.com/"}],"readerRevenueLinks":{"header":{"contribute":"https://support.theguardian.com/contribute?INTCMP=header_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=header_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=header_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=header_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_supporter_cta%22%7D"},"footer":{"contribute":"https://support.theguardian.com/contribute?INTCMP=footer_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=footer_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=footer_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=footer_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_supporter_cta%22%7D"},"sideMenu":{"contribute":"https://support.theguardian.com/contribute?INTCMP=side_menu_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22side_menu_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=side_menu_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22side_menu_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=side_menu_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22side_menu_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=mobilenav_print_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22mobilenav_print_cta%22%7D"},"ampHeader":{"contribute":"https://support.theguardian.com/contribute?INTCMP=header_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=header_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=amp_header_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22amp_header_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=header_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_HEADER%22,%22componentId%22:%22header_supporter_cta%22%7D"},"ampFooter":{"contribute":"https://support.theguardian.com/contribute?INTCMP=amp_footer_support_contribute&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22amp_footer_support_contribute%22%7D","subscribe":"https://support.theguardian.com/subscribe?INTCMP=amp_footer_support_subscribe&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22amp_footer_support_subscribe%22%7D","support":"https://support.theguardian.com?INTCMP=footer_support&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22footer_support%22%7D","supporter":"https://support.theguardian.com/subscribe?INTCMP=amp_footer_supporter_cta&acquisitionData=%7B%22source%22:%22GUARDIAN_WEB%22,%22componentType%22:%22ACQUISITIONS_FOOTER%22,%22componentId%22:%22amp_footer_supporter_cta%22%7D"}}},"showBottomSocialButtons":true,"pageFooter":{"footerLinks":[[{"text":"About us","url":"/about","dataLinkName":"uk : footer : about us","extraClasses":""},{"text":"Help","url":"https://manage.theguardian.com/help-centre","dataLinkName":"uk : footer : tech feedback","extraClasses":"js-tech-feedback-report"},{"text":"Complaints & corrections","url":"/info/complaints-and-corrections","dataLinkName":"complaints","extraClasses":""},{"text":"SecureDrop","url":"https://www.theguardian.com/securedrop","dataLinkName":"securedrop","extraClasses":""},{"text":"Work for us","url":"https://workforus.theguardian.com","dataLinkName":"uk : footer : work for us","extraClasses":""},{"text":"Privacy policy","url":"/info/privacy","dataLinkName":"privacy","extraClasses":""},{"text":"Cookie policy","url":"/info/cookies","dataLinkName":"cookie","extraClasses":""},{"text":"Terms & conditions","url":"/help/terms-of-service","dataLinkName":"terms","extraClasses":""},{"text":"Contact us","url":"/help/contact-us","dataLinkName":"uk : footer : contact us","extraClasses":""}],[{"text":"All topics","url":"/index/subjects/a","dataLinkName":"uk : footer : all topics","extraClasses":""},{"text":"All writers","url":"/index/contributors","dataLinkName":"uk : footer : all contributors","extraClasses":""},{"text":"Modern Slavery Act","url":"https://uploads.guim.co.uk/2024/09/04/Modern_Slavery_Statement_2024_.pdf","dataLinkName":"uk : footer : modern slavery act statement","extraClasses":""},{"text":"Tax strategy","url":"https://uploads.guim.co.uk/2024/08/27/TAX_STRATEGY_FOR_THE_YEAR_ENDED_31_MARCH_2025.pdf","dataLinkName":"uk : footer : tax strategy","extraClasses":""},{"text":"Digital newspaper archive","url":"https://theguardian.newspapers.com","dataLinkName":"digital newspaper archive","extraClasses":""},{"text":"Facebook","url":"https://www.facebook.com/theguardian","dataLinkName":"uk : footer : facebook","extraClasses":""},{"text":"YouTube","url":"https://www.youtube.com/user/TheGuardian","dataLinkName":"uk : footer : youtube","extraClasses":""},{"text":"Instagram","url":"https://www.instagram.com/guardian","dataLinkName":"uk : footer : instagram","extraClasses":""},{"text":"LinkedIn","url":"https://www.linkedin.com/company/theguardian","dataLinkName":"uk : footer : linkedin","extraClasses":""},{"text":"Newsletters","url":"/email-newsletters?INTCMP=DOTCOM_FOOTER_NEWSLETTER_UK","dataLinkName":"uk : footer : newsletters","extraClasses":""}],[{"text":"Advertise with us","url":"https://advertising.theguardian.com","dataLinkName":"uk : footer : advertise with us","extraClasses":""},{"text":"Guardian Labs","url":"/guardian-labs","dataLinkName":"uk : footer : guardian labs","extraClasses":""},{"text":"Search jobs","url":"https://jobs.theguardian.com","dataLinkName":"uk : footer : jobs","extraClasses":""},{"text":"Patrons","url":"https://patrons.theguardian.com?INTCMP=footer_patrons","dataLinkName":"uk : footer : patrons","extraClasses":""}]]},"publication":"theguardian.com","shouldHideReaderRevenue":false,"slotMachineFlags":"","contributionsServiceUrl":"https://contributions.guardianapis.com","isSpecialReport":false,"showTableOfContents":false,"lang":"en","isRightToLeftLang":false}