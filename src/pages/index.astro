---
import PageLayout from "../layouts/page.astro";
import { Markdown } from "astro/components";
import { timeAgo } from "@guardian/libs";

import { border } from "../styles/shared.ts";
import home from "/assets/home.jpg";

type Result = {
  id: string;
  type: string;
  sectionId: string;
  sectionName: string;
  webPublicationDate: string;
  webTitle: string;
  webUrl: string;
  apiUrl: string;
  isHosted: boolean;
  pillarId: string;
  pillarName: string;
};

const posts: Result[] = await fetch(
  "https://content.guardianapis.com/search?tag=info%2Fseries%2Fengineering-blog&api-key=test"
)
  .then((r) => r.json())
  .then((d) => d.response.results);
---

<PageLayout edit="index.astro">
  <section id="shaping-the-future-of-digital-journalism">
    <div>
      <h2>We're shaping the future of digital journalism.</h2>
      <h2><a href="https://workforus.theguardian.com/">Join Us.</a></h2>
    </div>

    <img id="home" src={home} />
  </section>

  <section id="build-for-a-greater-cause">
    <h3>We build in pursuit of a cause that is greater than ourselves.</h3>

    <ul>
      <li>
        <h4>Empowering journalists</h4>
        We build products that make it easier for journalists to publish informative
        and delightful stories.
      </li>
      <li>
        <Markdown>
          #### Coding in the open

          We do much of our coding in public. Check out [our GitHub profile][] to see what
          weâ€™ve been working on.

          [our github profile]: https://github.com/guardian
        </Markdown>
      </li>
      <li>
        <h4>Moving fast</h4>
        We spend our energy on the right things, shipping code and then rapidly iterating
        on it. Move fast, break news.
      </li>
      <li>
        <h4>Using the best tool for the job</h4>
        We mostly program in Scala and JavaScript, but we use the best tool that
        solves the problem.
      </li>
    </ul>
  </section>
  <section id="engineering-blog-posts">
    <h3>Latest Engineering blog posts</h3>
    <ul>
      {posts.slice(0, 9).map((post) => {
        const time = new Date(post.webPublicationDate).getTime();
        const pubDate = timeAgo(time);
        return (
          <li>
            <a href={post.webUrl}>
              <h4>{post.webTitle}</h4>
              <h5>{pubDate}</h5>
            </a>
          </li>
        );
      })}
    </ul>
  </section>
</PageLayout>

<style lang="scss" define:vars={{ border }}>
  section {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    padding: 1rem;
  }

  // All but the first section
  section:nth-of-type(n + 2) {
    border-top: var(--border);
  }

  h2,
  h3 {
    line-height: 1.1;
  }

  h2 {
    font-size: 3.75rem;
  }

  h3 {
    font-size: 3.75rem;
  }

  #shaping-the-future-of-digital-journalism {
    div {
      flex-basis: 42rem;
    }

    a {
      background-color: #ccc;
      color: #111;
      text-decoration: none;
      padding: 0 0.25em;
    }

    img {
      object-fit: cover;
      flex: 1 1 40%;
      max-height: 60vh;
      position: relative;
      // right: -2rem;
    }
  }

  #build-for-a-greater-cause {
    h3 {
      flex: 24rem;
    }

    ul {
      flex: 1 0 30rem;
      padding: 2rem;
      list-style-type: none;
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(2, 1fr);
      counter-reset: card;

      li {
        padding: 0.5em;
        background-color: #333;
        position: relative;

        &::after {
          position: absolute;
          top: -0.75em;
          right: -0.75em;
          counter-increment: card;
          content: counter(card);
          background-color: #ccc;
          color: #111;
          width: 1.5em;
          height: 1.5em;
          line-height: 1.4em;
          border-radius: 1em;
          text-align: center;
        }

        h4 {
          margin: 0;
          padding-bottom: 0.5em;
        }
      }
    }
  }

  #engineering-blog-posts {
    ul {
      display: flex;
      flex-wrap: wrap;
      list-style-type: none;

      li {
        flex: 0 1 30%;
        padding: 0.5rem;

        a {
          color: inherit;
          text-decoration: none;
          padding: 0.5rem;
          display: block;
          box-sizing: border-box;
          height: 100%;
          background-color: #333;
        }

        h4,
        h5 {
          margin: 0;
        }

        h5 {
          padding-top: 0.5rem;
          font-weight: normal;
          text-decoration: none;
          color: inherit;
        }
      }
    }
  }
</style>
